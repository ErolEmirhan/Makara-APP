<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#dc2626">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="MAKARA">
  <!-- Cache Control -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <link rel="manifest" href="/manifest.json?v=2.4.12">
  <link rel="icon" type="image/png" href="/patron.png">
  <link rel="apple-touch-icon" href="/patron.png">
  <title>MAKARA - Admin Dashboard</title>
  
  <!-- Firebase SDK (Compat Version) -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  
  <script>
    // Cache ve Service Worker Temizleme - Her deploy'da gÃ¼ncel versiyonu yÃ¼kle
    (function() {
      const APP_VERSION = '2.4.12';
      const STORAGE_KEY = 'makara_admin_version';
      
      // Mevcut versiyonu kontrol et
      const currentVersion = localStorage.getItem(STORAGE_KEY);
      
      // EÄŸer versiyon deÄŸiÅŸtiyse veya ilk yÃ¼kleme ise cache'i temizle
      if (currentVersion !== APP_VERSION) {
        console.log('ğŸ”„ Yeni versiyon tespit edildi, cache temizleniyor...');
        
        // Service Worker'larÄ± unregister et
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.getRegistrations().then(function(registrations) {
            for(let registration of registrations) {
              registration.unregister().then(function(success) {
                if (success) {
                  console.log('âœ… Service Worker kaldÄ±rÄ±ldÄ±');
                }
              });
            }
          });
        }
        
        // TÃ¼m cache'leri temizle
        if ('caches' in window) {
          caches.keys().then(function(names) {
            for (let name of names) {
              caches.delete(name).then(function(success) {
                if (success) {
                  console.log('âœ… Cache temizlendi:', name);
                }
              });
            }
          });
        }
        
        // IndexedDB'yi temizle (isteÄŸe baÄŸlÄ±)
        if ('indexedDB' in window) {
          // IndexedDB temizleme iÅŸlemi
          indexedDB.databases().then(databases => {
            databases.forEach(db => {
              indexedDB.deleteDatabase(db.name);
            });
          });
        }
        
        // Yeni versiyonu kaydet
        localStorage.setItem(STORAGE_KEY, APP_VERSION);
        
        // SayfayÄ± yeniden yÃ¼kle (cache olmadan)
        if (currentVersion) {
          // Sadece versiyon deÄŸiÅŸtiyse yeniden yÃ¼kle (ilk yÃ¼klemede deÄŸil)
          setTimeout(() => {
            window.location.reload(true);
          }, 500);
        }
      }
    })();
    
    // Firebase yapÄ±landÄ±rmasÄ±
    const firebaseConfig = {
      apiKey: "AIzaSyCdf-c13e0wCafRYHXhIls1epJgD1RjPUA",
      authDomain: "makara-16344.firebaseapp.com",
      projectId: "makara-16344",
      storageBucket: "makara-16344.firebasestorage.app",
      messagingSenderId: "216769654742",
      appId: "1:216769654742:web:16792742d4613f4269be77",
      measurementId: "G-K4XZHP11MM"
    };

    // Ana Firebase (satÄ±ÅŸlar, Ã¼rÃ¼nler, kategoriler iÃ§in)
    let app, db;
    // Masalar iÃ§in ayrÄ± Firebase (makaramasalar)
    let tablesApp, tablesDb;
    let isAuthenticated = false;
    let realtimeUnsubscribe = null;
    let allSales = []; // TÃ¼m satÄ±ÅŸlarÄ± sakla
    let activeTab = 'sales'; // 'sales', 'reports', 'staff', 'tables', 'cancels'
    let reportDateFilter = 'all'; // 'all', 'yesterday', 'week', 'month', 'custom'
    let salesDateFilter = 'all'; // SatÄ±ÅŸ geÃ§miÅŸi iÃ§in tarih filtresi
    let customDateRange = { start: null, end: null }; // Ã–zel tarih aralÄ±ÄŸÄ±
    let salesCustomDateRange = { start: null, end: null }; // SatÄ±ÅŸ geÃ§miÅŸi iÃ§in Ã¶zel tarih aralÄ±ÄŸÄ±
    let tablesUnsubscribe = null; // Masalar iÃ§in real-time listener
    let activeTablesUnsubscribe = null; // Aktif masa sayÄ±sÄ± iÃ§in real-time listener
    let allStaticTables = {}; // TÃ¼m masalarÄ± sakla (iÃ§, dÄ±ÅŸ, paket)
    let previousTableStates = {}; // Masa durumlarÄ±nÄ± takip et (toast iÃ§in)
    let isFirstTablesLoad = true; // Ä°lk yÃ¼kleme kontrolÃ¼ (toast gÃ¶stermemek iÃ§in)
    let notificationsHistory = []; // Bildirim geÃ§miÅŸi
    let unreadNotificationsCount = 0; // OkunmamÄ±ÅŸ bildirim sayÄ±sÄ±
    let revenueNotificationSent = false; // GÃ¼nlÃ¼k ciro bildirimi gÃ¶nderildi mi (gÃ¼nlÃ¼k kontrol iÃ§in)
    let lastRevenueNotificationDate = null; // Son bildirim gÃ¶nderilen tarih
    let notificationsMuted = false; // Bildirimler sessize alÄ±ndÄ± mÄ±
    let onlineApp = null; // Online sipariÅŸler Firebase app
    let onlineDb = null; // Online sipariÅŸler Firestore
    let onlineOrdersUnsubscribe = null; // Online sipariÅŸler real-time listener
    let onlineOrders = []; // Online sipariÅŸler listesi
    let allCancels = []; // TÃ¼m iptal kayÄ±tlarÄ±
    // Lazy loading iÃ§in deÄŸiÅŸkenler
    let salesDisplayedCount = 10; // GÃ¶sterilen satÄ±ÅŸ sayÄ±sÄ± (10'ar 10'ar)
    let cancelsDisplayedCount = 2; // GÃ¶sterilen iptal sayÄ±sÄ± (2'ÅŸer 2'ÅŸer)
    let isLoadingMoreSales = false; // SatÄ±ÅŸ yÃ¼kleme durumu
    let isLoadingMoreCancels = false; // Ä°ptal yÃ¼kleme durumu

    try {
      // Ana Firebase zaten baÅŸlatÄ±lmÄ±ÅŸ mÄ± kontrol et
      try {
        app = firebase.app();
      } catch (e) {
        app = firebase.initializeApp(firebaseConfig);
      }
      db = firebase.firestore();
      console.log('âœ… Ana Firebase baÅŸarÄ±yla baÅŸlatÄ±ldÄ±');
      
      // Masalar iÃ§in ayrÄ± Firebase baÅŸlat (makaramasalar)
      const tablesFirebaseConfig = {
        apiKey: "AIzaSyDu_NUrgas4wZ_wdfAYE-DgxqTpb7vKxyo",
        authDomain: "makaramasalar.firebaseapp.com",
        projectId: "makaramasalar",
        storageBucket: "makaramasalar.firebasestorage.app",
        messagingSenderId: "840151572206",
        appId: "1:840151572206:web:0afaf93deea636309e5dff",
        measurementId: "G-2S0J3566ZY"
      };
      
      try {
        tablesApp = firebase.initializeApp(tablesFirebaseConfig, 'tables');
        tablesDb = firebase.firestore(tablesApp);
        console.log('âœ… Masalar Firebase baÅŸarÄ±yla baÅŸlatÄ±ldÄ± (makaramasalar)');
      } catch (tablesError) {
        console.error('âŒ Masalar Firebase baÅŸlatma hatasÄ±:', tablesError);
      }
      
      // Online sipariÅŸler iÃ§in ayrÄ± Firebase baÅŸlat (makaraonline-5464e)
      const onlineFirebaseConfig = {
        apiKey: "AIzaSyAucyGoXwmQ5nrQLfk5zL5-73ir7u9vbI8",
        authDomain: "makaraonline-5464e.firebaseapp.com",
        projectId: "makaraonline-5464e",
        storageBucket: "makaraonline-5464e.firebasestorage.app",
        messagingSenderId: "1041589485836",
        appId: "1:1041589485836:web:06119973a19da0a14f0929",
        measurementId: "G-MKPPB635ZZ"
      };
      
      try {
        onlineApp = firebase.initializeApp(onlineFirebaseConfig, 'onlineOrders');
        onlineDb = firebase.firestore(onlineApp);
        console.log('âœ… Online SipariÅŸler Firebase baÅŸarÄ±yla baÅŸlatÄ±ldÄ± (makaraonline-5464e)');
        
        // Online sipariÅŸleri dinle (badge iÃ§in)
        // Fonksiyon tanÄ±mlandÄ±ktan sonra Ã§aÄŸrÄ±lacak (sayfa yÃ¼klendikten sonra)
        // Åimdilik sadece baÄŸlantÄ±yÄ± hazÄ±rla, listener window.load event'inde baÅŸlatÄ±lacak
      } catch (onlineError) {
        console.error('âŒ Online SipariÅŸler Firebase baÅŸlatma hatasÄ±:', onlineError);
        console.error('Hata detaylarÄ±:', onlineError.message, onlineError.code);
      }
      
      document.getElementById('errorMessage')?.remove();
    } catch (error) {
      console.error('âŒ Firebase baÅŸlatma hatasÄ±:', error);
      const errorDiv = document.createElement('div');
      errorDiv.id = 'errorMessage';
      errorDiv.style.cssText = 'background: #ff4444; color: white; padding: 20px; text-align: center; margin: 20px; border-radius: 10px;';
      errorDiv.innerHTML = '<h3>âŒ Firebase SDK YÃ¼klenemedi</h3><p>LÃ¼tfen sayfayÄ± yenileyin veya internet baÄŸlantÄ±nÄ±zÄ± kontrol edin.</p>';
      document.body.insertBefore(errorDiv, document.body.firstChild);
    }

    // PIN giriÅŸi - Firebase'den yÃ¼klenecek (2 ÅŸifre desteÄŸi)
    let adminPins = ['Mfp14531789.', '102030']; // VarsayÄ±lan ÅŸifreler (Firebase'den yÃ¼klenene kadar)
    
    // Firebase'den ÅŸifreleri yÃ¼kle
    async function loadAdminPins() {
      try {
        const pinDoc = await db.collection('admin').doc('pin').get();
        if (pinDoc.exists && pinDoc.data().passwords && Array.isArray(pinDoc.data().passwords)) {
          adminPins = pinDoc.data().passwords;
          console.log('âœ… Admin ÅŸifreleri Firebase\'den yÃ¼klendi');
        } else {
          // Ä°lk kullanÄ±m - varsayÄ±lan ÅŸifreleri Firebase'e kaydet
          await db.collection('admin').doc('pin').set({
            passwords: adminPins,
            updated_at: firebase.firestore.FieldValue.serverTimestamp()
          });
          console.log('âœ… VarsayÄ±lan ÅŸifreler Firebase\'e kaydedildi');
        }
      } catch (error) {
        console.error('âŒ Åifre yÃ¼kleme hatasÄ±:', error);
        // Hata durumunda varsayÄ±lan ÅŸifreleri kullan
      }
    }
    
    // Åifreyi Firebase'e kaydet (mevcut ÅŸifreyi yeni ÅŸifre ile deÄŸiÅŸtir)
    async function saveAdminPin(currentPin, newPin) {
      try {
        // Mevcut ÅŸifreyi bul ve deÄŸiÅŸtir
        const pinIndex = adminPins.indexOf(currentPin);
        if (pinIndex === -1) {
          console.error('âŒ Mevcut ÅŸifre bulunamadÄ±');
          return false;
        }
        
        adminPins[pinIndex] = newPin;
        
        await db.collection('admin').doc('pin').set({
          passwords: adminPins,
          updated_at: firebase.firestore.FieldValue.serverTimestamp()
        });
        console.log('âœ… Åifre baÅŸarÄ±yla gÃ¼ncellendi');
        return true;
      } catch (error) {
        console.error('âŒ Åifre kaydetme hatasÄ±:', error);
        return false;
      }
    }

    function showLogin() {
      const loginSection = document.getElementById('loginSection');
      const dashboard = document.getElementById('dashboard');
      if (loginSection) loginSection.style.display = 'block';
      if (dashboard) dashboard.style.display = 'none';
      if (realtimeUnsubscribe) {
        realtimeUnsubscribe();
        realtimeUnsubscribe = null;
      }
    }

    function showDashboard() {
      const loginSection = document.getElementById('loginSection');
      const dashboard = document.getElementById('dashboard');
      if (loginSection) loginSection.style.display = 'none';
      if (dashboard) dashboard.style.display = 'block';
      // Ä°lk yÃ¼klemede sadece satÄ±ÅŸlarÄ± yÃ¼kle, listener'lar renderCurrentView'da baÅŸlatÄ±lacak
      loadSales();
      loadCancels(); // Cache'den yÃ¼klemeyi dene
      renderCurrentView(); // Listener'larÄ± baÅŸlat
    }

    function verifyPin() {
      const pinInput = document.getElementById('pinInput');
      if (!pinInput) return;
      
      const pin = pinInput.value;
      const rememberMe = document.getElementById('rememberMe');
      const shouldRemember = rememberMe && rememberMe.checked;
      
      // Åifrelerden herhangi biri ile eÅŸleÅŸiyor mu kontrol et
      if (adminPins.includes(pin)) {
        isAuthenticated = true;
        sessionStorage.setItem('adminAuthenticated', 'true');
        
        // Beni HatÄ±rla seÃ§iliyse localStorage'a kaydet
        if (shouldRemember) {
          localStorage.setItem('adminRememberMe', 'true');
          localStorage.setItem('adminAuthenticated', 'true');
        } else {
          // SeÃ§ili deÄŸilse localStorage'Ä± temizle
          localStorage.removeItem('adminRememberMe');
          localStorage.removeItem('adminAuthenticated');
        }
        
        showDashboard();
        pinInput.value = '';
      } else {
        alert('PIN hatalÄ±!');
        pinInput.value = '';
      }
    }

    // Sayfa yÃ¼klendiÄŸinde kontrol et
    window.addEventListener('load', () => {
      // Splash screen'i gÃ¶ster
      const loader = document.getElementById('loader');
      if (loader) {
        loader.style.display = 'flex';
      }

      // 2.5 saniye sonra splash screen'i kapat
      setTimeout(() => {
        if (loader) {
          loader.style.opacity = '0';
          loader.style.transition = 'opacity 0.5s ease';
          setTimeout(() => {
            loader.style.display = 'none';
            
            // Firebase kontrolÃ¼ ve dashboard gÃ¶sterimi
            if (!db) {
              console.error('âŒ Ana Firebase baÅŸlatÄ±lamadÄ±');
              return;
            }
            
            if (!tablesDb) {
              console.warn('âš ï¸ Masalar Firebase baÅŸlatÄ±lamadÄ± - masalar bÃ¶lÃ¼mÃ¼ Ã§alÄ±ÅŸmayabilir');
            } else {
              console.log('âœ… Masalar Firebase hazÄ±r');
            }
            
            // Ã–nce localStorage'Ä± kontrol et (Beni HatÄ±rla aktifse)
            if (localStorage.getItem('adminRememberMe') === 'true' && localStorage.getItem('adminAuthenticated') === 'true') {
              isAuthenticated = true;
              sessionStorage.setItem('adminAuthenticated', 'true');
              showDashboard();
            } else if (sessionStorage.getItem('adminAuthenticated') === 'true') {
              showDashboard();
            } else {
              showLogin();
            }
            
            // Bildirim geÃ§miÅŸini yÃ¼kle
            loadNotificationsHistory();
            
            // GÃ¼nlÃ¼k ciro bildirim durumunu yÃ¼kle
            loadRevenueNotificationState();
            
            // Sessize al durumunu yÃ¼kle
            loadNotificationsMuteState();
            
            // Push notification izni iste (sayfa yÃ¼klendiÄŸinde)
            requestNotificationPermission();
            
            // Admin ÅŸifrelerini Firebase'den yÃ¼kle
            loadAdminPins();
            
            // Online sipariÅŸler listener'Ä±nÄ± baÅŸlat (eÄŸer Firebase baÄŸlantÄ±sÄ± hazÄ±rsa)
            if (onlineDb) {
              console.log('ğŸ“¡ Online sipariÅŸler listener baÅŸlatÄ±lÄ±yor (window.load event)...');
              setTimeout(() => {
                if (typeof startOnlineOrdersListener === 'function') {
                  startOnlineOrdersListener();
                } else {
                  console.warn('âš ï¸ startOnlineOrdersListener fonksiyonu henÃ¼z tanÄ±mlanmamÄ±ÅŸ');
                }
              }, 1000);
            } else {
              console.warn('âš ï¸ Online Firebase baÄŸlantÄ±sÄ± hazÄ±r deÄŸil, listener baÅŸlatÄ±lamadÄ±');
            }
          }, 500);
        }
      }, 2500);
    });

    // SatÄ±ÅŸlarÄ± yÃ¼kle
    async function loadSales() {
      if (!db) {
        console.error('Firebase baÅŸlatÄ±lamadÄ±');
        return;
      }

      // Ã–nce cache'den kontrol et
      try {
        const cachedSales = localStorage.getItem('sales_cache');
        const cacheTimestamp = localStorage.getItem('sales_cache_timestamp');
        const now = Date.now();
        
        // Cache 2 dakikadan yeni ise kullan (read quota tasarrufu iÃ§in)
        if (cachedSales && cacheTimestamp && (now - parseInt(cacheTimestamp)) < 2 * 60 * 1000) {
          const sales = JSON.parse(cachedSales);
          allSales = sales;
          renderCurrentView();
          updateStats(sales);
          showLoading(false);
          
          // Cache'den yÃ¼klendi, arka planda gÃ¼ncelle
          // Real-time listener zaten gÃ¼ncelleyecek
          return;
        }
      } catch (e) {
        console.warn('Cache okuma hatasÄ±:', e);
      }

      try {
        showLoading(true);
        const salesRef = db.collection('sales');
        
        // created_at veya timestamp'e gÃ¶re sÄ±rala (sale_date string olduÄŸu iÃ§in doÄŸru sÄ±ralama yapmaz)
        // Limit'i dÃ¼ÅŸÃ¼rdÃ¼k: 5000 -> 500 (read quota tasarrufu iÃ§in)
        let query = salesRef;
        try {
          query = salesRef.orderBy('created_at', 'desc').limit(500);
        } catch (e) {
          try {
            query = salesRef.orderBy('timestamp', 'desc').limit(500);
          } catch (e2) {
            // Son Ã§are: limit ile al, sonra JavaScript'te sÄ±rala
            query = salesRef.limit(500);
          }
        }
        
        const querySnapshot = await query.get();
        
        const sales = [];
        querySnapshot.forEach((doc) => {
          const data = doc.data();
          
          // Timestamp'i dÃ¶nÃ¼ÅŸtÃ¼r
          let saleDate = data.sale_date;
          let saleTime = data.sale_time;
          
          // created_at timestamp'ini al (sÄ±ralama iÃ§in)
          let createdAt = null;
          if (data.created_at) {
            const timestamp = data.created_at;
            createdAt = timestamp.toDate ? timestamp.toDate() : new Date(timestamp.seconds * 1000);
          } else if (data.timestamp) {
            const timestamp = data.timestamp;
            createdAt = timestamp.toDate ? timestamp.toDate() : new Date(timestamp.seconds * 1000);
          }
          
          // EÄŸer sale_date yoksa, created_at veya timestamp'ten oluÅŸtur
          if (!saleDate && createdAt) {
            saleDate = createdAt.toLocaleDateString('tr-TR');
            saleTime = createdAt.toLocaleTimeString('tr-TR');
          }
          
          // Items'Ä± parse et
          let items = [];
          let itemsArray = data.items_array || [];
          
          if (data.items) {
            if (Array.isArray(data.items)) {
              items = data.items;
            } else if (typeof data.items === 'string') {
              // String formatÄ±: "ÃœrÃ¼n AdÄ± x2, ÃœrÃ¼n AdÄ± 2 x3"
              items = data.items.split(', ').map(item => {
                const match = item.match(/(.+) x(\d+)/);
                if (match) {
                  return {
                    product_name: match[1].replace(' (Ä°KRAM)', ''),
                    quantity: parseInt(match[2]),
                    isGift: item.includes('(Ä°KRAM)')
                  };
                }
                return { product_name: item, quantity: 1, isGift: false };
              });
            }
          }
          
          sales.push({
            id: doc.id,
            sale_id: data.sale_id || doc.id,
            total_amount: data.total_amount || 0,
            payment_method: data.payment_method || 'Nakit',
            sale_date: saleDate || 'Bilinmeyen',
            sale_time: saleTime || '',
            staff_name: data.staff_name || null,
            table_name: data.table_name || null,
            table_type: data.table_type || null,
            items: items,
            items_array: itemsArray, // GerÃ§ek Firebase verileri
            itemsText: data.items || 'ÃœrÃ¼n bulunamadÄ±',
            isExpense: data.isExpense === true || data.isExpense === 'true' || data.payment_method === 'Masraf',
            created_at: createdAt // SÄ±ralama iÃ§in timestamp
          });
        });

        // Tarih + saate gÃ¶re sÄ±rala (en yeni satÄ±ÅŸ en Ã¼stte)
        sales.sort((a, b) => {
          // Ã–nce created_at timestamp'ini kullan (en doÄŸru sÄ±ralama)
          if (a.created_at && b.created_at) {
            return b.created_at.getTime() - a.created_at.getTime();
          }
          if (a.created_at) return -1; // a daha yeni
          if (b.created_at) return 1;  // b daha yeni
          
          // created_at yoksa sale_date ve sale_time kullan
          if (a.sale_date && b.sale_date) {
            const [dayA, monthA, yearA] = a.sale_date.split('.');
            const [dayB, monthB, yearB] = b.sale_date.split('.');
            if (dayA && monthA && yearA && dayB && monthB && yearB) {
              const dateA = new Date(yearA, monthA - 1, dayA);
              const dateB = new Date(yearB, monthB - 1, dayB);
              
              if (a.sale_time) {
                const [hA, mA, sA] = a.sale_time.split(':');
                dateA.setHours(parseInt(hA) || 0, parseInt(mA) || 0, parseInt(sA) || 0, 0);
              }
              if (b.sale_time) {
                const [hB, mB, sB] = b.sale_time.split(':');
                dateB.setHours(parseInt(hB) || 0, parseInt(mB) || 0, parseInt(sB) || 0, 0);
              }
              
              const diff = dateB.getTime() - dateA.getTime();
              if (diff !== 0) return diff;
            }
          }
          
          // Tarih/saat yoksa veya eÅŸitse, sale_id'ye gÃ¶re (bÃ¼yÃ¼kten kÃ¼Ã§Ã¼ÄŸe) sÄ±rala
          const idA = parseInt(a.sale_id || a.id) || 0;
          const idB = parseInt(b.sale_id || b.id) || 0;
          return idB - idA;
        });

        allSales = sales; // TÃ¼m satÄ±ÅŸlarÄ± sakla
        
        // Cache'e kaydet (read quota tasarrufu iÃ§in)
        try {
          localStorage.setItem('sales_cache', JSON.stringify(sales));
          localStorage.setItem('sales_cache_timestamp', Date.now().toString());
        } catch (e) {
          console.warn('Cache yazma hatasÄ±:', e);
        }
        
        // Ä°ptal kayÄ±tlarÄ±nÄ± yÃ¼kle
        loadCancels();
        
        renderCurrentView();
        updateStats(sales);
        showLoading(false);
      } catch (error) {
        console.error('SatÄ±ÅŸ yÃ¼kleme hatasÄ±:', error);
        showLoading(false);
        const container = document.getElementById('salesContainer');
        if (container) {
          container.innerHTML = `
            <div class="error-card">
              <div class="error-icon">âš ï¸</div>
              <h3>BaÄŸlantÄ± HatasÄ±</h3>
              <p>${error.message || 'Firebase\'e baÄŸlanÄ±lamadÄ±'}</p>
              <button onclick="location.reload()" class="retry-btn">ğŸ”„ Yeniden Dene</button>
            </div>
          `;
        }
      }
    }

    // Ä°ptal kayÄ±tlarÄ±nÄ± yÃ¼kle (cache ile)
    async function loadCancels() {
      if (!db) return;
      
      // Ã–nce cache'den kontrol et
      try {
        const cachedCancels = localStorage.getItem('cancels_cache');
        const cacheTimestamp = localStorage.getItem('cancels_cache_timestamp');
        const now = Date.now();
        
        // Cache 5 dakikadan yeni ise kullan
        if (cachedCancels && cacheTimestamp && (now - parseInt(cacheTimestamp)) < 5 * 60 * 1000) {
          allCancels = JSON.parse(cachedCancels);
          if (allSales.length > 0) {
            updateStats(allSales);
          }
          return; // Cache'den yÃ¼klendi, Firebase'e gitme
        }
      } catch (e) {
        console.warn('Cache okuma hatasÄ±:', e);
      }
      
      try {
        const cancelsRef = db.collection('cancels');
        // Son 1000 iptali al (read quota tasarrufu iÃ§in)
        const querySnapshot = await cancelsRef.orderBy('created_at', 'desc').limit(1000).get();
        const cancels = [];
        
        querySnapshot.forEach((doc) => {
          const data = doc.data();
          cancels.push({
            id: doc.id,
            cancel_date: data.cancel_date || '',
            cancel_time: data.cancel_time || '',
            quantity: parseFloat(data.quantity || 0),
            price: parseFloat(data.price || 0),
            ...data
          });
        });
        
        allCancels = cancels;
        
        // Cache'e kaydet
        try {
          localStorage.setItem('cancels_cache', JSON.stringify(cancels));
          localStorage.setItem('cancels_cache_timestamp', Date.now().toString());
        } catch (e) {
          console.warn('Cache yazma hatasÄ±:', e);
        }
        
        // Ä°ptal kayÄ±tlarÄ± yÃ¼klendikten sonra istatistikleri gÃ¼ncelle
        if (allSales.length > 0) {
          updateStats(allSales);
        }
      } catch (error) {
        console.error('Ä°ptal kayÄ±tlarÄ± yÃ¼kleme hatasÄ±:', error);
        allCancels = [];
      }
    }
    
    // Ä°ptal kayÄ±tlarÄ±nÄ± real-time dinle (sadece aktif sekmede)
    let cancelsUnsubscribe = null;
    function startCancelsListener() {
      if (!db) return;
      
      // Zaten bir listener varsa, yeni bir tane oluÅŸturma
      if (cancelsUnsubscribe) {
        return;
      }
      
      const cancelsRef = db.collection('cancels');
      // Son 1000 iptali dinle (read quota tasarrufu iÃ§in)
      cancelsUnsubscribe = cancelsRef.orderBy('created_at', 'desc').limit(1000).onSnapshot((snapshot) => {
        const cancels = [];
        snapshot.forEach((doc) => {
          const data = doc.data();
          cancels.push({
            id: doc.id,
            cancel_date: data.cancel_date || '',
            cancel_time: data.cancel_time || '',
            quantity: parseFloat(data.quantity || 0),
            price: parseFloat(data.price || 0),
            ...data
          });
        });
        
        allCancels = cancels;
        
        // Cache'e kaydet
        try {
          localStorage.setItem('cancels_cache', JSON.stringify(cancels));
          localStorage.setItem('cancels_cache_timestamp', Date.now().toString());
        } catch (e) {
          console.warn('Cache yazma hatasÄ±:', e);
        }
        
        // Ä°ptal kayÄ±tlarÄ± gÃ¼ncellendiÄŸinde istatistikleri gÃ¼ncelle
        // Sadece "SatÄ±ÅŸ GeÃ§miÅŸi" sekmesinde gÃ¶rÃ¼nÃ¼rse gÃ¼ncelle
        if (activeTab === 'sales' && allSales.length > 0) {
          updateStats(allSales);
        }
      }, (error) => {
        console.error('Ä°ptal kayÄ±tlarÄ± real-time listener hatasÄ±:', error);
      });
    }

    // Real-time dinleme
    function startRealtimeListener() {
      if (!db) return;
      
      // Zaten bir listener varsa, yeni bir tane oluÅŸturma
      if (realtimeUnsubscribe) {
        return;
      }

      const salesRef = db.collection('sales');
      let query = salesRef;
      try {
        // Limit'i dÃ¼ÅŸÃ¼rdÃ¼k: 5000 -> 500 (read quota tasarrufu iÃ§in)
        // Sadece son 500 satÄ±ÅŸÄ± dinle, geri kalanÄ± cache'den al
        query = salesRef.orderBy('created_at', 'desc').limit(500);
      } catch (e) {
        try {
          query = salesRef.orderBy('timestamp', 'desc').limit(500);
        } catch (e2) {
          // Son Ã§are: limit ile al, sonra JavaScript'te sÄ±rala
          query = salesRef.limit(500);
        }
      }
      
      realtimeUnsubscribe = query.onSnapshot((snapshot) => {
        const sales = [];
        snapshot.forEach((doc) => {
          const data = doc.data();
          
          // created_at timestamp'ini al (sÄ±ralama iÃ§in)
          let createdAt = null;
          if (data.created_at) {
            const timestamp = data.created_at;
            createdAt = timestamp.toDate ? timestamp.toDate() : new Date(timestamp.seconds * 1000);
          } else if (data.timestamp) {
            const timestamp = data.timestamp;
            createdAt = timestamp.toDate ? timestamp.toDate() : new Date(timestamp.seconds * 1000);
          }
          
          let saleDate = data.sale_date;
          let saleTime = data.sale_time;
          
          if (!saleDate && createdAt) {
            saleDate = createdAt.toLocaleDateString('tr-TR');
            saleTime = createdAt.toLocaleTimeString('tr-TR');
          }
          
          let items = [];
          let itemsArray = data.items_array || [];
          
          if (data.items) {
            if (Array.isArray(data.items)) {
              items = data.items;
            } else if (typeof data.items === 'string') {
              items = data.items.split(', ').map(item => {
                const match = item.match(/(.+) x(\d+)/);
                if (match) {
                  return {
                    product_name: match[1].replace(' (Ä°KRAM)', ''),
                    quantity: parseInt(match[2]),
                    isGift: item.includes('(Ä°KRAM)')
                  };
                }
                return { product_name: item, quantity: 1, isGift: false };
              });
            }
          }
          
          sales.push({
            id: doc.id,
            sale_id: data.sale_id || doc.id,
            total_amount: data.total_amount || 0,
            payment_method: data.payment_method || 'Nakit',
            sale_date: saleDate || 'Bilinmeyen',
            sale_time: saleTime || '',
            staff_name: data.staff_name || null,
            table_name: data.table_name || null,
            table_type: data.table_type || null,
            items: items,
            items_array: itemsArray, // GerÃ§ek Firebase verileri
            itemsText: data.items || 'ÃœrÃ¼n bulunamadÄ±',
            isExpense: data.isExpense === true || data.isExpense === 'true' || data.payment_method === 'Masraf',
            created_at: createdAt // SÄ±ralama iÃ§in timestamp
          });
        });

        sales.sort((a, b) => {
          // Ã–nce created_at timestamp'ini kullan (en doÄŸru sÄ±ralama)
          if (a.created_at && b.created_at) {
            return b.created_at.getTime() - a.created_at.getTime();
          }
          if (a.created_at) return -1; // a daha yeni
          if (b.created_at) return 1;  // b daha yeni
          
          // created_at yoksa sale_date kullan
          if (!a.sale_date || !b.sale_date) return 0;
          const [dayA, monthA, yearA] = a.sale_date.split('.');
          const [dayB, monthB, yearB] = b.sale_date.split('.');
          if (!dayA || !dayB) return 0;
          const dateA = new Date(yearA, monthA - 1, dayA);
          const dateB = new Date(yearB, monthB - 1, dayB);
          return dateB.getTime() - dateA.getTime();
        });

        allSales = sales; // TÃ¼m satÄ±ÅŸlarÄ± sakla
        
        // Cache'e kaydet (read quota tasarrufu iÃ§in)
        try {
          localStorage.setItem('sales_cache', JSON.stringify(sales));
          localStorage.setItem('sales_cache_timestamp', Date.now().toString());
        } catch (e) {
          console.warn('Cache yazma hatasÄ±:', e);
        }
        
        // Sadece "SatÄ±ÅŸ GeÃ§miÅŸi" sekmesindeyse gÃ¶rÃ¼nÃ¼mÃ¼ render et ve istatistikleri gÃ¼ncelle
        if (activeTab === 'sales') {
          renderCurrentView();
          updateStats(sales);
        }
        // DiÄŸer sekmelerde sadece istatistikleri gÃ¼ncelle (gÃ¶rÃ¼nÃ¼mÃ¼ render etme)
        // BÃ¶ylece masa sipariÅŸi kaydedildiÄŸinde veya iptal olduÄŸunda anlÄ±k gÃ¼ncellenir
        // Not: updateStats sadece "SatÄ±ÅŸ GeÃ§miÅŸi" sekmesinde gÃ¶rÃ¼nÃ¼r, bu yÃ¼zden burada Ã§aÄŸÄ±rmaya gerek yok
      }, (error) => {
        console.error('Real-time listener hatasÄ±:', error);
      });
    }

    // Tarihi formatla
    function formatDateDisplay(dateStr) {
      if (!dateStr || dateStr === 'Bilinmeyen') return dateStr;
      const [day, month, year] = dateStr.split('.');
      if (!day || !month || !year) return dateStr;
      
      const date = new Date(year, month - 1, day);
      const days = ['Pazar', 'Pazartesi', 'SalÄ±', 'Ã‡arÅŸamba', 'PerÅŸembe', 'Cuma', 'Cumartesi'];
      const months = ['Ocak', 'Åubat', 'Mart', 'Nisan', 'MayÄ±s', 'Haziran', 'Temmuz', 'AÄŸustos', 'EylÃ¼l', 'Ekim', 'KasÄ±m', 'AralÄ±k'];
      
      const dayName = days[date.getDay()];
      const monthName = months[parseInt(month) - 1];
      
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const saleDate = new Date(year, month - 1, day);
      saleDate.setHours(0, 0, 0, 0);
      
      const yesterday = new Date(today);
      yesterday.setDate(yesterday.getDate() - 1);
      
      if (saleDate.getTime() === today.getTime()) {
        return `BugÃ¼n - ${day} ${monthName} ${year}`;
      } else if (saleDate.getTime() === yesterday.getTime()) {
        return `DÃ¼n - ${day} ${monthName} ${year}`;
      } else {
        return `${day} ${monthName} ${year} - ${dayName}`;
      }
    }

    // SatÄ±ÅŸlarÄ± tarih filtresine gÃ¶re filtrele
    function filterSalesByDateForHistory(sales) {
      const now = new Date();
      now.setHours(23, 59, 59, 999);
      
      if (salesDateFilter === 'yesterday') {
        const yesterday = new Date(now);
        yesterday.setDate(yesterday.getDate() - 1);
        yesterday.setHours(0, 0, 0, 0);
        const yesterdayEnd = new Date(yesterday);
        yesterdayEnd.setHours(23, 59, 59, 999);
        
        return sales.filter(sale => {
          if (!sale.sale_date || sale.sale_date === 'Bilinmeyen') return false;
          const [day, month, year] = sale.sale_date.split('.');
          if (!day || !month || !year) return false;
          const saleDate = new Date(year, month - 1, day);
          saleDate.setHours(0, 0, 0, 0);
          return saleDate >= yesterday && saleDate <= yesterdayEnd;
        });
      } else if (salesDateFilter === 'week') {
        const weekAgo = new Date(now);
        weekAgo.setDate(weekAgo.getDate() - 7);
        weekAgo.setHours(0, 0, 0, 0);
        
        return sales.filter(sale => {
          if (!sale.sale_date || sale.sale_date === 'Bilinmeyen') return false;
          const [day, month, year] = sale.sale_date.split('.');
          if (!day || !month || !year) return false;
          const saleDate = new Date(year, month - 1, day);
          saleDate.setHours(0, 0, 0, 0);
          return saleDate >= weekAgo && saleDate <= now;
        });
      } else if (salesDateFilter === 'month') {
        const monthAgo = new Date(now);
        monthAgo.setMonth(monthAgo.getMonth() - 1);
        monthAgo.setHours(0, 0, 0, 0);
        
        return sales.filter(sale => {
          if (!sale.sale_date || sale.sale_date === 'Bilinmeyen') return false;
          const [day, month, year] = sale.sale_date.split('.');
          if (!day || !month || !year) return false;
          const saleDate = new Date(year, month - 1, day);
          saleDate.setHours(0, 0, 0, 0);
          return saleDate >= monthAgo && saleDate <= now;
        });
      } else if (salesDateFilter === 'custom' && salesCustomDateRange.start && salesCustomDateRange.end) {
        const startDate = new Date(salesCustomDateRange.start);
        startDate.setHours(0, 0, 0, 0);
        const endDate = new Date(salesCustomDateRange.end);
        endDate.setHours(23, 59, 59, 999);
        
        return sales.filter(sale => {
          if (!sale.sale_date || sale.sale_date === 'Bilinmeyen') return false;
          const [day, month, year] = sale.sale_date.split('.');
          if (!day || !month || !year) return false;
          const saleDate = new Date(year, month - 1, day);
          saleDate.setHours(0, 0, 0, 0);
          return saleDate >= startDate && saleDate <= endDate;
        });
      }
      
      return sales; // 'all' iÃ§in tÃ¼m satÄ±ÅŸlar
    }

    // SatÄ±ÅŸlarÄ± render et (lazy loading ile)
    function renderSales(sales, resetCount = false) {
      const container = document.getElementById('salesContainer');
      if (!container) return;

      // Tarih filtresi deÄŸiÅŸtiÄŸinde sayacÄ± sÄ±fÄ±rla
      if (resetCount) {
        salesDisplayedCount = 10;
      }

      // Tarih filtresine gÃ¶re filtrele
      const filteredSales = filterSalesByDateForHistory(sales);

      // Header ve tarih filtresi butonu
      const filterLabels = {
        'all': 'TÃ¼m Zamanlar',
        'yesterday': 'DÃ¼n',
        'week': 'Son 1 Hafta',
        'month': 'Son 1 Ay',
        'custom': salesCustomDateRange.start && salesCustomDateRange.end 
          ? `${salesCustomDateRange.start.toLocaleDateString('tr-TR')} - ${salesCustomDateRange.end.toLocaleDateString('tr-TR')}`
          : 'Ã–zel Tarih'
      };

      let html = `
        <div id="salesHeader" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding: 0 4px;">
          <h2 style="font-size: 18px; font-weight: 700; color: #1f2937; margin: 0;">SatÄ±ÅŸ GeÃ§miÅŸi</h2>
          <div class="date-filter-wrapper">
            <button class="date-filter-trigger" onclick="toggleSalesDateFilterModal(event)">
              <span>ğŸ“…</span>
              <span id="salesDateFilterLabel">${filterLabels[salesDateFilter] || 'TÃ¼m Zamanlar'}</span>
              <span class="date-filter-arrow">â–¼</span>
            </button>
            <div id="salesDateFilterModal" class="date-filter-modal">
              <div class="date-filter-modal-content">
                <div class="date-filter-option ${salesDateFilter === 'yesterday' ? 'active' : ''}" onclick="setSalesDateFilter('yesterday'); closeSalesDateFilterModal();">
                  <span class="date-filter-icon">ğŸ“†</span>
                  <span>DÃ¼n</span>
                </div>
                <div class="date-filter-option ${salesDateFilter === 'week' ? 'active' : ''}" onclick="setSalesDateFilter('week'); closeSalesDateFilterModal();">
                  <span class="date-filter-icon">ğŸ“…</span>
                  <span>Son 1 Hafta</span>
                </div>
                <div class="date-filter-option ${salesDateFilter === 'month' ? 'active' : ''}" onclick="setSalesDateFilter('month'); closeSalesDateFilterModal();">
                  <span class="date-filter-icon">ğŸ“…</span>
                  <span>Son 1 Ay</span>
                </div>
                <div class="date-filter-option ${salesDateFilter === 'all' ? 'active' : ''}" onclick="setSalesDateFilter('all'); closeSalesDateFilterModal();">
                  <span class="date-filter-icon">ğŸ“Š</span>
                  <span>TÃ¼m Zamanlar</span>
                </div>
                <div class="date-filter-divider"></div>
                <div class="date-filter-option ${salesDateFilter === 'custom' ? 'active' : ''}" onclick="document.getElementById('salesCustomDateRangeSection').style.display = 'block';">
                  <span class="date-filter-icon">ğŸ—“ï¸</span>
                  <span>Ã–zel Tarih AralÄ±ÄŸÄ±</span>
                </div>
                <div id="salesCustomDateRangeSection" class="custom-date-range-section" style="display: ${salesDateFilter === 'custom' ? 'block' : 'none'};">
                  <div class="custom-date-inputs">
                    <div class="custom-date-input-group">
                      <label>BaÅŸlangÄ±Ã§:</label>
                      <input type="date" id="salesCustomDateStart" value="${salesCustomDateRange.start ? formatDateForInput(salesCustomDateRange.start) : ''}">
                    </div>
                    <div class="custom-date-input-group">
                      <label>BitiÅŸ:</label>
                      <input type="date" id="salesCustomDateEnd" value="${salesCustomDateRange.end ? formatDateForInput(salesCustomDateRange.end) : ''}">
                    </div>
                  </div>
                  <button onclick="setSalesCustomDateRange()" class="custom-date-apply-btn">Uygula</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;

      if (filteredSales.length === 0) {
        html += `
          <div class="empty-state">
            <div class="empty-icon">ğŸ“Š</div>
            <h3>SeÃ§ilen Tarih AralÄ±ÄŸÄ±nda SatÄ±ÅŸ Yok</h3>
            <p>FarklÄ± bir tarih aralÄ±ÄŸÄ± seÃ§meyi deneyin</p>
          </div>
        `;
        container.innerHTML = html;
        return;
      }

      // TÃ¼m satÄ±ÅŸlarÄ± dÃ¼z bir listeye Ã§evir (tarih gruplarÄ± olmadan, lazy loading iÃ§in)
      const allSalesFlat = [];
      filteredSales.forEach(sale => {
        allSalesFlat.push({
          ...sale,
          sale_date_for_group: sale.sale_date || 'Bilinmeyen'
        });
      });

      // SatÄ±ÅŸlarÄ± sÄ±rala (en yeni Ã¶nce)
      allSalesFlat.sort((a, b) => {
        // Ã–nce tarih
        const dateA = a.sale_date || 'Bilinmeyen';
        const dateB = b.sale_date || 'Bilinmeyen';
        if (dateA !== dateB) {
          if (dateA === 'Bilinmeyen') return 1;
          if (dateB === 'Bilinmeyen') return -1;
          const [dayA, monthA, yearA] = dateA.split('.');
          const [dayB, monthB, yearB] = dateB.split('.');
          if (!dayA || !dayB) return 0;
          const dateObjA = new Date(yearA, monthA - 1, dayA);
          const dateObjB = new Date(yearB, monthB - 1, dayB);
          if (dateObjB.getTime() !== dateObjA.getTime()) {
            return dateObjB.getTime() - dateObjA.getTime();
          }
        }
        
        // Sonra saat
        if (a.sale_time && b.sale_time) {
          const [hA, mA, sA] = a.sale_time.split(':').map(Number);
          const [hB, mB, sB] = b.sale_time.split(':').map(Number);
          const timeA = (hA || 0) * 3600 + (mA || 0) * 60 + (sA || 0);
          const timeB = (hB || 0) * 3600 + (mB || 0) * 60 + (sB || 0);
          if (timeB !== timeA) return timeB - timeA;
        }
        
        // Son olarak sale_id
        const idA = parseInt(a.sale_id || a.id || 0);
        const idB = parseInt(b.sale_id || b.id || 0);
        return idB - idA;
      });

      // Lazy loading: Sadece gÃ¶sterilecek kadar satÄ±ÅŸ al
      const salesToDisplay = allSalesFlat.slice(0, salesDisplayedCount);
      const hasMore = allSalesFlat.length > salesDisplayedCount;

      // GÃ¶sterilecek satÄ±ÅŸlarÄ± tarihe gÃ¶re grupla
      const salesByDate = {};
      salesToDisplay.forEach(sale => {
        const date = sale.sale_date || 'Bilinmeyen';
        if (!salesByDate[date]) {
          salesByDate[date] = [];
        }
        salesByDate[date].push(sale);
      });

      // Tarihleri sÄ±rala
      const sortedDates = Object.keys(salesByDate).sort((a, b) => {
        if (a === 'Bilinmeyen') return 1;
        if (b === 'Bilinmeyen') return -1;
        const [dayA, monthA, yearA] = a.split('.');
        const [dayB, monthB, yearB] = b.split('.');
        if (!dayA || !dayB) return 0;
        const dateA = new Date(yearA, monthA - 1, dayA);
        const dateB = new Date(yearB, monthB - 1, dayB);
        return dateB - dateA;
      });
      
      sortedDates.forEach(date => {
        let daySales = salesByDate[date];
        
        // Her tarih grubu iÃ§indeki satÄ±ÅŸlarÄ± saat bilgisine gÃ¶re sÄ±rala (en yeni Ã¶nce)
        daySales.sort((a, b) => {
          // Ã–nce saat bilgisine gÃ¶re sÄ±rala
          if (a.sale_time && b.sale_time) {
            const [hA, mA, sA] = a.sale_time.split(':').map(Number);
            const [hB, mB, sB] = b.sale_time.split(':').map(Number);
            const timeA = (hA || 0) * 3600 + (mA || 0) * 60 + (sA || 0);
            const timeB = (hB || 0) * 3600 + (mB || 0) * 60 + (sB || 0);
            if (timeB !== timeA) return timeB - timeA; // En yeni saat Ã¶nce
          }
          
          // Saat bilgisi yoksa veya eÅŸitse sale_id'ye gÃ¶re sÄ±rala (bÃ¼yÃ¼kten kÃ¼Ã§Ã¼ÄŸe)
          const idA = parseInt(a.sale_id || a.id || 0);
          const idB = parseInt(b.sale_id || b.id || 0);
          return idB - idA;
        });
        
        // MasraflarÄ± hariÃ§ tut
        const dayTotal = daySales
          .filter(sale => !sale.isExpense && sale.payment_method !== 'Masraf')
          .reduce((sum, sale) => sum + parseFloat(sale.total_amount || 0), 0);
        
        html += `
          <div class="date-group">
            <div class="date-header">
              <div>
                <div class="date-title-wrapper">
                  <div class="date-icon">ğŸ“…</div>
                  <div>
                    <h2 class="date-title">${formatDateDisplay(date)}</h2>
                  </div>
                </div>
              </div>
              <div class="date-stats">
                <div class="date-stat-item">
                  <span class="date-stat-label">SatÄ±ÅŸ</span>
                  <span class="date-stat-value">${daySales.length}</span>
                </div>
                <div class="date-stat-item">
                  <span class="date-stat-label">Toplam</span>
                  <span class="date-stat-value amount">â‚º${dayTotal.toFixed(2)}</span>
                </div>
              </div>
            </div>
            <div class="sales-grid">
              ${daySales.map(sale => {
                // Masraf kontrolÃ¼ - birden fazla yÃ¶ntemle kontrol et
                const isExpense = sale.isExpense === true || 
                                  sale.isExpense === 'true' ||
                                  sale.payment_method === 'Masraf' ||
                                  (sale.items_array && sale.items_array.length > 0 && (
                                    sale.items_array[0].isExpense === true ||
                                    sale.items_array[0].isExpense === 'true' ||
                                    (sale.items_array[0].product_id && sale.items_array[0].product_id.toString().startsWith('expense-'))
                                  ));
                
                // Masraf ise farklÄ± gÃ¶rÃ¼nÃ¼m
                if (isExpense) {
                  const expenseTitle = sale.items_array && sale.items_array.length > 0 
                    ? sale.items_array[0].product_name 
                    : (sale.itemsText || sale.items || 'Masraf');
                  
                  return `
                    <div class="sale-card expense-card">
                      <div class="expense-header">
                        <div class="expense-info">
                          <h3 class="expense-title">${expenseTitle}</h3>
                          <p class="expense-time">${sale.sale_time || ''}</p>
                          <span class="badge badge-expense">ğŸ’° Masraf</span>
                        </div>
                        <div class="expense-amount">
                          <p class="expense-label">MÄ°KTAR</p>
                          <p class="expense-value">â‚º${parseFloat(sale.total_amount || 0).toFixed(2)}</p>
                        </div>
                      </div>
                    </div>
                  `;
                }
                
                // Normal satÄ±ÅŸ gÃ¶rÃ¼nÃ¼mÃ¼
                const itemsHtml = sale.items && sale.items.length > 0
                  ? sale.items.map(item => `
                    <div class="sale-item">
                      <span class="item-name">${item.product_name}</span>
                      <span class="item-quantity">x${item.quantity}</span>
                      ${item.isGift ? '<span class="gift-badge">Ä°KRAM</span>' : ''}
                    </div>
                  `).join('')
                  : `<div class="sale-item"><span class="item-name">${sale.itemsText || 'ÃœrÃ¼n bulunamadÄ±'}</span></div>`;
                
                return `
                <div class="sale-card">
                  <div class="sale-header">
                    <div class="sale-info">
                      <h3 class="sale-id">SatÄ±ÅŸ #${sale.sale_id || sale.id}</h3>
                      <p class="sale-time">${sale.sale_time || ''}</p>
                      <div class="sale-badges">
                        ${sale.payment_method && sale.payment_method.includes('Online SatÄ±ÅŸ') 
                          ? `<span class="badge badge-online">ğŸŒ ${sale.payment_method}</span>`
                          : `<span class="badge badge-${sale.payment_method === 'Nakit' ? 'cash' : 'card'}">
                              ${sale.payment_method === 'Nakit' ? 'ğŸ’µ Nakit' : 'ğŸ’³ Kart'}
                            </span>`
                        }
                        ${sale.staff_name ? `<span class="badge badge-staff">ğŸ‘¤ ${sale.staff_name}</span>` : ''}
                        ${sale.table_name ? `<span class="badge badge-table">ğŸª‘ ${sale.table_name}${sale.table_type ? ` (${sale.table_type})` : ''}</span>` : ''}
                      </div>
                    </div>
                    <div class="sale-total">
                      <p class="total-label">TOPLAM</p>
                      <p class="total-amount">â‚º${parseFloat(sale.total_amount || 0).toFixed(2)}</p>
                    </div>
                  </div>
                  <div class="sale-items">
                    <p class="items-label">ÃœrÃ¼nler:</p>
                    <div class="items-list">
                      ${itemsHtml}
                    </div>
                  </div>
                </div>
              `;
              }).join('')}
            </div>
          </div>
        `;
      });

      // "Daha fazla yÃ¼kle" butonu veya scroll indicator
      if (hasMore) {
        html += `
          <div id="salesLoadMore" style="text-align: center; padding: 20px; margin-top: 20px;">
            <button onclick="loadMoreSales()" style="padding: 12px 24px; background: #3b82f6; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s;">
              Daha Fazla YÃ¼kle (${allSalesFlat.length - salesDisplayedCount} kaldÄ±)
            </button>
          </div>
        `;
      }

      container.innerHTML = html;
      
      // Scroll event listener ekle (otomatik yÃ¼kleme iÃ§in)
      setupSalesScrollListener();
    }

    // Daha fazla satÄ±ÅŸ yÃ¼kle
    function loadMoreSales() {
      if (isLoadingMoreSales) return;
      isLoadingMoreSales = true;
      
      const loadMoreBtn = document.getElementById('salesLoadMore');
      if (loadMoreBtn) {
        loadMoreBtn.innerHTML = '<div style="padding: 12px; color: #6b7280;">YÃ¼kleniyor...</div>';
      }
      
      // 10'ar 10'ar artÄ±r
      salesDisplayedCount += 10;
      
      // KÄ±sa bir gecikme sonra render et (smooth loading iÃ§in)
      setTimeout(() => {
        renderSales(allSales, false);
        isLoadingMoreSales = false;
      }, 300);
    }

    // SatÄ±ÅŸ geÃ§miÅŸi iÃ§in scroll listener
    function setupSalesScrollListener() {
      // Eski listener'Ä± kaldÄ±r
      window.removeEventListener('scroll', handleSalesScroll);
      window.removeEventListener('scroll', handleSalesScroll, true);
      
      // Yeni listener ekle (window scroll iÃ§in)
      window.addEventListener('scroll', handleSalesScroll, true);
    }

    // SatÄ±ÅŸ scroll handler
    function handleSalesScroll(event) {
      if (isLoadingMoreSales || activeTab !== 'sales') return;
      
      const container = document.getElementById('salesContainer');
      if (!container) return;
      
      // Scroll pozisyonu kontrol et (alt kÄ±sma yaklaÅŸÄ±ldÄ±ÄŸÄ±nda)
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      const windowHeight = window.innerHeight;
      const documentHeight = document.documentElement.scrollHeight;
      const scrollBottom = documentHeight - scrollTop - windowHeight;
      
      // 200px kala daha fazla yÃ¼kle
      if (scrollBottom < 200) {
        const filteredSales = filterSalesByDateForHistory(allSales);
        if (salesDisplayedCount < filteredSales.length) {
          loadMoreSales();
        }
      }
    }

    // SatÄ±ÅŸ geÃ§miÅŸi tarih filtresini gÃ¼ncelle
    function updateSalesDateFilterButton() {
      const label = document.getElementById('salesDateFilterLabel');
      if (!label) return;

      const filterLabels = {
        'all': 'TÃ¼m Zamanlar',
        'yesterday': 'DÃ¼n',
        'week': 'Son 1 Hafta',
        'month': 'Son 1 Ay',
        'custom': salesCustomDateRange.start && salesCustomDateRange.end 
          ? `${salesCustomDateRange.start.toLocaleDateString('tr-TR')} - ${salesCustomDateRange.end.toLocaleDateString('tr-TR')}`
          : 'Ã–zel Tarih'
      };

      label.textContent = filterLabels[salesDateFilter] || 'TÃ¼m Zamanlar';
    }

    // SatÄ±ÅŸ geÃ§miÅŸi tarih filtresini deÄŸiÅŸtir
    function setSalesDateFilter(filter) {
      salesDateFilter = filter;
      renderSales(allSales, true); // resetCount = true (sayacÄ± sÄ±fÄ±rla)
      updateSalesDateFilterButton();
    }

    // SatÄ±ÅŸ geÃ§miÅŸi Ã¶zel tarih aralÄ±ÄŸÄ± seÃ§
    function setSalesCustomDateRange() {
      const startInput = document.getElementById('salesCustomDateStart');
      const endInput = document.getElementById('salesCustomDateEnd');
      
      if (!startInput || !endInput) return;
      
      const start = startInput.value;
      const end = endInput.value;
      
      if (!start || !end) {
        alert('LÃ¼tfen baÅŸlangÄ±Ã§ ve bitiÅŸ tarihlerini seÃ§in');
        return;
      }
      
      const startDate = parseDateFromInput(start);
      const endDate = parseDateFromInput(end);
      
      if (startDate > endDate) {
        alert('BaÅŸlangÄ±Ã§ tarihi bitiÅŸ tarihinden sonra olamaz');
        return;
      }
      
      salesCustomDateRange.start = startDate;
      salesCustomDateRange.end = endDate;
      salesDateFilter = 'custom';
      renderSales(allSales, true); // resetCount = true (sayacÄ± sÄ±fÄ±rla)
      updateSalesDateFilterButton();
      closeSalesDateFilterModal();
    }

    // SatÄ±ÅŸ geÃ§miÅŸi tarih filtresi modal'Ä±nÄ± aÃ§/kapa
    function toggleSalesDateFilterModal(event) {
      if (event) {
        event.stopPropagation();
      }
      const modal = document.getElementById('salesDateFilterModal');
      if (modal) {
        const isOpen = modal.classList.contains('show');
        // Ã–nce tÃ¼m modal'larÄ± kapat
        document.querySelectorAll('.date-filter-modal').forEach(m => m.classList.remove('show'));
        if (!isOpen) {
          modal.classList.add('show');
        }
      }
    }

    function closeSalesDateFilterModal() {
      const modal = document.getElementById('salesDateFilterModal');
      if (modal) {
        modal.classList.remove('show');
      }
      const customSection = document.getElementById('salesCustomDateRangeSection');
      if (customSection && salesDateFilter !== 'custom') {
        customSection.style.display = 'none';
      }
    }

    // Aktif masa sayÄ±sÄ±nÄ± hesapla (sadece iÃ§ ve dÄ±ÅŸ masalar)
    function calculateActiveTablesCount() {
      let activeCount = 0;
      
      // allStaticTables objesindeki tÃ¼m masalarÄ± kontrol et
      Object.values(allStaticTables).forEach(table => {
        // Sadece iÃ§ ve dÄ±ÅŸ masalarÄ± say (paket masalarÄ±nÄ± hariÃ§ tut)
        const tableId = table.table_id || '';
        const isInsideOrOutside = tableId.startsWith('inside-') || tableId.startsWith('outside-');
        const isPackage = tableId.startsWith('package-');
        
        if (isInsideOrOutside && !isPackage) {
          // Masa dolu mu kontrol et
          const isOccupied = table.is_occupied === true || 
                            table.is_occupied === 'true' || 
                            table.is_occupied === 1 ||
                            (table.status && (table.status === 'occupied' || table.status === 'dolu')) ||
                            (table.items && Array.isArray(table.items) && table.items.length > 0);
          
          if (isOccupied) {
            activeCount++;
          }
        }
      });
      
      return activeCount;
    }

    // MasalarÄ± yÃ¼kle (render etmeden, sadece aktif masa sayÄ±sÄ± iÃ§in)
    function loadTablesForStats() {
      if (!tablesDb) {
        console.warn('âš ï¸ tablesDb bulunamadÄ± - sadece statik masalar oluÅŸturulacak');
        // Firebase olmasa bile tÃ¼m masalarÄ± oluÅŸtur
        allStaticTables = {};
        for (let i = 1; i <= 20; i++) {
          allStaticTables[`inside-${i}`] = {
            table_id: `inside-${i}`,
            table_name: `Ä°Ã§eri ${i}`,
            table_type: 'inside',
            table_number: i,
            is_occupied: false,
            total_amount: 0,
            items: []
          };
        }
        for (let i = 1; i <= 24; i++) {
          allStaticTables[`outside-${i}`] = {
            table_id: `outside-${i}`,
            table_name: `DÄ±ÅŸarÄ± ${i}`,
            table_type: 'outside',
            table_number: i,
            is_occupied: false,
            total_amount: 0,
            items: []
          };
        }
        for (let i = 1; i <= 5; i++) {
          allStaticTables[`package-inside-${i}`] = {
            table_id: `package-inside-${i}`,
            table_name: `Paket ${i}`,
            table_type: 'inside',
            table_number: i,
            is_occupied: false,
            total_amount: 0,
            items: []
          };
        }
        for (let i = 1; i <= 5; i++) {
          allStaticTables[`package-outside-${i}`] = {
            table_id: `package-outside-${i}`,
            table_name: `Paket ${i}`,
            table_type: 'outside',
            table_number: i,
            is_occupied: false,
            total_amount: 0,
            items: []
          };
        }
        updateActiveTablesCount(calculateActiveTablesCount());
        
        // Ä°statistikleri gÃ¼ncelle (eÄŸer satÄ±ÅŸlar yÃ¼klendiyse)
        if (allSales && allSales.length > 0) {
          updateStats(allSales);
        }
        return;
      }

      console.log('âœ… Masalar yÃ¼kleniyor (istatistikler iÃ§in)...');

      // TÃœM masalarÄ± statik olarak oluÅŸtur
      allStaticTables = {};
      
      // Ä°Ã§eri masalar (1-20)
      for (let i = 1; i <= 20; i++) {
        const tableId = `inside-${i}`;
        allStaticTables[tableId] = {
          table_id: tableId,
          table_name: `Ä°Ã§eri ${i}`,
          table_type: 'inside',
          table_number: i,
          is_occupied: false,
          total_amount: 0,
          items: []
        };
      }
      
      // DÄ±ÅŸarÄ± masalar (61-84)
      for (let i = 1; i <= 24; i++) {
        const tableId = `outside-${i}`;
        allStaticTables[tableId] = {
          table_id: tableId,
          table_name: `DÄ±ÅŸarÄ± ${i + 60}`,
          table_type: 'outside',
          table_number: i + 60,
          is_occupied: false,
          total_amount: 0,
          items: []
        };
      }
      
      // Paket masalarÄ± - Ä°Ã§eri (1-5)
      for (let i = 1; i <= 5; i++) {
        const tableId = `package-inside-${i}`;
        allStaticTables[tableId] = {
          table_id: tableId,
          table_name: `Paket ${i}`,
          table_type: 'inside',
          table_number: i,
          is_occupied: false,
          total_amount: 0,
          items: []
        };
      }
      
      // Paket masalarÄ± - DÄ±ÅŸarÄ± (1-5)
      for (let i = 1; i <= 5; i++) {
        const tableId = `package-outside-${i}`;
        allStaticTables[tableId] = {
          table_id: tableId,
          table_name: `Paket ${i}`,
          table_type: 'outside',
          table_number: i,
          is_occupied: false,
          total_amount: 0,
          items: []
        };
      }

      console.log(`ğŸ“‹ Toplam ${Object.keys(allStaticTables).length} statik masa oluÅŸturuldu`);

      // Ä°lk aktif masa sayÄ±sÄ±nÄ± gÃ¼ncelle
      updateActiveTablesCount(calculateActiveTablesCount());
      
      // Ä°lk yÃ¼kleme sonrasÄ±nda istatistikleri gÃ¼ncelle (eÄŸer satÄ±ÅŸlar yÃ¼klendiyse)
      if (allSales && allSales.length > 0) {
        updateStats(allSales);
      }

      // Firebase'den masalarÄ± dinle (sadece aktif masa sayÄ±sÄ± iÃ§in)
      const tablesRef = tablesDb.collection('tables');
      console.log('ğŸ“¡ Firebase collection dinleniyor: tables (istatistikler iÃ§in)');
      
      // EÄŸer zaten bir listener varsa, yeni bir tane oluÅŸturma (renderTables'da oluÅŸturulacak)
      if (!activeTablesUnsubscribe) {
        activeTablesUnsubscribe = tablesRef.onSnapshot((snapshot) => {
          console.log(`ğŸ“Š Masalar snapshot alÄ±ndÄ± (istatistikler iÃ§in): ${snapshot.size} Firebase verisi bulundu`);
          
          // Firebase'den gelen verileri statik masalarla birleÅŸtir
          snapshot.forEach((doc) => {
            const firebaseData = doc.data();
            const tableId = doc.id;
            
            if (allStaticTables[tableId]) {
              const previousIsOccupied = previousTableStates[tableId] !== undefined ? previousTableStates[tableId] : (allStaticTables[tableId].is_occupied || false);
              
              allStaticTables[tableId].is_occupied = firebaseData.is_occupied === true || 
                                                  firebaseData.is_occupied === 'true' || 
                                                  firebaseData.is_occupied === 1 ||
                                                  (firebaseData.status && (firebaseData.status === 'occupied' || firebaseData.status === 'dolu')) ||
                                                  (firebaseData.items && Array.isArray(firebaseData.items) && firebaseData.items.length > 0);
              allStaticTables[tableId].total_amount = parseFloat(firebaseData.total_amount || 0);
              allStaticTables[tableId].items = Array.isArray(firebaseData.items) ? firebaseData.items : [];
              allStaticTables[tableId].order_id = firebaseData.order_id || null;
              allStaticTables[tableId].order_date = firebaseData.order_date || null;
              allStaticTables[tableId].order_time = firebaseData.order_time || null;
              allStaticTables[tableId].order_note = firebaseData.order_note || null;
              
              // Yeni sipariÅŸ kontrolÃ¼: BoÅŸtan doluya geÃ§iÅŸ (ilk yÃ¼klemede gÃ¶sterme)
              const currentIsOccupied = allStaticTables[tableId].is_occupied;
              if (!isFirstTablesLoad && !previousIsOccupied && currentIsOccupied) {
                // Yeni sipariÅŸ geldi - toast gÃ¶ster
                const tableName = allStaticTables[tableId].table_name || tableId;
                showToast('success', 'Yeni SipariÅŸ', `${tableName} iÃ§in sipariÅŸ girildi`);
              }
              
              // Durumu kaydet
              previousTableStates[tableId] = currentIsOccupied;
            }
          });
          
          // Ä°lk yÃ¼kleme tamamlandÄ±
          if (isFirstTablesLoad) {
            isFirstTablesLoad = false;
          }

          // Aktif masa sayÄ±sÄ±nÄ± gÃ¼ncelle
          updateActiveTablesCount(calculateActiveTablesCount());
          
          // Ä°statistikleri gÃ¼ncelle (ciroya aktif masalar eklenecek)
          // Sadece "SatÄ±ÅŸ GeÃ§miÅŸi" sekmesinde gÃ¶rÃ¼nÃ¼rse gÃ¼ncelle
          if (activeTab === 'sales' && allSales && allSales.length > 0) {
            updateStats(allSales);
          }
        }, (error) => {
          console.error('Masalar yÃ¼klenirken hata (istatistikler iÃ§in):', error);
        });
      }
    }

    // Aktif masa sayÄ±sÄ±nÄ± gerÃ§ek zamanlÄ± dinle
    function startActiveTablesListener() {
      // MasalarÄ± yÃ¼kle (eÄŸer henÃ¼z yÃ¼klenmediyse)
      if (Object.keys(allStaticTables).length === 0) {
        loadTablesForStats();
      } else {
        // Zaten yÃ¼klendiyse sadece sayÄ±yÄ± gÃ¼ncelle
        updateActiveTablesCount(calculateActiveTablesCount());
      }
    }

    // Aktif masa sayÄ±sÄ±nÄ± gÃ¼ncelle
    function updateActiveTablesCount(count) {
      const activeTablesValue = document.querySelector('.stat-card-pink .stat-value');
      if (activeTablesValue) {
        activeTablesValue.textContent = count;
      }
    }

    // Ä°statistikleri gÃ¼ncelle
    // Tarih string'ini Date objesine Ã§evir (dd.mm.yyyy formatÄ±)
    function parseSaleDate(dateString) {
      if (!dateString || dateString === 'Bilinmeyen') return null;
      const parts = dateString.split('.');
      if (parts.length !== 3) return null;
      const day = parseInt(parts[0], 10);
      const month = parseInt(parts[1], 10) - 1; // Ay 0-indexed
      const year = parseInt(parts[2], 10);
      return new Date(year, month, day);
    }
    
    // Ä°ki tarihin aynÄ± gÃ¼n olup olmadÄ±ÄŸÄ±nÄ± kontrol et
    function isSameDay(date1, date2) {
      if (!date1 || !date2) return false;
      return date1.getFullYear() === date2.getFullYear() &&
             date1.getMonth() === date2.getMonth() &&
             date1.getDate() === date2.getDate();
    }
    
    // Ä°ÅŸ gÃ¼nÃ¼ baÅŸlangÄ±cÄ±nÄ± al (gece 3'ten baÅŸlar)
    function getBusinessDayStart(date) {
      const businessDay = new Date(date);
      // EÄŸer saat 3'ten Ã¶nceyse, dÃ¼n gece 3'Ã¼ al
      if (businessDay.getHours() < 3) {
        businessDay.setDate(businessDay.getDate() - 1);
      }
      businessDay.setHours(3, 0, 0, 0);
      return businessDay;
    }
    
    // Ä°ÅŸ gÃ¼nÃ¼ bitiÅŸini al (gece 3'e kadar)
    function getBusinessDayEnd(date) {
      const businessDay = new Date(date);
      // EÄŸer saat 3'ten Ã¶nceyse, bugÃ¼n gece 3'Ã¼ al (iÅŸ gÃ¼nÃ¼ bugÃ¼n bitiyor)
      // EÄŸer saat 3'ten sonraysa, yarÄ±n gece 3'Ã¼ al (iÅŸ gÃ¼nÃ¼ yarÄ±n bitiyor)
      if (businessDay.getHours() < 3) {
        businessDay.setHours(3, 0, 0, 0);
      } else {
        businessDay.setDate(businessDay.getDate() + 1);
        businessDay.setHours(3, 0, 0, 0);
      }
      return businessDay;
    }
    
    // SatÄ±ÅŸ tarih ve saatini birleÅŸtirerek Date objesi oluÅŸtur
    function parseSaleDateTime(saleDate, saleTime) {
      if (!saleDate) return null;
      
      const date = parseSaleDate(saleDate);
      if (!date) return null;
      
      // EÄŸer sale_time varsa saati ekle
      if (saleTime) {
        const timeParts = saleTime.split(':');
        if (timeParts.length >= 2) {
          const hours = parseInt(timeParts[0], 10) || 0;
          const minutes = parseInt(timeParts[1], 10) || 0;
          const seconds = timeParts.length >= 3 ? parseInt(timeParts[2], 10) || 0 : 0;
          date.setHours(hours, minutes, seconds, 0);
        }
      }
      
      return date;
    }
    
    // Bir satÄ±ÅŸÄ±n mevcut iÅŸ gÃ¼nÃ¼ iÃ§inde olup olmadÄ±ÄŸÄ±nÄ± kontrol et (gece 3'ten gece 3'e)
    function isInCurrentBusinessDay(saleDate, saleTime) {
      const saleDateTime = parseSaleDateTime(saleDate, saleTime);
      if (!saleDateTime) return false;
      
      const now = new Date();
      const businessDayStart = getBusinessDayStart(now);
      const businessDayEnd = getBusinessDayEnd(now);
      
      return saleDateTime >= businessDayStart && saleDateTime < businessDayEnd;
    }
    
    // Aktif masalardaki toplam tutarÄ± hesapla
    function calculateActiveTablesRevenue() {
      let totalRevenue = 0;
      let cashRevenue = 0;
      let cardRevenue = 0;
      
      Object.values(allStaticTables).forEach(table => {
        // Sadece dolu masalarÄ± say
        const isOccupied = table.is_occupied === true || 
                          table.is_occupied === 'true' || 
                          table.is_occupied === 1 ||
                          (table.status && (table.status === 'occupied' || table.status === 'dolu')) ||
                          (table.items && Array.isArray(table.items) && table.items.length > 0);
        
        if (isOccupied && table.total_amount) {
          const amount = parseFloat(table.total_amount || 0);
          totalRevenue += amount;
          
          // Ã–deme yÃ¶ntemini kontrol et (eÄŸer masa verisinde varsa)
          // Masa verisinde payment_method yoksa varsayÄ±lan olarak Nakit sayÄ±lÄ±r
          const paymentMethod = table.payment_method || 'Nakit';
          if (paymentMethod === 'Kart') {
            cardRevenue += amount;
          } else {
            cashRevenue += amount;
          }
        }
      });
      
      return { total: totalRevenue, cash: cashRevenue, card: cardRevenue };
    }
    
    function updateStats(sales) {
      // MasraflarÄ± hariÃ§ tut - iÅŸ gÃ¼nÃ¼ iÃ§indeki satÄ±ÅŸlar (gece 3'ten gece 3'e)
      // TÃœM satÄ±ÅŸlarÄ± topla (kÄ±smi Ã¶demeler dahil)
      const todaySales = sales.filter(s => {
        if (s.isExpense || s.payment_method === 'Masraf') return false;
        return isInCurrentBusinessDay(s.sale_date, s.sale_time);
      });
      
      // Her bir satÄ±ÅŸÄ±n fiyatÄ±nÄ± topla
      const completedRevenue = todaySales.reduce((sum, s) => sum + parseFloat(s.total_amount || 0), 0);
      
      // Ä°ptal kayÄ±tlarÄ±nÄ± hesapla - bugÃ¼nkÃ¼ iÅŸ gÃ¼nÃ¼ iÃ§indeki iptaller
      // Her bir iptalin bedelini dÃ¼ÅŸ
      let todayCancelsTotal = 0;
      if (allCancels && allCancels.length > 0) {
        const todayCancels = allCancels.filter(cancel => {
          if (!cancel.cancel_date) return false;
          // Ä°ptal tarihini kontrol et - iÅŸ gÃ¼nÃ¼ iÃ§inde mi?
          const cancelDate = cancel.cancel_date;
          const cancelTime = cancel.cancel_time || '00:00';
          return isInCurrentBusinessDay(cancelDate, cancelTime);
        });
        // Ä°ptal edilen Ã¼rÃ¼nlerin toplam tutarÄ±nÄ± hesapla (her bir iptalin bedeli)
        todayCancelsTotal = todayCancels.reduce((sum, cancel) => {
          const quantity = parseFloat(cancel.quantity || 0);
          const price = parseFloat(cancel.price || 0);
          return sum + (quantity * price);
        }, 0);
      }
      
      // Nakit ve kart tutarlarÄ±nÄ± hesapla (tamamlanmÄ±ÅŸ satÄ±ÅŸlardan)
      // Online SatÄ±ÅŸ (Nakit) -> Nakit'e ekle
      // Online SatÄ±ÅŸ (Kart) -> Kart'a ekle
      // Online SatÄ±ÅŸ -> Kart'a ekle (varsayÄ±lan)
      const cashSales = todaySales.filter(s => 
        s.payment_method === 'Nakit' || 
        s.payment_method === 'Online SatÄ±ÅŸ (Nakit)'
      );
      const cardSales = todaySales.filter(s => 
        s.payment_method === 'Kart' || 
        s.payment_method === 'Kredi KartÄ±' ||
        s.payment_method === 'Online SatÄ±ÅŸ (Kart)' ||
        s.payment_method === 'Online SatÄ±ÅŸ' ||
        (s.payment_method !== 'Nakit' && 
         s.payment_method !== 'Online SatÄ±ÅŸ (Nakit)' && 
         s.payment_method !== 'Masraf')
      );
      const cashTotal = cashSales.reduce((sum, s) => sum + parseFloat(s.total_amount || 0), 0);
      const cardTotal = cardSales.reduce((sum, s) => sum + parseFloat(s.total_amount || 0), 0);
      
      // Aktif masalardaki toplam tutarÄ± hesapla
      const activeTablesRevenue = calculateActiveTablesRevenue();
      
      // GÃ¼nlÃ¼k ciro = TamamlanmÄ±ÅŸ satÄ±ÅŸlar + Aktif masalar - Ä°ptal edilen tutarlar
      const todayRevenue = Math.max(0, completedRevenue + activeTablesRevenue.total - todayCancelsTotal);
      
      // GÃ¼nlÃ¼k ciro 50.000 TL'yi geÃ§tiyse push notification gÃ¶nder
      checkRevenueNotification(todayRevenue);
      
      // Ä°ptalleri nakit/kart daÄŸÄ±lÄ±mÄ±na gÃ¶re orantÄ±lÄ± olarak dÃ¼ÅŸ
      // Ã–nce toplam satÄ±ÅŸ tutarÄ±nÄ± hesapla (aktif masalar dahil)
      const totalSalesWithActive = completedRevenue + activeTablesRevenue.total;
      
      // Ä°ptalleri nakit/kart oranÄ±na gÃ¶re daÄŸÄ±t
      let cashCancelAmount = 0;
      let cardCancelAmount = 0;
      
      if (totalSalesWithActive > 0 && todayCancelsTotal > 0) {
        // Nakit ve kart oranlarÄ±nÄ± hesapla
        const cashRatio = (cashTotal + activeTablesRevenue.cash) / totalSalesWithActive;
        const cardRatio = (cardTotal + activeTablesRevenue.card) / totalSalesWithActive;
        
        // Ä°ptalleri oranlara gÃ¶re daÄŸÄ±t ve yuvarla (5'in katÄ± olmasÄ± iÃ§in)
        cashCancelAmount = Math.round((todayCancelsTotal * cashRatio) / 5) * 5;
        cardCancelAmount = Math.round((todayCancelsTotal * cardRatio) / 5) * 5;
        
        // Toplam iptal tutarÄ±nÄ± koru (yuvarlama hatasÄ± olmamasÄ± iÃ§in)
        const totalCancelDistributed = cashCancelAmount + cardCancelAmount;
        if (Math.abs(totalCancelDistributed - todayCancelsTotal) > 0.01) {
          // Fark varsa, daha bÃ¼yÃ¼k olana ekle
          if (cashCancelAmount >= cardCancelAmount) {
            cashCancelAmount = todayCancelsTotal - cardCancelAmount;
          } else {
            cardCancelAmount = todayCancelsTotal - cashCancelAmount;
          }
          // Son olarak 5'in katÄ±na yuvarla
          cashCancelAmount = Math.round(cashCancelAmount / 5) * 5;
          cardCancelAmount = Math.round(cardCancelAmount / 5) * 5;
        }
      } else if (todayCancelsTotal > 0) {
        // EÄŸer hiÃ§ satÄ±ÅŸ yoksa ama iptal varsa, varsayÄ±lan olarak yarÄ± yarÄ±ya daÄŸÄ±t (5'in katÄ±)
        cashCancelAmount = Math.round((todayCancelsTotal / 2) / 5) * 5;
        cardCancelAmount = todayCancelsTotal - cashCancelAmount;
        cardCancelAmount = Math.round(cardCancelAmount / 5) * 5;
      }
      
      // Nakit ve kart tutarlarÄ±na aktif masalarÄ± ekle, iptalleri dÃ¼ÅŸ (5'in katÄ±na yuvarla)
      const totalCash = Math.max(0, Math.round((cashTotal + activeTablesRevenue.cash - cashCancelAmount) / 5) * 5);
      const totalCard = Math.max(0, Math.round((cardTotal + activeTablesRevenue.card - cardCancelAmount) / 5) * 5);
      
      // GÃ¼nlÃ¼k masraflarÄ± hesapla - iÅŸ gÃ¼nÃ¼ iÃ§indeki masraflar (gece 3'ten gece 3'e)
      const todayExpenses = sales.filter(s => {
        if (!s.isExpense && s.payment_method !== 'Masraf') return false;
        return isInCurrentBusinessDay(s.sale_date, s.sale_time);
      });
      const todayExpenseTotal = todayExpenses.reduce((sum, s) => sum + parseFloat(s.total_amount || 0), 0);
      
      const statsGrid = document.getElementById('statsGrid');
      if (!statsGrid) return;
      
      // Sadece "SatÄ±ÅŸ GeÃ§miÅŸi" sekmesinde gÃ¶ster
      if (activeTab !== 'sales') {
        statsGrid.innerHTML = '';
        return;
      }
      
      statsGrid.innerHTML = `
        <div class="stat-card stat-card-green">
          <div class="stat-icon">ğŸ’°</div>
          <div class="stat-content">
            <h3>GÃ¼nlÃ¼k Ciro</h3>
            <div class="stat-value">â‚º${Math.round(todayRevenue).toLocaleString('tr-TR')}</div>
          </div>
        </div>
        <div class="stat-card stat-card-red">
          <div class="stat-icon">ğŸ’¸</div>
          <div class="stat-content">
            <h3>GÃ¼nlÃ¼k Masraf</h3>
            <div class="stat-value">â‚º${Math.round(todayExpenseTotal).toLocaleString('tr-TR')}</div>
          </div>
        </div>
        <div class="stat-card stat-card-orange">
          <div class="stat-icon">âš ï¸</div>
          <div class="stat-content">
            <h3>GÃ¼nlÃ¼k Ä°ptal</h3>
            <div class="stat-value">â‚º${Math.round(todayCancelsTotal).toLocaleString('tr-TR')}</div>
          </div>
        </div>
        <div class="stat-card stat-card-purple">
          <div class="stat-icon">ğŸ“Š</div>
          <div class="stat-content">
            <h3>BugÃ¼nkÃ¼ SatÄ±ÅŸ</h3>
            <div class="stat-value">${todaySales.length}</div>
          </div>
        </div>
        <div class="stat-card stat-card-pink">
          <div class="stat-icon">ğŸª‘</div>
          <div class="stat-content">
            <h3>Aktif Masa</h3>
            <div class="stat-value">0</div>
          </div>
        </div>
        <div class="payment-breakdown-card">
          <div class="payment-breakdown-item">
            <span class="payment-breakdown-label">ğŸ’µ Nakit:</span>
            <span class="payment-breakdown-value">â‚º${Math.round(totalCash).toLocaleString('tr-TR')}</span>
          </div>
          <div class="payment-breakdown-item">
            <span class="payment-breakdown-label">ğŸ’³ Kart:</span>
            <span class="payment-breakdown-value">â‚º${Math.round(totalCard).toLocaleString('tr-TR')}</span>
          </div>
        </div>
      `;

      // Aktif masa sayÄ±sÄ±nÄ± baÅŸlat
      startActiveTablesListener();
    }

    function showLoading(show) {
      const loader = document.getElementById('loader');
      if (loader) {
        loader.style.display = show ? 'flex' : 'none';
      }
    }

    // Aktif sekme deÄŸiÅŸtir
    function setActiveTab(tab) {
      activeTab = tab;
      renderCurrentView();
      updateTabButtons();
    }

    // Tab butonlarÄ±nÄ± gÃ¼ncelle
    function updateTabButtons() {
      const buttons = document.querySelectorAll('.tab-btn');
      buttons.forEach(btn => {
        if (btn.dataset.tab === activeTab) {
          btn.classList.add('active');
        } else {
          btn.classList.remove('active');
        }
      });
    }

    // Mevcut gÃ¶rÃ¼nÃ¼mÃ¼ render et
    function renderCurrentView() {
      // EÄŸer masalar sekmesinden Ã§Ä±kÄ±lÄ±yorsa, listener'Ä± temizle
      if (activeTab !== 'tables' && tablesUnsubscribe) {
        tablesUnsubscribe();
        tablesUnsubscribe = null;
      }

      // Aktif masa listener'Ä±nÄ± HER ZAMAN Ã§alÄ±ÅŸtÄ±r (istatistikler iÃ§in)
      // BÃ¶ylece masa sipariÅŸi kaydedildiÄŸinde veya iptal olduÄŸunda anlÄ±k gÃ¼ncellenir
      if (!activeTablesUnsubscribe) {
        startActiveTablesListener();
      }
      
      // Ä°ptal listener'Ä±nÄ± HER ZAMAN Ã§alÄ±ÅŸtÄ±r (istatistikler iÃ§in)
      // BÃ¶ylece iptal olduÄŸunda anlÄ±k gÃ¼ncellenir
      if (!cancelsUnsubscribe) {
        startCancelsListener();
      }
      
      // SatÄ±ÅŸ listener'Ä±nÄ± HER ZAMAN Ã§alÄ±ÅŸtÄ±r (istatistikler iÃ§in)
      // BÃ¶ylece yeni satÄ±ÅŸ olduÄŸunda anlÄ±k gÃ¼ncellenir
      if (!realtimeUnsubscribe) {
        startRealtimeListener();
      }

      // Container'larÄ± gÃ¶ster/gizle
      const salesContainer = document.getElementById('salesContainer');
      const reportsContainer = document.getElementById('reportsContainer');
      const staffContainer = document.getElementById('staffContainer');
      const tablesContainer = document.getElementById('tablesContainer');
      const cancelsContainer = document.getElementById('cancelsContainer');
      
      if (salesContainer) salesContainer.style.display = activeTab === 'sales' ? 'block' : 'none';
      if (reportsContainer) reportsContainer.style.display = activeTab === 'reports' ? 'block' : 'none';
      if (staffContainer) staffContainer.style.display = activeTab === 'staff' ? 'block' : 'none';
      if (tablesContainer) tablesContainer.style.display = activeTab === 'tables' ? 'block' : 'none';
      if (cancelsContainer) cancelsContainer.style.display = activeTab === 'cancels' ? 'block' : 'none';
      
      // Stats grid'i sadece "SatÄ±ÅŸ GeÃ§miÅŸi" sekmesinde gÃ¶ster
      const statsGrid = document.getElementById('statsGrid');
      if (statsGrid) {
        statsGrid.style.display = activeTab === 'sales' ? 'grid' : 'none';
      }
      
      if (activeTab === 'sales') {
        renderSales(allSales, true); // resetCount = true (sekme deÄŸiÅŸtiÄŸinde sayacÄ± sÄ±fÄ±rla)
        updateSalesDateFilterButton();
      } else if (activeTab === 'reports') {
        renderReports();
      } else if (activeTab === 'staff') {
        renderStaffDetails();
      } else if (activeTab === 'tables') {
        renderTables();
      } else if (activeTab === 'cancels') {
        renderCancels(true); // resetCount = true (sekme deÄŸiÅŸtiÄŸinde sayacÄ± sÄ±fÄ±rla)
      }
    }

    // Tarih filtresine gÃ¶re satÄ±ÅŸlarÄ± filtrele
    function filterSalesByDate(sales) {
      const now = new Date();
      now.setHours(23, 59, 59, 999);
      
      if (reportDateFilter === 'yesterday') {
        const yesterday = new Date(now);
        yesterday.setDate(yesterday.getDate() - 1);
        yesterday.setHours(0, 0, 0, 0);
        const yesterdayEnd = new Date(yesterday);
        yesterdayEnd.setHours(23, 59, 59, 999);
        
        return sales.filter(sale => {
          if (!sale.sale_date || sale.sale_date === 'Bilinmeyen') return false;
          const [day, month, year] = sale.sale_date.split('.');
          if (!day || !month || !year) return false;
          const saleDate = new Date(year, month - 1, day);
          saleDate.setHours(0, 0, 0, 0);
          return saleDate >= yesterday && saleDate <= yesterdayEnd;
        });
      } else if (reportDateFilter === 'week') {
        const weekAgo = new Date(now);
        weekAgo.setDate(weekAgo.getDate() - 7);
        weekAgo.setHours(0, 0, 0, 0);
        
        return sales.filter(sale => {
          if (!sale.sale_date || sale.sale_date === 'Bilinmeyen') return false;
          const [day, month, year] = sale.sale_date.split('.');
          if (!day || !month || !year) return false;
          const saleDate = new Date(year, month - 1, day);
          saleDate.setHours(0, 0, 0, 0);
          return saleDate >= weekAgo && saleDate <= now;
        });
      } else if (reportDateFilter === 'month') {
        const monthAgo = new Date(now);
        monthAgo.setMonth(monthAgo.getMonth() - 1);
        monthAgo.setHours(0, 0, 0, 0);
        
        return sales.filter(sale => {
          if (!sale.sale_date || sale.sale_date === 'Bilinmeyen') return false;
          const [day, month, year] = sale.sale_date.split('.');
          if (!day || !month || !year) return false;
          const saleDate = new Date(year, month - 1, day);
          saleDate.setHours(0, 0, 0, 0);
          return saleDate >= monthAgo && saleDate <= now;
        });
      } else if (reportDateFilter === 'custom' && customDateRange.start && customDateRange.end) {
        const startDate = new Date(customDateRange.start);
        startDate.setHours(0, 0, 0, 0);
        const endDate = new Date(customDateRange.end);
        endDate.setHours(23, 59, 59, 999);
        
        return sales.filter(sale => {
          if (!sale.sale_date || sale.sale_date === 'Bilinmeyen') return false;
          const [day, month, year] = sale.sale_date.split('.');
          if (!day || !month || !year) return false;
          const saleDate = new Date(year, month - 1, day);
          saleDate.setHours(0, 0, 0, 0);
          return saleDate >= startDate && saleDate <= endDate;
        });
      }
      
      return sales; // 'all' iÃ§in tÃ¼m satÄ±ÅŸlar
    }

    // Tarih formatÄ±nÄ± dÃ¶nÃ¼ÅŸtÃ¼r (YYYY-MM-DD -> DD.MM.YYYY)
    function formatDateForInput(date) {
      if (!date) return '';
      const d = new Date(date);
      const day = String(d.getDate()).padStart(2, '0');
      const month = String(d.getMonth() + 1).padStart(2, '0');
      const year = d.getFullYear();
      return `${year}-${month}-${day}`;
    }

    // Tarih formatÄ±nÄ± dÃ¶nÃ¼ÅŸtÃ¼r (DD.MM.YYYY -> YYYY-MM-DD)
    function parseDateFromInput(dateStr) {
      if (!dateStr) return null;
      const [year, month, day] = dateStr.split('-');
      return new Date(year, month - 1, day);
    }

    // Ã–zel tarih aralÄ±ÄŸÄ± seÃ§
    function setCustomDateRange() {
      const startInput = document.getElementById('customDateStart');
      const endInput = document.getElementById('customDateEnd');
      
      if (!startInput || !endInput) return;
      
      const start = startInput.value;
      const end = endInput.value;
      
      if (!start || !end) {
        alert('LÃ¼tfen baÅŸlangÄ±Ã§ ve bitiÅŸ tarihlerini seÃ§in');
        return;
      }
      
      const startDate = parseDateFromInput(start);
      const endDate = parseDateFromInput(end);
      
      if (startDate > endDate) {
        alert('BaÅŸlangÄ±Ã§ tarihi bitiÅŸ tarihinden sonra olamaz');
        return;
      }
      
      customDateRange.start = startDate;
      customDateRange.end = endDate;
      reportDateFilter = 'custom';
      renderReports();
      closeDateFilterModal();
    }

    // Tarih filtresini deÄŸiÅŸtir
    function setReportDateFilter(filter) {
      reportDateFilter = filter;
      renderReports();
    }

    // Tarih filtresi modal'Ä±nÄ± aÃ§/kapa
    function toggleDateFilterModal(event) {
      if (event) {
        event.stopPropagation();
      }
      const modal = document.getElementById('dateFilterModal');
      if (modal) {
        const isOpen = modal.classList.contains('show');
        // Ã–nce tÃ¼m modal'larÄ± kapat
        document.querySelectorAll('.date-filter-modal').forEach(m => m.classList.remove('show'));
        // Sonra bu modal'Ä± aÃ§/kapa
        if (!isOpen) {
          modal.classList.add('show');
        }
      }
    }

    // Tarih filtresi modal'Ä±nÄ± kapat
    function closeDateFilterModal() {
      const modal = document.getElementById('dateFilterModal');
      if (modal) {
        modal.classList.remove('show');
      }
    }

    function toggleStaffDateFilterModal(event) {
      if (event) event.stopPropagation();
      const modal = document.getElementById('staffDateFilterModal');
      if (modal) {
        modal.classList.toggle('show');
      }
    }

    function closeStaffDateFilterModal() {
      const modal = document.getElementById('staffDateFilterModal');
      if (modal) {
        modal.classList.remove('show');
      }
    }

    // DetaylÄ± Raporlama render et
    function renderReports() {
      const container = document.getElementById('reportsContainer');
      if (!container) return;

      // MasraflarÄ± filtrele
      let reportSales = allSales.filter(sale => 
        !sale.isExpense && sale.payment_method !== 'Masraf'
      );
      
      // EÄŸer "TÃ¼m Zamanlar" seÃ§iliyse, tÃ¼m satÄ±ÅŸlarÄ± Firebase'den Ã§ek (limit olmadan)
      if (reportDateFilter === 'all') {
        // TÃ¼m satÄ±ÅŸlarÄ± yÃ¼kle (tÃ¼m zamanlar cirosu iÃ§in - limit yok)
        loadAllSalesForReports().then(() => {
          reportSales = allSales.filter(sale => 
            !sale.isExpense && sale.payment_method !== 'Masraf'
          );
          renderReportsContent(reportSales);
        });
        return;
      }
      
      reportSales = filterSalesByDate(reportSales);
      renderReportsContent(reportSales);
    }
    
    // TÃ¼m satÄ±ÅŸlarÄ± yÃ¼kle (sadece "TÃ¼m Zamanlar" iÃ§in - limit yok)
    async function loadAllSalesForReports() {
      if (!db) return;
      
      try {
        const salesRef = db.collection('sales');
        // TÃ¼m satÄ±ÅŸlarÄ± al (limit yok - sadece "TÃ¼m Zamanlar" iÃ§in)
        let query = salesRef;
        try {
          query = salesRef.orderBy('created_at', 'desc');
        } catch (e) {
          try {
            query = salesRef.orderBy('timestamp', 'desc');
          } catch (e2) {
            query = salesRef; // Limit yok
          }
        }
        
        const querySnapshot = await query.get();
        const sales = [];
        
        querySnapshot.forEach((doc) => {
          const data = doc.data();
          
          let saleDate = data.sale_date;
          let saleTime = data.sale_time;
          
          let createdAt = null;
          if (data.created_at) {
            const timestamp = data.created_at;
            createdAt = timestamp.toDate ? timestamp.toDate() : new Date(timestamp.seconds * 1000);
          } else if (data.timestamp) {
            const timestamp = data.timestamp;
            createdAt = timestamp.toDate ? timestamp.toDate() : new Date(timestamp.seconds * 1000);
          }
          
          if (!saleDate && createdAt) {
            saleDate = createdAt.toLocaleDateString('tr-TR');
            saleTime = createdAt.toLocaleTimeString('tr-TR');
          }
          
          let items = [];
          let itemsArray = data.items_array || [];
          
          if (data.items) {
            if (Array.isArray(data.items)) {
              items = data.items;
            } else if (typeof data.items === 'string') {
              items = data.items.split(', ').map(item => {
                const match = item.match(/(.+) x(\d+)/);
                if (match) {
                  return {
                    product_name: match[1].replace(' (Ä°KRAM)', ''),
                    quantity: parseInt(match[2]),
                    isGift: item.includes('(Ä°KRAM)')
                  };
                }
                return { product_name: item, quantity: 1, isGift: false };
              });
            }
          }
          
          sales.push({
            id: doc.id,
            sale_id: data.sale_id || doc.id,
            total_amount: data.total_amount || 0,
            payment_method: data.payment_method || 'Nakit',
            sale_date: saleDate || 'Bilinmeyen',
            sale_time: saleTime || '',
            staff_name: data.staff_name || null,
            table_name: data.table_name || null,
            table_type: data.table_type || null,
            items: items,
            items_array: itemsArray,
            itemsText: data.items || 'ÃœrÃ¼n bulunamadÄ±',
            isExpense: data.isExpense === true || data.isExpense === 'true' || data.payment_method === 'Masraf',
            created_at: createdAt
          });
        });
        
        // SÄ±rala
        sales.sort((a, b) => {
          if (a.created_at && b.created_at) {
            return b.created_at.getTime() - a.created_at.getTime();
          }
          if (a.created_at) return -1;
          if (b.created_at) return 1;
          
          if (a.sale_date && b.sale_date) {
            const [dayA, monthA, yearA] = a.sale_date.split('.');
            const [dayB, monthB, yearB] = b.sale_date.split('.');
            if (dayA && monthA && yearA && dayB && monthB && yearB) {
              const dateA = new Date(yearA, monthA - 1, dayA);
              const dateB = new Date(yearB, monthB - 1, dayB);
              return dateB.getTime() - dateA.getTime();
            }
          }
          
          const idA = parseInt(a.sale_id || a.id) || 0;
          const idB = parseInt(b.sale_id || b.id) || 0;
          return idB - idA;
        });
        
        // TÃ¼m satÄ±ÅŸlarÄ± allSales'e ekle (mevcut olanlarla birleÅŸtir, duplicate'leri kaldÄ±r)
        const existingIds = new Set(allSales.map(s => s.id));
        const newSales = sales.filter(s => !existingIds.has(s.id));
        allSales = [...allSales, ...newSales];
        
        // TÃ¼m satÄ±ÅŸlarÄ± tekrar sÄ±rala
        allSales.sort((a, b) => {
          if (a.created_at && b.created_at) {
            return b.created_at.getTime() - a.created_at.getTime();
          }
          return 0;
        });
      } catch (error) {
        console.error('TÃ¼m satÄ±ÅŸlar yÃ¼klenirken hata:', error);
      }
    }
    
    // Rapor iÃ§eriÄŸini render et
    function renderReportsContent(reportSales) {
      const container = document.getElementById('reportsContainer');
      if (!container) return;

      if (reportSales.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">ğŸ“Š</div>
            <h3>HenÃ¼z veri yok</h3>
            <p>SatÄ±ÅŸ yapÄ±ldÄ±kÃ§a raporlar oluÅŸturulacak</p>
          </div>
        `;
        return;
      }

      // ÃœrÃ¼n istatistiklerini hesapla - Firebase'den gelen gerÃ§ek satÄ±ÅŸ detaylarÄ±nÄ± kullan
      const productStats = {};
      
      reportSales.forEach(sale => {
        let itemsArray = [];
        
        if (sale.items_array && Array.isArray(sale.items_array)) {
          // Masraf itemlarÄ±nÄ± filtrele
          itemsArray = sale.items_array.filter(item => !item.isExpense);
        } else if (sale.items) {
          const items = sale.items.split(', ');
          itemsArray = items.map(item => {
            const match = item.match(/(.+) x(\d+)/);
            if (match) {
              const [, productName, quantity] = match;
              const isGift = item.includes('(Ä°KRAM)');
              return {
                product_name: productName.replace(' (Ä°KRAM)', ''),
                quantity: parseInt(quantity),
                price: 0,
                isGift: isGift
              };
            }
            return null;
          }).filter(Boolean);
        }
        
        itemsArray.forEach(item => {
          if (!item || !item.product_name || item.isExpense) return;
          
          const productName = item.product_name;
          const quantity = item.quantity || 1;
          const isGift = item.isGift || false;
          
          if (!productStats[productName]) {
            productStats[productName] = { 
              count: 0, 
              revenue: 0,
              price: item.price || 0
            };
          }
          
          productStats[productName].count += quantity;
          
          if (!isGift && item.price) {
            productStats[productName].revenue += item.price * quantity;
            if (productStats[productName].price === 0) {
              productStats[productName].price = item.price;
            }
          } else if (!isGift && !item.price && sale.total_amount) {
            const saleTotal = parseFloat(sale.total_amount);
            const nonGiftItems = itemsArray.filter(i => !i.isGift);
            const totalNonGiftQuantity = nonGiftItems.reduce((sum, i) => sum + (i.quantity || 1), 0);
            
            if (totalNonGiftQuantity > 0) {
              productStats[productName].revenue += (saleTotal / totalNonGiftQuantity) * quantity;
            }
          }
        });
      });

      const productEntries = Object.entries(productStats);
      const topProductsByCount = [...productEntries]
        .sort(([, a], [, b]) => b.count - a.count)
        .slice(0, 2);
      const bottomProductsByCount = [...productEntries]
        .sort(([, a], [, b]) => a.count - b.count)
        .slice(0, 2);
      const topProductsByRevenue = [...productEntries]
        .sort(([, a], [, b]) => b.revenue - a.revenue)
        .slice(0, 2);
      const bottomProductsByRevenue = [...productEntries]
        .sort(([, a], [, b]) => a.revenue - b.revenue)
        .slice(0, 2);

      const paymentMethods = {};
      reportSales.forEach(sale => {
        if (!paymentMethods[sale.payment_method]) {
          paymentMethods[sale.payment_method] = { count: 0, total: 0 };
        }
        paymentMethods[sale.payment_method].count++;
        paymentMethods[sale.payment_method].total += parseFloat(sale.total_amount);
      });

      // TÃœM FÄ°LTRELER Ä°Ã‡Ä°N: GÃ¼nlÃ¼k cirolarÄ± toplayarak hesapla
      // (Her gÃ¼n iÃ§in: GÃ¼nlÃ¼k SatÄ±ÅŸlar - GÃ¼nlÃ¼k Ä°ptaller)
      // SatÄ±ÅŸlarÄ± tarihe gÃ¶re grupla (filtreye gÃ¶re)
      const salesByDate = {};
      reportSales.forEach(sale => {
        if (!sale.sale_date || sale.sale_date === 'Bilinmeyen') return;
        
        if (!salesByDate[sale.sale_date]) {
          salesByDate[sale.sale_date] = { sales: [], cancels: [] };
        }
        salesByDate[sale.sale_date].sales.push(sale);
      });
      
      // Ä°ptalleri tarihe gÃ¶re grupla (filtreye gÃ¶re)
      if (allCancels && allCancels.length > 0) {
        const periodCancels = allCancels.filter(cancel => {
          if (!cancel.cancel_date) return false;
          
          // Tarih filtresine gÃ¶re iptalleri filtrele
          if (reportDateFilter === 'all') {
            return true; // TÃ¼m iptaller
          } else if (reportDateFilter === 'yesterday') {
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayStr = yesterday.toLocaleDateString('tr-TR');
            return cancel.cancel_date === yesterdayStr;
          } else if (reportDateFilter === 'week') {
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);
            const cancelDate = cancel.cancel_date;
            const [day, month, year] = cancelDate.split('.');
            if (!day || !month || !year) return false;
            const cancelDateObj = new Date(year, month - 1, day);
            return cancelDateObj >= weekAgo;
          } else if (reportDateFilter === 'month') {
            const monthAgo = new Date();
            monthAgo.setMonth(monthAgo.getMonth() - 1);
            const cancelDate = cancel.cancel_date;
            const [day, month, year] = cancelDate.split('.');
            if (!day || !month || !year) return false;
            const cancelDateObj = new Date(year, month - 1, day);
            return cancelDateObj >= monthAgo;
          } else if (reportDateFilter === 'custom' && customDateRange.start && customDateRange.end) {
            const cancelDate = cancel.cancel_date;
            const [day, month, year] = cancelDate.split('.');
            if (!day || !month || !year) return false;
            const cancelDateObj = new Date(year, month - 1, day);
            cancelDateObj.setHours(0, 0, 0, 0);
            return cancelDateObj >= customDateRange.start && cancelDateObj <= customDateRange.end;
          }
          
          return false;
        });
        
        // Ä°ptalleri tarihe gÃ¶re grupla
        periodCancels.forEach(cancel => {
          if (!cancel.cancel_date) return;
          if (!salesByDate[cancel.cancel_date]) {
            salesByDate[cancel.cancel_date] = { sales: [], cancels: [] };
          }
          salesByDate[cancel.cancel_date].cancels.push(cancel);
        });
      }
      
      // Her gÃ¼n iÃ§in ciro hesapla ve topla
      // GÃ¼nlÃ¼k Ciro = O gÃ¼n yapÄ±lan her bir satÄ±ÅŸÄ±n fiyatÄ±nÄ± topla - O gÃ¼n yapÄ±lan her bir iptalin bedelini dÃ¼ÅŸ
      let totalRevenue = 0;
      Object.keys(salesByDate).forEach(date => {
        const dayData = salesByDate[date];
        // O gÃ¼n yapÄ±lan her bir satÄ±ÅŸÄ±n fiyatÄ±nÄ± topla
        const daySales = dayData.sales.reduce((sum, s) => sum + parseFloat(s.total_amount || 0), 0);
        // O gÃ¼n yapÄ±lan her bir iptalin bedelini dÃ¼ÅŸ
        const dayCancels = dayData.cancels.reduce((sum, cancel) => {
          const quantity = parseFloat(cancel.quantity || 0);
          const price = parseFloat(cancel.price || 0);
          return sum + (quantity * price);
        }, 0);
        const dayRevenue = Math.max(0, daySales - dayCancels);
        totalRevenue += dayRevenue;
      });

      // Online satÄ±ÅŸlarÄ± filtrele ve ciro hesapla
      const onlineSales = reportSales.filter(sale => 
        sale.payment_method && (
          sale.payment_method.includes('Online SatÄ±ÅŸ') || 
          sale.payment_method === 'Online SatÄ±ÅŸ' ||
          sale.payment_method === 'Online SatÄ±ÅŸ (Kart)' ||
          sale.payment_method === 'Online SatÄ±ÅŸ (Nakit)'
        )
      );
      const onlineRevenue = onlineSales.reduce((sum, sale) => sum + parseFloat(sale.total_amount || 0), 0);

      // TÃœM FÄ°LTRELER Ä°Ã‡Ä°N: GÃ¼nlÃ¼k masraflarÄ± toplayarak hesapla
      // MasraflarÄ± tarihe gÃ¶re grupla (filtreye gÃ¶re)
      const expensesByDate = {};
      let periodExpenses = allSales.filter(sale => 
        (sale.isExpense || sale.payment_method === 'Masraf')
      );
      periodExpenses = filterSalesByDate(periodExpenses);
      
      periodExpenses.forEach(expense => {
        if (!expense.sale_date || expense.sale_date === 'Bilinmeyen') return;
        
        if (!expensesByDate[expense.sale_date]) {
          expensesByDate[expense.sale_date] = [];
        }
        expensesByDate[expense.sale_date].push(expense);
      });
      
      // Her gÃ¼n iÃ§in masraf hesapla ve topla
      // GÃ¼nlÃ¼k Masraf = O gÃ¼n yapÄ±lan her bir masrafÄ±n fiyatÄ±nÄ± topla
      let totalExpense = 0;
      Object.keys(expensesByDate).forEach(date => {
        const dayExpenses = expensesByDate[date];
        const dayExpense = dayExpenses.reduce((sum, e) => sum + parseFloat(e.total_amount || 0), 0);
        totalExpense += dayExpense;
      });

      const filterLabels = {
        'all': 'TÃ¼m Zamanlar',
        'yesterday': 'DÃ¼n',
        'week': 'Son 1 Hafta',
        'month': 'Son 1 Ay',
        'custom': customDateRange.start && customDateRange.end 
          ? `${customDateRange.start.toLocaleDateString('tr-TR')} - ${customDateRange.end.toLocaleDateString('tr-TR')}`
          : 'Ã–zel Tarih AralÄ±ÄŸÄ±'
      };

      // SeÃ§ilen zaman dilimi bilgisi
      let periodInfo = '';
      if (reportDateFilter === 'yesterday') {
        const yesterday = new Date();
        yesterday.setDate(yesterday.getDate() - 1);
        periodInfo = yesterday.toLocaleDateString('tr-TR');
      } else if (reportDateFilter === 'week') {
        const weekAgo = new Date();
        weekAgo.setDate(weekAgo.getDate() - 7);
        periodInfo = `${weekAgo.toLocaleDateString('tr-TR')} - ${new Date().toLocaleDateString('tr-TR')}`;
      } else if (reportDateFilter === 'month') {
        const monthAgo = new Date();
        monthAgo.setMonth(monthAgo.getMonth() - 1);
        periodInfo = `${monthAgo.toLocaleDateString('tr-TR')} - ${new Date().toLocaleDateString('tr-TR')}`;
      } else if (reportDateFilter === 'custom' && customDateRange.start && customDateRange.end) {
        periodInfo = `${customDateRange.start.toLocaleDateString('tr-TR')} - ${customDateRange.end.toLocaleDateString('tr-TR')}`;
      } else {
        periodInfo = 'TÃ¼m Zamanlar';
      }

      let html = `
        <div class="reports-container">
          <div class="reports-header">
            <div>
              <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 4px; flex-wrap: nowrap;">
                <h2 class="reports-title" style="white-space: nowrap;">ğŸ“Š DetaylÄ± Raporlama</h2>
                <button class="analyze-btn" onclick="showAnalysisModal()" style="flex-shrink: 0;">
                  <span>ğŸ”</span>
                  <span>Analiz Et</span>
                </button>
              </div>
              <p class="reports-subtitle">KapsamlÄ± satÄ±ÅŸ analizi ve istatistikler</p>
            </div>
            <div class="date-filter-wrapper">
              <button class="date-filter-trigger" onclick="toggleDateFilterModal(event)">
                <span>ğŸ“…</span>
                <span>${filterLabels[reportDateFilter] || 'Tarih SeÃ§'}</span>
                <span class="date-filter-arrow">â–¼</span>
              </button>
              <div id="dateFilterModal" class="date-filter-modal">
                <div class="date-filter-modal-content">
                  <div class="date-filter-option ${reportDateFilter === 'yesterday' ? 'active' : ''}" onclick="setReportDateFilter('yesterday'); closeDateFilterModal();">
                    <span class="date-filter-icon">ğŸ“†</span>
                    <span>DÃ¼n</span>
                  </div>
                  <div class="date-filter-option ${reportDateFilter === 'week' ? 'active' : ''}" onclick="setReportDateFilter('week'); closeDateFilterModal();">
                    <span class="date-filter-icon">ğŸ“†</span>
                    <span>Son 1 Hafta</span>
                  </div>
                  <div class="date-filter-option ${reportDateFilter === 'month' ? 'active' : ''}" onclick="setReportDateFilter('month'); closeDateFilterModal();">
                    <span class="date-filter-icon">ğŸ“…</span>
                    <span>Son 1 Ay</span>
                  </div>
                  <div class="date-filter-option ${reportDateFilter === 'all' ? 'active' : ''}" onclick="setReportDateFilter('all'); closeDateFilterModal();">
                    <span class="date-filter-icon">ğŸ“Š</span>
                    <span>TÃ¼m Zamanlar</span>
                  </div>
                  <div class="date-filter-divider"></div>
                  <div class="date-filter-option ${reportDateFilter === 'custom' ? 'active' : ''}" onclick="document.getElementById('customDateRangeSection').style.display = 'block';">
                    <span class="date-filter-icon">ğŸ—“ï¸</span>
                    <span>Ã–zel Tarih AralÄ±ÄŸÄ±</span>
                  </div>
                  <div id="customDateRangeSection" class="custom-date-range-section" style="display: ${reportDateFilter === 'custom' ? 'block' : 'none'};">
                    <div class="custom-date-inputs">
                      <div class="custom-date-input-group">
                        <label>BaÅŸlangÄ±Ã§:</label>
                        <input type="date" id="customDateStart" value="${formatDateForInput(customDateRange.start)}" class="custom-date-input">
                      </div>
                      <div class="custom-date-input-group">
                        <label>BitiÅŸ:</label>
                        <input type="date" id="customDateEnd" value="${formatDateForInput(customDateRange.end)}" class="custom-date-input">
                      </div>
                    </div>
                    <button class="custom-date-apply-btn" onclick="setCustomDateRange();">Uygula</button>
                  </div>
                </div>
              </div>
              </div>
            </div>
          </div>
          
          <!-- SeÃ§ilen Zaman Dilimi Ciro ve Masraf Bilgisi -->
          <div class="period-revenue-container">
            <div class="period-revenue-card">
              <div class="period-card-background"></div>
              <div class="period-card-icon">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
              <div class="period-revenue-content">
                <div class="period-revenue-label">
                  <span class="period-label-icon">ğŸ“ˆ</span>
                  <span>SeÃ§ilen Zaman Dilimi Cirosu</span>
                </div>
                <div class="period-revenue-period">${periodInfo}</div>
                <div class="period-revenue-amount">â‚º${totalRevenue.toFixed(2)}</div>
              </div>
              <div class="period-card-decoration">
                <svg viewBox="0 0 200 200" preserveAspectRatio="none">
                  <defs>
                    <linearGradient id="revenueGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                      <stop offset="0%" style="stop-color:rgba(255,255,255,0.15);stop-opacity:1" />
                      <stop offset="100%" style="stop-color:rgba(255,255,255,0);stop-opacity:1" />
                    </linearGradient>
                  </defs>
                  <path d="M0,200 Q50,150 100,120 T200,80 L200,200 Z" fill="url(#revenueGradient)"/>
                </svg>
              </div>
            </div>
            <div class="period-expense-card">
              <div class="period-card-background"></div>
              <div class="period-card-icon">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
              <div class="period-revenue-content">
                <div class="period-revenue-label">
                  <span class="period-label-icon">ğŸ“‰</span>
                  <span>SeÃ§ilen Zaman Dilimi MasrafÄ±</span>
                </div>
                <div class="period-revenue-period">${periodInfo}</div>
                <div class="period-revenue-amount">â‚º${totalExpense.toFixed(2)}</div>
              </div>
              <div class="period-card-decoration">
                <svg viewBox="0 0 200 200" preserveAspectRatio="none">
                  <defs>
                    <linearGradient id="expenseGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                      <stop offset="0%" style="stop-color:rgba(255,255,255,0.15);stop-opacity:1" />
                      <stop offset="100%" style="stop-color:rgba(255,255,255,0);stop-opacity:1" />
                    </linearGradient>
                  </defs>
                  <path d="M0,200 Q50,150 100,120 T200,80 L200,200 Z" fill="url(#expenseGradient)"/>
                </svg>
              </div>
            </div>
            <div class="period-online-revenue-card">
              <div class="period-card-background" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 50%, #6d28d9 100%);"></div>
              <div class="period-card-icon" style="color: rgba(255, 255, 255, 0.95);">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="width: 32px; height: 32px;">
                  <path d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
              <div class="period-revenue-content">
                <div class="period-revenue-label" style="color: rgba(255, 255, 255, 0.95);">
                  <span class="period-label-icon">ğŸŒ</span>
                  <span>SeÃ§ilen Zaman Dilimi Online Cirosu</span>
                </div>
                <div class="period-revenue-period" style="color: rgba(255, 255, 255, 0.8);">${periodInfo}</div>
                <div class="period-revenue-amount" style="color: #ffffff; font-size: 32px; font-weight: 800; text-shadow: 0 2px 8px rgba(0,0,0,0.2);">â‚º${onlineRevenue.toFixed(2)}</div>
                <div style="margin-top: 8px; font-size: 13px; color: rgba(255, 255, 255, 0.85); font-weight: 500;">
                  ${onlineSales.length} online satÄ±ÅŸ
                </div>
              </div>
              <div class="period-card-decoration">
                <svg viewBox="0 0 200 200" preserveAspectRatio="none">
                  <defs>
                    <linearGradient id="onlineRevenueGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                      <stop offset="0%" style="stop-color:rgba(255,255,255,0.2);stop-opacity:1" />
                      <stop offset="100%" style="stop-color:rgba(255,255,255,0);stop-opacity:1" />
                    </linearGradient>
                  </defs>
                  <path d="M0,200 Q50,150 100,120 T200,80 L200,200 Z" fill="url(#onlineRevenueGradient)"/>
                </svg>
              </div>
            </div>
          </div>
          
          <div class="stats-grid">
            <div class="stat-card stat-card-green">
              <div class="stat-icon">ğŸ’°</div>
              <div class="stat-content">
                <h3>Toplam Ciro</h3>
                <div class="stat-value">â‚º${totalRevenue.toFixed(2)}</div>
              </div>
            </div>
            <div class="stat-card stat-card-blue">
              <div class="stat-icon">ğŸ“¦</div>
              <div class="stat-content">
                <h3>Toplam SatÄ±ÅŸ</h3>
                <div class="stat-value">${reportSales.length}</div>
              </div>
            </div>
            <div class="stat-card stat-card-purple">
              <div class="stat-icon">ğŸ“Š</div>
              <div class="stat-content">
                <h3>Ortalama Sepet</h3>
                <div class="stat-value">â‚º${(reportSales.length > 0 ? (totalRevenue / reportSales.length) : 0).toFixed(2)}</div>
              </div>
            </div>
            <div class="stat-card stat-card-orange">
              <div class="stat-icon">ğŸ“ˆ</div>
              <div class="stat-content">
                <h3>En YÃ¼ksek SatÄ±ÅŸ</h3>
                <div class="stat-value">â‚º${(reportSales.length > 0 ? Math.max(...reportSales.map(s => parseFloat(s.total_amount))) : 0).toFixed(2)}</div>
              </div>
            </div>
          </div>

          <div class="reports-container-modern">
            <!-- Ãœst Kutu: YÃ¼kselen Grafik -->
            <div class="report-group report-group-rising">
              <div class="report-group-header">
                <div class="report-group-title">
                  <svg class="chart-icon chart-icon-rising" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 18L9 12L13 16L21 8" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M21 8H15V14" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  <span>YÃ¼kselen Performans</span>
                </div>
                <div class="report-group-chart">
                  <svg class="chart-svg chart-rising" viewBox="0 0 120 40" preserveAspectRatio="none">
                    <defs>
                      <linearGradient id="risingGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#10b981;stop-opacity:0.3" />
                        <stop offset="100%" style="stop-color:#10b981;stop-opacity:0" />
                      </linearGradient>
                    </defs>
                    <path d="M0,35 Q15,25 30,20 T60,15 T90,10 T120,5" fill="url(#risingGradient)" stroke="none"/>
                    <path d="M0,35 Q15,25 30,20 T60,15 T90,10 T120,5" stroke="#10b981" stroke-width="2.5" fill="none" stroke-linecap="round"/>
                    <circle cx="120" cy="5" r="3" fill="#10b981"/>
                  </svg>
                </div>
              </div>
              <div class="report-group-cards">
                <div class="report-card report-card-top-earning">
                  <h3 class="report-card-title">En Ã‡ok KazandÄ±ran ÃœrÃ¼nler</h3>
                  <div class="product-list">
                    ${topProductsByRevenue.length > 0 ? topProductsByRevenue.map(([product, stats], index) => `
                      <div class="product-item">
                        <div class="product-rank">${index + 1}</div>
                        <div class="product-info">
                          <div class="product-name">${product}</div>
                          <div class="product-meta">
                            <span class="product-quantity">${stats.count} adet</span>
                            <span class="product-total product-total-emphasis">â‚º${stats.revenue.toFixed(2)}</span>
                          </div>
                        </div>
                      </div>
                    `).join('') : '<p class="no-data">Veri yok</p>'}
                  </div>
                </div>

                <div class="report-card report-card-top-sold">
                  <h3 class="report-card-title">En Ã‡ok SatÄ±lan ÃœrÃ¼nler</h3>
                  <div class="product-list">
                    ${topProductsByCount.length > 0 ? topProductsByCount.map(([product, stats], index) => `
                      <div class="product-item">
                        <div class="product-rank">${index + 1}</div>
                        <div class="product-info">
                          <div class="product-name">${product}</div>
                          <div class="product-meta">
                            <span class="product-quantity">${stats.count} adet</span>
                            <span class="product-total">â‚º${stats.revenue.toFixed(2)}</span>
                          </div>
                        </div>
                      </div>
                    `).join('') : '<p class="no-data">Veri yok</p>'}
                  </div>
                </div>
              </div>
            </div>

            <!-- Alt Kutu: AlÃ§alan Grafik -->
            <div class="report-group report-group-falling">
              <div class="report-group-header">
                <div class="report-group-title">
                  <svg class="chart-icon chart-icon-falling" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 6L9 12L13 8L21 16" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M21 16H15V10" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  <span>DÃ¼ÅŸÃ¼k Performans</span>
                </div>
                <div class="report-group-chart">
                  <svg class="chart-svg chart-falling" viewBox="0 0 120 40" preserveAspectRatio="none">
                    <defs>
                      <linearGradient id="fallingGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#f59e0b;stop-opacity:0.3" />
                        <stop offset="100%" style="stop-color:#f59e0b;stop-opacity:0" />
                      </linearGradient>
                    </defs>
                    <path d="M0,5 Q15,15 30,20 T60,25 T90,30 T120,35" fill="url(#fallingGradient)" stroke="none"/>
                    <path d="M0,5 Q15,15 30,20 T60,25 T90,30 T120,35" stroke="#f59e0b" stroke-width="2.5" fill="none" stroke-linecap="round"/>
                    <circle cx="120" cy="35" r="3" fill="#f59e0b"/>
                  </svg>
                </div>
              </div>
              <div class="report-group-cards">
                <div class="report-card report-card-least-earning">
                  <h3 class="report-card-title">En Az KazandÄ±ran ÃœrÃ¼nler</h3>
                  <div class="product-list">
                    ${bottomProductsByRevenue.length > 0 ? bottomProductsByRevenue.map(([product, stats], index) => `
                      <div class="product-item">
                        <div class="product-rank">${index + 1}</div>
                        <div class="product-info">
                          <div class="product-name">${product}</div>
                          <div class="product-meta">
                            <span class="product-quantity">${stats.count} adet</span>
                            <span class="product-total">â‚º${stats.revenue.toFixed(2)}</span>
                          </div>
                        </div>
                      </div>
                    `).join('') : '<p class="no-data">Veri yok</p>'}
                  </div>
                </div>

                <div class="report-card report-card-least-sold">
                  <h3 class="report-card-title">En Az SatÄ±lan ÃœrÃ¼nler</h3>
                  <div class="product-list">
                    ${bottomProductsByCount.length > 0 ? bottomProductsByCount.map(([product, stats], index) => `
                      <div class="product-item">
                        <div class="product-rank">${index + 1}</div>
                        <div class="product-info">
                          <div class="product-name">${product}</div>
                          <div class="product-meta">
                            <span class="product-quantity">${stats.count} adet</span>
                            <span class="product-total">â‚º${stats.revenue.toFixed(2)}</span>
                          </div>
                        </div>
                      </div>
                    `).join('') : '<p class="no-data">Veri yok</p>'}
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="report-card">
            <h3 class="report-card-title">ğŸ’³ Ã–deme YÃ¶ntemleri</h3>
            <div class="payment-methods">
              ${Object.entries(paymentMethods).map(([method, data]) => `
                <div class="payment-method-item">
                  <div class="payment-method-header">
                    <span class="payment-method-name">${method}</span>
                    <span class="payment-method-count">${data.count} satÄ±ÅŸ (${reportSales.length > 0 ? ((data.count / reportSales.length) * 100).toFixed(1) : '0'}%)</span>
                  </div>
                  <div class="payment-progress-bar">
                    <div class="payment-progress-fill" style="width: ${reportSales.length > 0 ? (data.count / reportSales.length) * 100 : 0}%"></div>
                  </div>
                  <div class="payment-total">Toplam: â‚º${data.total.toFixed(2)}</div>
                </div>
              `).join('')}
            </div>
          </div>

          <!-- TÃ¼m ÃœrÃ¼nler SatÄ±ÅŸ ve Ciro Tablosu -->
          <div class="report-card" style="margin-top: 24px;">
            <div class="products-table-header">
              <h3 class="products-table-title">
                <span>ğŸ“Š</span>
                <span class="products-table-title-text">TÃ¼m ÃœrÃ¼nler SatÄ±ÅŸ ve Ciro Raporu</span>
              </h3>
              <div class="products-table-period">
                ${periodInfo}
              </div>
            </div>
            <div style="overflow-x: auto;">
              <table class="products-sales-table">
                <thead>
                  <tr>
                    <th class="col-rank">#</th>
                    <th class="col-product">ÃœrÃ¼n AdÄ±</th>
                    <th class="col-quantity">Adet</th>
                    <th class="col-revenue">Ciro</th>
                    <th class="col-percentage">%</th>
                  </tr>
                </thead>
                <tbody>
                  ${productEntries.length > 0 ? productEntries
                    .sort(([, a], [, b]) => b.revenue - a.revenue)
                    .map(([product, stats], index) => {
                      const revenuePercentage = totalRevenue > 0 ? (stats.revenue / totalRevenue * 100) : 0;
                      return `
                        <tr>
                          <td class="col-rank">${index + 1}</td>
                          <td class="col-product">${product}</td>
                          <td class="col-quantity">${stats.count.toLocaleString('tr-TR')}</td>
                          <td class="col-revenue">â‚º${stats.revenue.toFixed(2)}</td>
                          <td class="col-percentage">
                            <div class="percentage-cell">
                              <div class="percentage-bar">
                                <div class="percentage-fill" style="width: ${revenuePercentage}%"></div>
                              </div>
                              <span class="percentage-text">${revenuePercentage.toFixed(1)}%</span>
                            </div>
                          </td>
                        </tr>
                      `;
                    }).join('') : `
                    <tr>
                      <td colspan="5" class="empty-state-cell">
                        <div class="empty-icon-large">ğŸ“¦</div>
                        <div class="empty-title">HenÃ¼z Ã¼rÃ¼n satÄ±ÅŸÄ± yok</div>
                        <div class="empty-subtitle">SatÄ±ÅŸ yapÄ±ldÄ±kÃ§a bu tablo dolacak</div>
                      </td>
                    </tr>
                  `}
                </tbody>
                <tfoot>
                  <tr class="table-footer">
                    <td colspan="2" class="footer-label">TOPLAM</td>
                    <td class="footer-quantity">${productEntries.reduce((sum, [, stats]) => sum + stats.count, 0).toLocaleString('tr-TR')}</td>
                    <td class="footer-revenue">â‚º${productEntries.reduce((sum, [, stats]) => sum + stats.revenue, 0).toFixed(2)}</td>
                    <td class="footer-percentage">100%</td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>
        </div>
      `;

      container.innerHTML = html;
    }

    // TÃ¼m masalarÄ± render et (helper function)
    function renderAllTables(allStaticTables) {
      const container = document.getElementById('tablesContainer');
      if (!container || activeTab !== 'tables') {
        return;
      }

      // MasalarÄ± kategorilere ayÄ±r
      const insideTables = [];
      const outsideTables = [];
      const packageTablesInside = [];
      const packageTablesOutside = [];

      Object.values(allStaticTables).forEach(table => {
        if (table.table_id.startsWith('inside-') && !table.table_id.startsWith('package-')) {
          insideTables.push(table);
        } else if (table.table_id.startsWith('outside-') && !table.table_id.startsWith('package-')) {
          outsideTables.push(table);
        } else if (table.table_id.startsWith('package-inside-')) {
          packageTablesInside.push(table);
        } else if (table.table_id.startsWith('package-outside-')) {
          packageTablesOutside.push(table);
        }
      });

      // SÄ±rala
      insideTables.sort((a, b) => a.table_number - b.table_number);
      outsideTables.sort((a, b) => a.table_number - b.table_number);
      packageTablesInside.sort((a, b) => a.table_number - b.table_number);
      packageTablesOutside.sort((a, b) => a.table_number - b.table_number);

      // Render
      let html = `
        <div class="tables-container">
          <div class="tables-section">
            <h2 class="section-title">ğŸ“‹ Ä°Ã§eri Masalar</h2>
            <div class="tables-grid">
              ${insideTables.map(table => renderTableCard(table)).join('')}
            </div>
          </div>
          
          <div class="tables-section">
            <h2 class="section-title">â˜€ï¸ DÄ±ÅŸarÄ± Masalar</h2>
            <div class="tables-grid">
              ${outsideTables.map(table => renderTableCard(table)).join('')}
            </div>
          </div>
          
          <div class="tables-section">
            <h2 class="section-title">ğŸ“¦ Paket MasalarÄ±</h2>
            <div class="tables-grid package-grid">
              ${[...packageTablesInside, ...packageTablesOutside].map(table => renderTableCard(table)).join('')}
            </div>
          </div>
        </div>
      `;

      container.innerHTML = html;
      console.log('âœ… TÃ¼m masalar render edildi');
      
      // Aktif masa sayÄ±sÄ±nÄ± gÃ¼ncelle (sadece iÃ§ ve dÄ±ÅŸ masalar)
      updateActiveTablesCount(calculateActiveTablesCount());
    }

    // Masalar render et
    function renderTables() {
      console.log('ğŸª‘ renderTables Ã§aÄŸrÄ±ldÄ±');
      const container = document.getElementById('tablesContainer');
      if (!container) {
        console.error('âŒ tablesContainer bulunamadÄ±');
        return;
      }

      // Loading gÃ¶ster
      container.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">â³</div>
          <h3>Masalar yÃ¼kleniyor...</h3>
        </div>
      `;

      // Yeni Firebase'den masalarÄ± dinle (makaramasalar)
      if (!tablesDb) {
        console.warn('âš ï¸ tablesDb bulunamadÄ± - sadece statik masalar gÃ¶sterilecek');
        // Firebase olmasa bile tÃ¼m masalarÄ± gÃ¶ster
        allStaticTables = {};
        for (let i = 1; i <= 20; i++) {
          allStaticTables[`inside-${i}`] = {
            table_id: `inside-${i}`,
            table_name: `Ä°Ã§eri ${i}`,
            table_type: 'inside',
            table_number: i,
            is_occupied: false,
            total_amount: 0,
            items: []
          };
        }
        for (let i = 1; i <= 24; i++) {
          allStaticTables[`outside-${i}`] = {
            table_id: `outside-${i}`,
            table_name: `DÄ±ÅŸarÄ± ${i}`,
            table_type: 'outside',
            table_number: i,
            is_occupied: false,
            total_amount: 0,
            items: []
          };
        }
        for (let i = 1; i <= 5; i++) {
          allStaticTables[`package-inside-${i}`] = {
            table_id: `package-inside-${i}`,
            table_name: `Paket ${i}`,
            table_type: 'inside',
            table_number: i,
            is_occupied: false,
            total_amount: 0,
            items: []
          };
        }
        for (let i = 1; i <= 5; i++) {
          allStaticTables[`package-outside-${i}`] = {
            table_id: `package-outside-${i}`,
            table_name: `Paket ${i}`,
            table_type: 'outside',
            table_number: i,
            is_occupied: false,
            total_amount: 0,
            items: []
          };
        }
        renderAllTables(allStaticTables);
        // Aktif masa sayÄ±sÄ±nÄ± gÃ¼ncelle
        updateActiveTablesCount(calculateActiveTablesCount());
        return;
      }

      console.log('âœ… tablesDb mevcut, masalar dinleniyor...');

      // Ã–nceki listener'Ä± temizle
      if (tablesUnsubscribe) {
        tablesUnsubscribe();
        tablesUnsubscribe = null;
      }

      // TÃœM masalarÄ± statik olarak oluÅŸtur (masaÃ¼stÃ¼ uygulamasÄ±ndaki gibi)
      // Global allStaticTables objesini kullan
      allStaticTables = {};
      
      // Ä°Ã§eri masalar (1-20)
      for (let i = 1; i <= 20; i++) {
        const tableId = `inside-${i}`;
        allStaticTables[tableId] = {
          table_id: tableId,
          table_name: `Ä°Ã§eri ${i}`,
          table_type: 'inside',
          table_number: i,
          is_occupied: false,
          total_amount: 0,
          items: []
        };
      }
      
      // DÄ±ÅŸarÄ± masalar (61-84)
      for (let i = 1; i <= 24; i++) {
        const tableId = `outside-${i}`;
        allStaticTables[tableId] = {
          table_id: tableId,
          table_name: `DÄ±ÅŸarÄ± ${i + 60}`,
          table_type: 'outside',
          table_number: i + 60,
          is_occupied: false,
          total_amount: 0,
          items: []
        };
      }
      
      // Paket masalarÄ± - Ä°Ã§eri (1-5)
      for (let i = 1; i <= 5; i++) {
        const tableId = `package-inside-${i}`;
        allStaticTables[tableId] = {
          table_id: tableId,
          table_name: `Paket ${i}`,
          table_type: 'inside',
          table_number: i,
          is_occupied: false,
          total_amount: 0,
          items: []
        };
      }
      
      // Paket masalarÄ± - DÄ±ÅŸarÄ± (1-5)
      for (let i = 1; i <= 5; i++) {
        const tableId = `package-outside-${i}`;
        allStaticTables[tableId] = {
          table_id: tableId,
          table_name: `Paket ${i}`,
          table_type: 'outside',
          table_number: i,
          is_occupied: false,
          total_amount: 0,
          items: []
        };
      }

      console.log(`ğŸ“‹ Toplam ${Object.keys(allStaticTables).length} statik masa oluÅŸturuldu`);

      // Ä°lk render - tÃ¼m masalarÄ± gÃ¶ster (Firebase verisi olmasa bile)
      renderAllTables(allStaticTables);
      
      // Aktif masa sayÄ±sÄ±nÄ± gÃ¼ncelle
      updateActiveTablesCount(calculateActiveTablesCount());

      const tablesRef = tablesDb.collection('tables');
      console.log('ğŸ“¡ Firebase collection dinleniyor: tables');
      
      tablesUnsubscribe = tablesRef.onSnapshot((snapshot) => {
        console.log(`ğŸ“Š Masalar snapshot alÄ±ndÄ±: ${snapshot.size} Firebase verisi bulundu`);
        // Aktif sekme kontrolÃ¼ - eÄŸer masalar sekmesinde deÄŸilsek, render etme
        if (activeTab !== 'tables') {
          return;
        }

        // Firebase'den gelen verileri statik masalarla birleÅŸtir
        snapshot.forEach((doc) => {
          const firebaseData = doc.data();
          const tableId = firebaseData.table_id || doc.id;
          
          if (allStaticTables[tableId]) {
            const previousIsOccupied = previousTableStates[tableId] !== undefined ? previousTableStates[tableId] : (allStaticTables[tableId].is_occupied || false);
            
            // Firebase'den gelen verileri statik masaya ekle
            allStaticTables[tableId].is_occupied = firebaseData.is_occupied === true || 
                                                   firebaseData.is_occupied === 'true' || 
                                                   firebaseData.is_occupied === 1 ||
                                                   (firebaseData.items && Array.isArray(firebaseData.items) && firebaseData.items.length > 0);
            allStaticTables[tableId].total_amount = parseFloat(firebaseData.total_amount || 0);
            allStaticTables[tableId].items = Array.isArray(firebaseData.items) ? firebaseData.items : [];
            allStaticTables[tableId].order_id = firebaseData.order_id || null;
            allStaticTables[tableId].order_date = firebaseData.order_date || null;
            allStaticTables[tableId].order_time = firebaseData.order_time || null;
            allStaticTables[tableId].order_note = firebaseData.order_note || null;
            console.log(`âœ… Masa gÃ¼ncellendi: ${tableId} - Dolu: ${allStaticTables[tableId].is_occupied}, Tutar: ${allStaticTables[tableId].total_amount}`);
            
            // Yeni sipariÅŸ kontrolÃ¼: BoÅŸtan doluya geÃ§iÅŸ (ilk yÃ¼klemede gÃ¶sterme)
            const currentIsOccupied = allStaticTables[tableId].is_occupied;
            if (!isFirstTablesLoad && !previousIsOccupied && currentIsOccupied) {
              // Yeni sipariÅŸ geldi - toast gÃ¶ster
              const tableName = allStaticTables[tableId].table_name || tableId;
              showToast('success', 'Yeni SipariÅŸ', `${tableName} iÃ§in sipariÅŸ girildi`);
            }
            
            // Durumu kaydet
            previousTableStates[tableId] = currentIsOccupied;
          }
        });
        
        // Ä°lk yÃ¼kleme tamamlandÄ±
        if (isFirstTablesLoad) {
          isFirstTablesLoad = false;
        }
        
        // Aktif masa sayÄ±sÄ±nÄ± gÃ¼ncelle (sadece iÃ§ ve dÄ±ÅŸ masalar)
        updateActiveTablesCount(calculateActiveTablesCount());

        // MasalarÄ± kategorilere ayÄ±r
        const insideTables = [];
        const outsideTables = [];
        const packageTablesInside = [];
        const packageTablesOutside = [];

        Object.values(allStaticTables).forEach(table => {
          if (table.table_id.startsWith('inside-') && !table.table_id.startsWith('package-')) {
            insideTables.push(table);
          } else if (table.table_id.startsWith('outside-') && !table.table_id.startsWith('package-')) {
            outsideTables.push(table);
          } else if (table.table_id.startsWith('package-inside-')) {
            packageTablesInside.push(table);
          } else if (table.table_id.startsWith('package-outside-')) {
            packageTablesOutside.push(table);
          }
        });

        console.log(`ğŸ“Š Kategoriler: Ä°Ã§eri: ${insideTables.length}, DÄ±ÅŸarÄ±: ${outsideTables.length}, Paket Ä°Ã§: ${packageTablesInside.length}, Paket DÄ±ÅŸ: ${packageTablesOutside.length}`);

        // SÄ±rala (zaten sÄ±ralÄ± ama emin olmak iÃ§in)
        insideTables.sort((a, b) => a.table_number - b.table_number);
        outsideTables.sort((a, b) => a.table_number - b.table_number);
        packageTablesInside.sort((a, b) => a.table_number - b.table_number);
        packageTablesOutside.sort((a, b) => a.table_number - b.table_number);

        // Render - tekrar aktif sekme kontrolÃ¼
        if (activeTab !== 'tables') {
          return;
        }

        // Render iÅŸlemini requestAnimationFrame ile optimize et - yanÄ±p sÃ¶nmeyi Ã¶nler
        requestAnimationFrame(() => {
          // Tekrar aktif sekme kontrolÃ¼
          if (activeTab !== 'tables') {
            return;
          }

          // TÃ¼m masalarÄ± render et
          renderAllTables(allStaticTables);
        });
      }, (error) => {
        console.error('Masalar yÃ¼klenirken hata:', error);
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">âš ï¸</div>
            <h3>Masalar yÃ¼klenemedi</h3>
            <p>${error.message || 'Bilinmeyen hata'}</p>
          </div>
        `;
      });
    }

    // Masa kartÄ± render et
    function renderTableCard(table) {
      // Masa durumunu saÄŸlam bir ÅŸekilde kontrol et
      const isOccupied = table.is_occupied === true || 
                        table.is_occupied === 'true' || 
                        table.is_occupied === 1 ||
                        (table.status && (table.status === 'occupied' || table.status === 'dolu')) ||
                        (table.items && Array.isArray(table.items) && table.items.length > 0);
      
      const totalAmount = parseFloat(table.total_amount || 0);
      const items = Array.isArray(table.items) ? table.items : [];
      const itemsCount = items.reduce((sum, item) => sum + (item.quantity || 0), 0);
      
      const isInside = table.table_type === 'inside' || table.table_id.startsWith('inside-') || table.table_id.startsWith('package-inside-');
      const isOutside = table.table_type === 'outside' || table.table_id.startsWith('outside-') || table.table_id.startsWith('package-outside-');
      
      // Renkleri belirle
      let bgColor, borderColor, statusColor, statusText;
      if (isOccupied) {
        // Dolu masalar: kan kÄ±rmÄ±zÄ±
        bgColor = '#dc2626';
        borderColor = '#b91c1c';
        statusColor = '#ffffff';
        statusText = 'Dolu';
      } else {
        // BoÅŸ masalar
        if (isInside) {
          // Ä°Ã§ masalar: aÃ§Ä±k pembe
          bgColor = '#fce7f3';
          borderColor = '#f9a8d4';
          statusColor = '#ec4899';
        } else if (isOutside) {
          // DÄ±ÅŸ masalar: aÃ§Ä±k sarÄ±
          bgColor = '#fef3c7';
          borderColor = '#fde68a';
          statusColor = '#d97706';
        } else {
          // VarsayÄ±lan
          bgColor = '#f3f4f6';
          borderColor = '#d1d5db';
          statusColor = '#6b7280';
        }
        statusText = 'BoÅŸ';
      }
      
      let itemsHtml = '';
      if (isOccupied && items.length > 0) {
        itemsHtml = `
          <div class="table-items">
            <div class="table-items-title">Ä°Ã§erik:</div>
            <div class="table-items-list">
              ${items.slice(0, 5).map(item => `
                <div class="table-item">
                  <span class="item-name">${item.product_name}</span>
                  <span class="item-quantity">x${item.quantity}</span>
                  ${item.isGift ? '<span class="item-gift">Ä°KRAM</span>' : ''}
                </div>
              `).join('')}
              ${items.length > 5 ? `<div class="table-item-more">+${items.length - 5} daha...</div>` : ''}
            </div>
          </div>
        `;
      }

      // Dolu masalar iÃ§in modern gradient kÄ±rmÄ±zÄ± tasarÄ±m
      if (isOccupied) {
        return `
          <div class="table-card table-card-occupied">
            <div class="table-card-gradient">
              <div class="table-number-occupied">${table.table_number}</div>
              <div class="table-amount-occupied">â‚º${totalAmount.toFixed(2)}</div>
            </div>
          </div>
        `;
      }

      // BoÅŸ masalar iÃ§in mevcut tasarÄ±m
      return `
        <div class="table-card" style="background: ${bgColor}; border-color: ${borderColor};">
          <div class="table-card-header">
            <div class="table-number" style="color: var(--text-main);">${table.table_number}</div>
            <div class="table-status" style="background: ${statusColor}20; color: ${statusColor};">
              ${statusText}
            </div>
          </div>
          <div class="table-name" style="color: var(--text-main);">${table.table_name}</div>
        </div>
      `;
    }

    // Personel DetaylarÄ± render et
    // Ä°ptaller listesini render et
    function renderCancels(resetCount = false) {
      const container = document.getElementById('cancelsContainer');
      if (!container) return;

      if (!db) {
        container.innerHTML = '<div class="error-message">Firebase baÄŸlantÄ±sÄ± kurulamadÄ±</div>';
        return;
      }

      // Ä°lk yÃ¼klemede veya reset edildiÄŸinde sayacÄ± sÄ±fÄ±rla
      if (resetCount) {
        cancelsDisplayedCount = 2;
      }

      // allCancels'dan lazy loading ile gÃ¶ster
      if (allCancels.length === 0) {
        container.innerHTML = `
          <div style="text-align: center; padding: 60px 20px; color: #6b7280;">
            <div style="font-size: 48px; margin-bottom: 16px;">â³</div>
            <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">Ä°ptal kayÄ±tlarÄ± yÃ¼kleniyor...</div>
          </div>
        `;
        return;
      }

      // Lazy loading: Sadece gÃ¶sterilecek kadar iptal al
      const cancelsToDisplay = allCancels.slice(0, cancelsDisplayedCount);
      const hasMore = allCancels.length > cancelsDisplayedCount;

      if (cancelsToDisplay.length === 0) {
        container.innerHTML = `
          <div style="text-align: center; padding: 60px 20px; color: #6b7280;">
            <div style="font-size: 48px; margin-bottom: 16px;">ğŸ“­</div>
            <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">HenÃ¼z iptal kaydÄ± yok</div>
            <div style="font-size: 14px;">Ä°ptal edilen Ã¼rÃ¼nler burada gÃ¶rÃ¼necek</div>
          </div>
        `;
        return;
      }

      let html = '<div class="cancels-list">';
      
      cancelsToDisplay.forEach((cancel) => {
          const cancelDate = cancel.cancel_date || 'Bilinmeyen';
          const cancelTime = cancel.cancel_time || '';
          const staffName = cancel.staff_name || 'Bilinmiyor';
          const orderStaffName = cancel.order_staff_name || 'Bilinmiyor';
          const staffIsManager = cancel.staff_is_manager || false;
          const source = cancel.source === 'mobile' ? 'ğŸ“± Mobil' : 'ğŸ’» MasaÃ¼stÃ¼';
          const totalAmount = (cancel.price || 0) * (cancel.quantity || 0);
          
          html += `
            <div class="cancel-card">
              <div class="cancel-header">
                <div class="cancel-header-left">
                  <div class="cancel-product-name">${cancel.product_name || 'Bilinmeyen ÃœrÃ¼n'}</div>
                  <div class="cancel-meta">
                    <span class="cancel-meta-item">${cancelDate} ${cancelTime}</span>
                    <span class="cancel-meta-separator">â€¢</span>
                    <span class="cancel-meta-item">${cancel.table_name || 'Bilinmeyen Masa'}</span>
                    <span class="cancel-meta-separator">â€¢</span>
                    <span class="cancel-meta-item">${source}</span>
                  </div>
                </div>
                <div class="cancel-header-right">
                  <div class="cancel-amount">â‚º${totalAmount.toFixed(2)}</div>
                </div>
              </div>
              <div class="cancel-details">
                <div class="cancel-detail-row">
                  <span class="cancel-detail-label">Miktar:</span>
                  <span class="cancel-detail-value">${cancel.quantity || 0} adet</span>
                </div>
                <div class="cancel-detail-row">
                  <span class="cancel-detail-label">Birim Fiyat:</span>
                  <span class="cancel-detail-value">â‚º${(cancel.price || 0).toFixed(2)}</span>
                </div>
                <div class="cancel-detail-row">
                  <span class="cancel-detail-label">Ä°ptal Eden Personel:</span>
                  <span class="cancel-detail-value">
                    ${staffName || 'Bilinmiyor'}${staffIsManager ? ' (MÃ¼dÃ¼r)' : ''}
                  </span>
                </div>
                <div class="cancel-detail-row">
                  <span class="cancel-detail-label">SipariÅŸ Sorumlusu Garson:</span>
                  <span class="cancel-detail-value">${orderStaffName || 'Bilinmiyor'}</span>
                </div>
              </div>
              <div class="cancel-reason">
                <div class="cancel-reason-label">Ä°ptal AÃ§Ä±klamasÄ±:</div>
                <div class="cancel-reason-text">${cancel.cancel_reason || 'AÃ§Ä±klama yok'}</div>
              </div>
            </div>
          `;
      });

      html += '</div>';
      
      // "Daha fazla yÃ¼kle" butonu
      if (hasMore) {
        html += `
          <div id="cancelsLoadMore" style="text-align: center; padding: 20px; margin-top: 20px;">
            <button onclick="loadMoreCancels()" style="padding: 12px 24px; background: #3b82f6; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s;">
              Daha Fazla YÃ¼kle (${allCancels.length - cancelsDisplayedCount} kaldÄ±)
            </button>
          </div>
        `;
      }
      
      container.innerHTML = html;
      
      // Scroll event listener ekle (otomatik yÃ¼kleme iÃ§in)
      setupCancelsScrollListener();
    }

    // Daha fazla iptal yÃ¼kle
    function loadMoreCancels() {
      if (isLoadingMoreCancels) return;
      isLoadingMoreCancels = true;
      
      const loadMoreBtn = document.getElementById('cancelsLoadMore');
      if (loadMoreBtn) {
        loadMoreBtn.innerHTML = '<div style="padding: 12px; color: #6b7280;">YÃ¼kleniyor...</div>';
      }
      
      // 2'ÅŸer 2'ÅŸer artÄ±r
      cancelsDisplayedCount += 2;
      
      // KÄ±sa bir gecikme sonra render et (smooth loading iÃ§in)
      setTimeout(() => {
        renderCancels(false);
        isLoadingMoreCancels = false;
      }, 300);
    }

    // Ä°ptaller iÃ§in scroll listener
    function setupCancelsScrollListener() {
      // Eski listener'Ä± kaldÄ±r
      window.removeEventListener('scroll', handleCancelsScroll);
      window.removeEventListener('scroll', handleCancelsScroll, true);
      
      // Yeni listener ekle (window scroll iÃ§in)
      window.addEventListener('scroll', handleCancelsScroll, true);
    }

    // Ä°ptaller scroll handler
    function handleCancelsScroll(event) {
      if (isLoadingMoreCancels || activeTab !== 'cancels') return;
      
      const container = document.getElementById('cancelsContainer');
      if (!container) return;
      
      // Scroll pozisyonu kontrol et (alt kÄ±sma yaklaÅŸÄ±ldÄ±ÄŸÄ±nda)
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      const windowHeight = window.innerHeight;
      const documentHeight = document.documentElement.scrollHeight;
      const scrollBottom = documentHeight - scrollTop - windowHeight;
      
      // 200px kala daha fazla yÃ¼kle
      if (scrollBottom < 200) {
        if (cancelsDisplayedCount < allCancels.length) {
          loadMoreCancels();
        }
      }
    }


    // Toast Notification FonksiyonlarÄ±
    function showToast(type, title, message) {
      // Bildirimi geÃ§miÅŸe ekle
      const notification = {
        id: Date.now(),
        type: type,
        title: title,
        message: message,
        timestamp: new Date(),
        read: false
      };
      notificationsHistory.unshift(notification); // En yeni baÅŸa ekle
      unreadNotificationsCount++;
      updateNotificationsBadge();
      
      // GeÃ§miÅŸi localStorage'a kaydet (son 100 bildirim)
      if (notificationsHistory.length > 100) {
        notificationsHistory = notificationsHistory.slice(0, 100);
      }
      try {
        localStorage.setItem('notificationsHistory', JSON.stringify(notificationsHistory.map(n => ({
          ...n,
          timestamp: n.timestamp.toISOString()
        }))));
      } catch (e) {
        console.warn('Bildirim geÃ§miÅŸi kaydedilemedi:', e);
      }
      
      // EÄŸer sessize alÄ±ndÄ±ysa, toast gÃ¶sterme, sadece geÃ§miÅŸe ekle
      if (notificationsMuted) {
        return;
      }
      
      // Mevcut toast'Ä± kaldÄ±r
      const existingToast = document.getElementById('toastNotification');
      if (existingToast) {
        existingToast.remove();
      }

      // Yeni toast oluÅŸtur
      const toast = document.createElement('div');
      toast.id = 'toastNotification';
      toast.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 10001;
        background: ${type === 'success' ? 'linear-gradient(135deg, #10b981 0%, #059669 100%)' : 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)'};
        color: white;
        padding: 20px 24px;
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3), 0 0 0 1px rgba(255,255,255,0.1) inset;
        display: flex;
        align-items: center;
        gap: 16px;
        min-width: 320px;
        max-width: 420px;
        animation: toastSlideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        backdrop-filter: blur(10px);
      `;

      const icon = type === 'success' 
        ? '<svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>'
        : '<svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>';

      toast.innerHTML = `
        <div style="width: 40px; height: 40px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
          ${icon}
        </div>
        <div style="flex: 1;">
          <div style="font-size: 14px; font-weight: 700; margin-bottom: 4px; opacity: 0.95;">${title}</div>
          <div style="font-size: 15px; font-weight: 500; line-height: 1.4;">${message}</div>
        </div>
        <button onclick="hideToast()" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 28px; height: 28px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: all 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">
          <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      `;

      document.body.appendChild(toast);

      // Otomatik kapat (varsayÄ±lan 3 saniye, masa sipariÅŸi iÃ§in 2 saniye)
      const autoCloseTime = type === 'success' && message.includes('sipariÅŸ girildi') ? 2000 : 3000;
      setTimeout(() => {
        hideToast();
      }, autoCloseTime);
    }

    function hideToast() {
      const toast = document.getElementById('toastNotification');
      if (toast) {
        toast.style.animation = 'toastSlideOut 0.3s ease forwards';
        setTimeout(() => {
          toast.remove();
        }, 300);
      }
    }

    // Push Notification Ä°zni Ä°ste
    async function requestNotificationPermission() {
      if (!('Notification' in window)) {
        console.log('Bu tarayÄ±cÄ± bildirimleri desteklemiyor');
        return false;
      }

      if (Notification.permission === 'granted') {
        return true;
      }

      if (Notification.permission !== 'denied') {
        const permission = await Notification.requestPermission();
        return permission === 'granted';
      }

      return false;
    }

    // Push Notification GÃ¶nder
    async function sendPushNotification(title, message, options = {}) {
      // Bildirimi geÃ§miÅŸe ekle
      const notificationData = {
        id: Date.now(),
        type: 'info',
        title: title,
        message: message,
        timestamp: new Date(),
        read: false
      };
      notificationsHistory.unshift(notificationData);
      unreadNotificationsCount++;
      updateNotificationsBadge();
      
      // localStorage'a kaydet
      try {
        if (notificationsHistory.length > 100) {
          notificationsHistory = notificationsHistory.slice(0, 100);
        }
        localStorage.setItem('notificationsHistory', JSON.stringify(notificationsHistory.map(n => ({
          ...n,
          timestamp: n.timestamp.toISOString()
        }))));
      } catch (e) {
        console.warn('Bildirim geÃ§miÅŸi kaydedilemedi:', e);
      }

      // EÄŸer sessize alÄ±ndÄ±ysa, push notification gÃ¶sterme, sadece geÃ§miÅŸe ekle
      if (notificationsMuted) {
        return;
      }

      if (!('Notification' in window)) {
        return;
      }

      const hasPermission = await requestNotificationPermission();
      if (!hasPermission) {
        return;
      }

      const notificationOptions = {
        body: message,
        icon: '/patron.png',
        badge: '/patron.png',
        tag: 'makara-notification',
        requireInteraction: false,
        ...options
      };

      try {
        const notification = new Notification(title, notificationOptions);

        // Bildirim tÄ±klandÄ±ÄŸÄ±nda
        notification.onclick = function() {
          window.focus();
          notification.close();
        };

        // Otomatik kapat (5 saniye)
        setTimeout(() => {
          notification.close();
        }, 5000);
      } catch (error) {
        console.error('Bildirim gÃ¶nderilemedi:', error);
      }
    }

    // GÃ¼nlÃ¼k Ciro Bildirimi KontrolÃ¼
    function checkRevenueNotification(todayRevenue) {
      const REVENUE_THRESHOLD = 50000; // 50.000 TL
      const today = new Date();
      const todayDateString = today.toDateString();

      // EÄŸer bugÃ¼n iÃ§in daha Ã¶nce bildirim gÃ¶nderildiyse, tekrar gÃ¶nderme
      if (lastRevenueNotificationDate === todayDateString && revenueNotificationSent) {
        return;
      }

      // EÄŸer ciro 50.000 TL'yi geÃ§tiyse
      if (todayRevenue >= REVENUE_THRESHOLD && !revenueNotificationSent) {
        // BugÃ¼n iÃ§in bildirim gÃ¶nderildi olarak iÅŸaretle
        revenueNotificationSent = true;
        lastRevenueNotificationDate = todayDateString;
        
        // localStorage'a kaydet
        try {
          localStorage.setItem('revenueNotificationSent', 'true');
          localStorage.setItem('lastRevenueNotificationDate', todayDateString);
        } catch (e) {
          console.warn('Bildirim durumu kaydedilemedi:', e);
        }

        // Push notification gÃ¶nder
        sendPushNotification(
          'ğŸ‰ Tebrikler!',
          `GÃ¼nlÃ¼k cironuz â‚º${todayRevenue.toFixed(2)} ile â‚º50.000 TL'yi geÃ§ti!`,
          {
            badge: '/patron.png',
            icon: '/patron.png',
            tag: 'revenue-milestone'
          }
        );
      }
    }

    // Sayfa yÃ¼klendiÄŸinde bildirim durumunu kontrol et
    function loadRevenueNotificationState() {
      try {
        const today = new Date().toDateString();
        const savedDate = localStorage.getItem('lastRevenueNotificationDate');
        
        // EÄŸer bugÃ¼n iÃ§in kayÄ±t varsa
        if (savedDate === today) {
          revenueNotificationSent = localStorage.getItem('revenueNotificationSent') === 'true';
          lastRevenueNotificationDate = savedDate;
        } else {
          // Yeni gÃ¼n, durumu sÄ±fÄ±rla
          revenueNotificationSent = false;
          lastRevenueNotificationDate = null;
          localStorage.removeItem('revenueNotificationSent');
          localStorage.removeItem('lastRevenueNotificationDate');
        }
      } catch (e) {
        console.warn('Bildirim durumu yÃ¼klenemedi:', e);
      }
    }

    // Bildirim Badge'ini GÃ¼ncelle
    function updateNotificationsBadge() {
      const badge = document.getElementById('notificationsBadge');
      if (badge) {
        if (unreadNotificationsCount > 0) {
          badge.textContent = unreadNotificationsCount > 99 ? '99+' : unreadNotificationsCount;
          badge.style.display = 'flex';
        } else {
          badge.style.display = 'none';
        }
      }
    }

    // Bildirim GeÃ§miÅŸini YÃ¼kle (localStorage'dan)
    function loadNotificationsHistory() {
      try {
        const saved = localStorage.getItem('notificationsHistory');
        if (saved) {
          const parsed = JSON.parse(saved);
          notificationsHistory = parsed.map(n => ({
            ...n,
            timestamp: new Date(n.timestamp),
            read: n.read || false
          }));
          // OkunmamÄ±ÅŸ bildirim sayÄ±sÄ±nÄ± hesapla
          unreadNotificationsCount = notificationsHistory.filter(n => !n.read).length;
          updateNotificationsBadge();
        }
      } catch (e) {
        console.warn('Bildirim geÃ§miÅŸi yÃ¼klenemedi:', e);
      }
    }

    // Bildirim Modal'Ä±nÄ± GÃ¶ster
    function showNotificationsModal() {
      const modal = document.getElementById('notificationsModal');
      if (!modal) return;
      
      // TÃ¼m bildirimleri okundu olarak iÅŸaretle
      notificationsHistory.forEach(n => n.read = true);
      unreadNotificationsCount = 0;
      updateNotificationsBadge();
      
      // GeÃ§miÅŸi gÃ¼ncelle
      try {
        localStorage.setItem('notificationsHistory', JSON.stringify(notificationsHistory.map(n => ({
          ...n,
          timestamp: n.timestamp.toISOString()
        }))));
      } catch (e) {
        console.warn('Bildirim geÃ§miÅŸi kaydedilemedi:', e);
      }
      
      // Sessize al buton durumunu gÃ¼ncelle
      updateMuteButtonState();
      
      // Modal iÃ§eriÄŸini oluÅŸtur
      renderNotificationsModal();
      modal.style.display = 'flex';
    }

    // Sessize Al Buton Durumunu GÃ¼ncelle
    function updateMuteButtonState() {
      const muteBtn = document.getElementById('muteNotificationsBtn');
      const muteIcon = document.getElementById('muteIcon');
      const muteText = document.getElementById('muteText');
      const notificationsIcon = document.getElementById('notificationsIcon');
      
      if (!muteBtn || !muteIcon || !muteText || !notificationsIcon) return;
      
      if (notificationsMuted) {
        muteIcon.textContent = 'ğŸ”‡';
        muteText.textContent = 'Sessize AlÄ±ndÄ±';
        muteBtn.style.background = '#fee2e2';
        muteBtn.style.color = '#dc2626';
        notificationsIcon.textContent = 'ğŸ”•';
      } else {
        muteIcon.textContent = 'ğŸ”Š';
        muteText.textContent = 'Sessize Al';
        muteBtn.style.background = '#f3f4f6';
        muteBtn.style.color = '#6b7280';
        notificationsIcon.textContent = 'ğŸ””';
      }
    }

    // Bildirimleri Sessize Al/AÃ§
    function toggleNotificationsMute() {
      notificationsMuted = !notificationsMuted;
      
      // localStorage'a kaydet
      try {
        localStorage.setItem('notificationsMuted', notificationsMuted ? 'true' : 'false');
      } catch (e) {
        console.warn('Sessize al durumu kaydedilemedi:', e);
      }
      
      // Buton durumunu gÃ¼ncelle
      updateMuteButtonState();
      
      // Toast gÃ¶ster (sessize alÄ±ndÄ±ysa - ama bu toast sessize alÄ±ndÄ±ÄŸÄ±nda gÃ¶sterilmez Ã§Ã¼nkÃ¼ showToast iÃ§inde kontrol var)
      // Bu yÃ¼zden direkt toast gÃ¶sterelim
      if (notificationsMuted) {
        // Sessize alÄ±ndÄ± mesajÄ± iÃ§in Ã¶zel toast (sessize al kontrolÃ¼nÃ¼ bypass et)
        const existingToast = document.getElementById('toastNotification');
        if (existingToast) {
          existingToast.remove();
        }
        const toast = document.createElement('div');
        toast.id = 'toastNotification';
        toast.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          z-index: 10001;
          background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
          color: white;
          padding: 20px 24px;
          border-radius: 16px;
          box-shadow: 0 20px 60px rgba(0,0,0,0.3);
          display: flex;
          align-items: center;
          gap: 16px;
          min-width: 280px;
          animation: toastSlideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        `;
        toast.innerHTML = `
          <div style="font-size: 16px; font-weight: 600;">ğŸ”‡ Bildirimler sessize alÄ±ndÄ±</div>
        `;
        document.body.appendChild(toast);
        setTimeout(() => {
          toast.style.animation = 'toastSlideOut 0.3s ease forwards';
          setTimeout(() => toast.remove(), 300);
        }, 2000);
      } else {
        const existingToast = document.getElementById('toastNotification');
        if (existingToast) {
          existingToast.remove();
        }
        const toast = document.createElement('div');
        toast.id = 'toastNotification';
        toast.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          z-index: 10001;
          background: linear-gradient(135deg, #10b981 0%, #059669 100%);
          color: white;
          padding: 20px 24px;
          border-radius: 16px;
          box-shadow: 0 20px 60px rgba(0,0,0,0.3);
          display: flex;
          align-items: center;
          gap: 16px;
          min-width: 280px;
          animation: toastSlideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        `;
        toast.innerHTML = `
          <div style="font-size: 16px; font-weight: 600;">ğŸ”Š Bildirimler aÃ§Ä±ldÄ±</div>
        `;
        document.body.appendChild(toast);
        setTimeout(() => {
          toast.style.animation = 'toastSlideOut 0.3s ease forwards';
          setTimeout(() => toast.remove(), 300);
        }, 2000);
      }
    }

    // Sessize Al Durumunu YÃ¼kle
    function loadNotificationsMuteState() {
      try {
        const saved = localStorage.getItem('notificationsMuted');
        notificationsMuted = saved === 'true';
      } catch (e) {
        console.warn('Sessize al durumu yÃ¼klenemedi:', e);
        notificationsMuted = false;
      }
    }

    // Online SipariÅŸler Real-time Listener
    function startOnlineOrdersListener() {
      if (!onlineDb) {
        console.warn('âš ï¸ Online Firebase baÄŸlantÄ±sÄ± yok, online sipariÅŸler dinlenemiyor');
        return;
      }
      
      console.log('ğŸ“¡ Online sipariÅŸler listener baÅŸlatÄ±lÄ±yor...');
      
      // Ã–nceki listener'Ä± temizle
      if (onlineOrdersUnsubscribe) {
        onlineOrdersUnsubscribe();
        onlineOrdersUnsubscribe = null;
      }
      
      // Sadece pending status'Ã¼ndeki sipariÅŸleri dinle
      // Not: orderBy composite index gerektirebilir, bu yÃ¼zden sadece where kullanÄ±p client-side'da sÄ±ralama yapÄ±yoruz
      // Limit ekle: Son 100 pending sipariÅŸi dinle (read quota tasarrufu iÃ§in)
      const ordersRef = onlineDb.collection('orders');
      const query = ordersRef.where('status', '==', 'pending').limit(100);
      
      console.log('ğŸ“¡ Firebase query oluÅŸturuldu: orders collection, status == pending');
      
      onlineOrdersUnsubscribe = query.onSnapshot((snapshot) => {
        onlineOrders = [];
        snapshot.forEach((doc) => {
          const data = doc.data();
          
          // Tarih formatla - TablePanel'deki gibi createdAt (camelCase) kullanÄ±lÄ±yor
          let formattedDate = '';
          let formattedTime = '';
          let sortTimestamp = null;
          
          if (data.createdAt) {
            const timestamp = data.createdAt.toDate ? data.createdAt.toDate() : new Date(data.createdAt.seconds * 1000);
            formattedDate = timestamp.toLocaleDateString('tr-TR');
            formattedTime = timestamp.toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
            sortTimestamp = timestamp.getTime();
          } else if (data.created_at) {
            const timestamp = data.created_at.toDate ? data.created_at.toDate() : new Date(data.created_at.seconds * 1000);
            formattedDate = timestamp.toLocaleDateString('tr-TR');
            formattedTime = timestamp.toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
            sortTimestamp = timestamp.getTime();
          } else if (data.timestamp) {
            const timestamp = data.timestamp.toDate ? data.timestamp.toDate() : new Date(data.timestamp.seconds * 1000);
            formattedDate = timestamp.toLocaleDateString('tr-TR');
            formattedTime = timestamp.toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
            sortTimestamp = timestamp.getTime();
          }
          
          onlineOrders.push({
            id: doc.id,
            ...data,
            customer_name: data.name || data.customer_name || '',
            customer_phone: data.phone || data.customer_phone || '',
            customer_address: data.address || data.customer_address || '',
            total_amount: data.total || data.total_amount || 0,
            formattedDate,
            formattedTime,
            _sortTimestamp: sortTimestamp || 0
          });
        });
        
        // Client-side'da tarihe gÃ¶re sÄ±rala (en yeni Ã¶nce)
        onlineOrders.sort((a, b) => {
          if (b._sortTimestamp && a._sortTimestamp) {
            return b._sortTimestamp - a._sortTimestamp;
          }
          return 0;
        });
        
        console.log('ğŸ“¦ Online sipariÅŸler gÃ¼ncellendi:', onlineOrders.length, 'sipariÅŸ');
        
        // Badge gÃ¼ncelle
        updateOnlineOrdersBadge();
        
        // EÄŸer modal aÃ§Ä±ksa, listeyi gÃ¼ncelle
        const modal = document.getElementById('onlineOrdersModal');
        if (modal && modal.style.display === 'flex') {
          renderOnlineOrders();
        }
      }, (error) => {
        console.error('âŒ Online sipariÅŸler dinleme hatasÄ±:', error);
        console.error('Hata detaylarÄ±:', error.message, error.code);
      });
    }
    
    // Online SipariÅŸler Badge GÃ¼ncelle (kaldÄ±rÄ±ldÄ± - badge gÃ¶sterilmiyor)
    function updateOnlineOrdersBadge() {
      // Badge kaldÄ±rÄ±ldÄ± - artÄ±k gÃ¶sterilmiyor
    }
    
    // Online SipariÅŸler Modal'Ä±nÄ± GÃ¶ster
    function showOnlineOrdersModal() {
      const modal = document.getElementById('onlineOrdersModal');
      if (!modal) {
        console.error('âŒ Online sipariÅŸler modal bulunamadÄ±');
        return;
      }
      
      console.log('ğŸ“¦ Online sipariÅŸler modal aÃ§Ä±lÄ±yor, mevcut sipariÅŸ sayÄ±sÄ±:', onlineOrders.length);
      
      // Online sipariÅŸleri render et
      renderOnlineOrders();
      modal.style.display = 'flex';
    }
    
    // Online SipariÅŸler Modal'Ä±nÄ± Kapat
    function hideOnlineOrdersModal() {
      const modal = document.getElementById('onlineOrdersModal');
      if (modal) {
        modal.style.display = 'none';
      }
    }
    
    // Online SipariÅŸleri Render Et
    function renderOnlineOrders() {
      const container = document.getElementById('onlineOrdersList');
      if (!container) {
        console.error('âŒ Online sipariÅŸler container bulunamadÄ±');
        return;
      }
      
      console.log('ğŸ“¦ Online sipariÅŸler render ediliyor, sipariÅŸ sayÄ±sÄ±:', onlineOrders.length);
      
      if (!onlineDb) {
        console.warn('âš ï¸ Online Firebase baÄŸlantÄ±sÄ± yok');
        container.innerHTML = `
          <div style="text-align: center; padding: 40px 20px; color: #6b7280;">
            <div style="font-size: 48px; margin-bottom: 16px;">âš ï¸</div>
            <div style="font-size: 16px; font-weight: 600;">Firebase baÄŸlantÄ±sÄ± kurulamadÄ±</div>
            <div style="font-size: 12px; color: #9ca3af; margin-top: 8px;">SayfayÄ± yenileyin</div>
          </div>
        `;
        return;
      }
      
      if (onlineOrders.length === 0) {
        console.log('ğŸ“¦ HenÃ¼z online sipariÅŸ yok');
        container.innerHTML = `
          <div style="text-align: center; padding: 60px 20px; color: #6b7280;">
            <div style="font-size: 64px; margin-bottom: 16px;">ğŸŒ</div>
            <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">HenÃ¼z online sipariÅŸ bulunmuyor</div>
            <div style="font-size: 14px; color: #9ca3af;">Yeni sipariÅŸler burada gÃ¶rÃ¼necek</div>
          </div>
        `;
        return;
      }
      
      let html = '';
      onlineOrders.forEach((order, index) => {
        const customerName = order.customer_name || order.name || 'Ä°simsiz MÃ¼ÅŸteri';
        const customerPhone = order.customer_phone || order.phone || '-';
        // Telefon numarasÄ±nÄ± temizle (sadece rakamlar ve +)
        const cleanPhone = customerPhone.replace(/[^\d+]/g, '');
        const phoneLink = cleanPhone && cleanPhone !== '-' ? `tel:${cleanPhone}` : '#';
        const totalAmount = parseFloat(order.total_amount || order.total || 0).toFixed(2);
        const orderDate = order.formattedDate || '';
        const orderTime = order.formattedTime || '';
        const orderId = order.id || `order-${index}`;
        
        // ÃœrÃ¼n listesi
        const items = order.items || [];
        const itemsHtml = items.length > 0 
          ? items.map(item => {
              const itemName = item.name || item.product_name || 'Bilinmeyen ÃœrÃ¼n';
              const quantity = item.quantity || 1;
              const price = parseFloat(item.price || 0).toFixed(2);
              const itemTotal = (parseFloat(item.price || 0) * (item.quantity || 1)).toFixed(2);
              return `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #f3f4f6;">
                  <div style="flex: 1;">
                    <div style="font-size: 14px; font-weight: 500; color: #111827; margin-bottom: 4px;">
                      ${itemName}
                    </div>
                    <div style="font-size: 12px; color: #6b7280;">
                      ${quantity} adet Ã— â‚º${price}
                    </div>
                  </div>
                  <div style="font-size: 15px; font-weight: 600; color: #059669; margin-left: 16px;">
                    â‚º${itemTotal}
                  </div>
                </div>
              `;
            }).join('')
          : '<div style="padding: 12px 0; color: #9ca3af; font-size: 14px;">ÃœrÃ¼n bulunamadÄ±</div>';
        
        // SipariÅŸ notu
        const orderNote = order.note || order.orderNote || order.order_note || null;
        const noteHtml = orderNote 
          ? `
            <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #f3f4f6;">
              <div style="font-size: 12px; font-weight: 600; color: #6b7280; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;">
                SipariÅŸ Notu
              </div>
              <div style="font-size: 14px; color: #374151; line-height: 1.6; background: #f9fafb; padding: 12px; border-radius: 6px; border-left: 3px solid #8b5cf6;">
                ${orderNote}
              </div>
            </div>
          `
          : '';
        
        html += `
          <div class="online-order-card" data-order-id="${orderId}" style="background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%); border-radius: 12px; padding: 20px; margin-bottom: 16px; border: 1px solid #e5e7eb; box-shadow: 0 2px 8px rgba(0,0,0,0.06); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; overflow: hidden;" onclick="toggleOrderDetails('${orderId}')">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div style="flex: 1; min-width: 0;">
                <div style="font-size: 17px; font-weight: 700; color: #111827; margin-bottom: 10px; line-height: 1.3;">
                  ${customerName}
                </div>
                <a href="${phoneLink}" onclick="event.stopPropagation(); return true;" style="font-size: 14px; color: #3b82f6; margin-bottom: 6px; line-height: 1.5; display: flex; align-items: center; gap: 6px; text-decoration: none; transition: color 0.2s ease; cursor: pointer;" onmouseover="this.style.color='#2563eb'; this.style.textDecoration='underline';" onmouseout="this.style.color='#3b82f6'; this.style.textDecoration='none';">
                  <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="flex-shrink: 0;">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                  </svg>
                  ${customerPhone}
                </a>
                <div style="font-size: 20px; font-weight: 700; color: #059669; margin-top: 10px; display: flex; align-items: center; gap: 6px;">
                  <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  â‚º${totalAmount}
                </div>
              </div>
              <div style="text-align: right; margin-left: 24px; flex-shrink: 0; display: flex; flex-direction: column; align-items: flex-end; gap: 4px;">
                <div style="font-size: 12px; font-weight: 600; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.5px;">
                  ${orderDate}
                </div>
                <div style="font-size: 18px; font-weight: 700; color: #1f2937; white-space: nowrap;">
                  ${orderTime}
                </div>
                <div style="margin-top: 8px; transition: transform 0.3s ease;" id="arrow-${orderId}">
                  <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color: #6b7280;">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                  </svg>
                </div>
              </div>
            </div>
            
            <!-- GeniÅŸleyen Detay BÃ¶lÃ¼mÃ¼ -->
            <div id="details-${orderId}" style="max-height: 0; overflow: hidden; transition: max-height 0.3s cubic-bezier(0.4, 0, 0.2, 1), padding 0.3s ease; padding-top: 0;">
              <div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #e5e7eb;">
                <div style="font-size: 13px; font-weight: 600; color: #6b7280; margin-bottom: 16px; text-transform: uppercase; letter-spacing: 0.5px; display: flex; align-items: center; gap: 8px;">
                  <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                  </svg>
                  ÃœrÃ¼nler (${items.length})
                </div>
                <div style="background: #ffffff; border-radius: 8px; padding: 4px 0;">
                  ${itemsHtml}
                </div>
                ${noteHtml}
              </div>
            </div>
          </div>
        `;
      });
      
      container.innerHTML = html;
    }

    // Bildirim Modal'Ä±nÄ± Kapat
    function hideNotificationsModal() {
      const modal = document.getElementById('notificationsModal');
      if (modal) {
        modal.style.display = 'none';
      }
    }

    // Bildirim Modal Ä°Ã§eriÄŸini Render Et
    function renderNotificationsModal() {
      const container = document.getElementById('notificationsList');
      if (!container) return;

      if (notificationsHistory.length === 0) {
        container.innerHTML = `
          <div style="text-align: center; padding: 60px 20px; color: #9ca3af;">
            <div style="font-size: 48px; margin-bottom: 16px;">ğŸ””</div>
            <div style="font-size: 16px; font-weight: 600; margin-bottom: 8px; color: #6b7280;">HenÃ¼z bildirim yok</div>
            <div style="font-size: 14px;">Bildirimler burada gÃ¶rÃ¼necek</div>
          </div>
        `;
        return;
      }

      const html = notificationsHistory.map(notification => {
        const timeAgo = getTimeAgo(notification.timestamp);
        const icon = notification.type === 'success' 
          ? '<svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>'
          : '<svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>';
        
        const bgColor = notification.type === 'success' 
          ? 'linear-gradient(135deg, #10b981 0%, #059669 100%)'
          : 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
        
        return `
          <div class="notification-item" style="background: ${bgColor}; color: white; border-radius: 12px; padding: 16px; margin-bottom: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
            <div style="display: flex; align-items: flex-start; gap: 12px;">
              <div style="width: 36px; height: 36px; background: rgba(255,255,255,0.2); border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                ${icon}
              </div>
              <div style="flex: 1; min-width: 0;">
                <div style="font-size: 14px; font-weight: 700; margin-bottom: 6px; opacity: 0.95;">${notification.title}</div>
                <div style="font-size: 13px; font-weight: 500; line-height: 1.5; opacity: 0.9; margin-bottom: 8px;">${notification.message}</div>
                <div style="font-size: 11px; opacity: 0.7; font-weight: 600;">${timeAgo}</div>
              </div>
            </div>
          </div>
        `;
      }).join('');

      container.innerHTML = html;
    }

    // Zaman farkÄ±nÄ± hesapla (Ã¶rn: "2 dakika Ã¶nce")
    function getTimeAgo(date) {
      const now = new Date();
      const diff = now - date;
      const seconds = Math.floor(diff / 1000);
      const minutes = Math.floor(seconds / 60);
      const hours = Math.floor(minutes / 60);
      const days = Math.floor(hours / 24);

      if (days > 0) {
        return `${days} gÃ¼n Ã¶nce`;
      } else if (hours > 0) {
        return `${hours} saat Ã¶nce`;
      } else if (minutes > 0) {
        return `${minutes} dakika Ã¶nce`;
      } else {
        return 'Az Ã¶nce';
      }
    }

    // Mesaj GÃ¶nderme FonksiyonlarÄ±
    function showSendMessageModal() {
      document.getElementById('sendMessageModal').style.display = 'flex';
      document.getElementById('messageContentInput').value = '';
      document.getElementById('messageContentInput').focus();
    }

    function hideSendMessageModal() {
      document.getElementById('sendMessageModal').style.display = 'none';
    }

    async function sendBroadcastMessage() {
      const messageContent = document.getElementById('messageContentInput').value.trim();
      
      if (!messageContent || messageContent === '') {
        alert('LÃ¼tfen mesaj iÃ§eriÄŸi yazÄ±n');
        return;
      }

      const sendBtn = document.getElementById('sendMessageBtn');
      const sendBtnText = document.getElementById('sendMessageBtnText');
      const sendBtnSpinner = document.getElementById('sendMessageBtnSpinner');

      if (sendBtn) {
        sendBtn.disabled = true;
        if (sendBtnText) sendBtnText.textContent = 'GÃ¶nderiliyor...';
        if (sendBtnSpinner) sendBtnSpinner.style.display = 'block';
      }

      try {
        // Direkt Firebase'e mesaj kaydet (HTTPS Ã¼zerinden)
        const now = new Date();
        const messageDate = now.toLocaleDateString('tr-TR');
        const messageTime = now.toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });

        // Firebase'e direkt kaydet
        if (db) {
          await db.collection('broadcasts').add({
            message: messageContent,
            date: messageDate,
            time: messageTime,
            created_at: firebase.firestore.FieldValue.serverTimestamp()
          });
          
          showToast('success', 'BaÅŸarÄ±lÄ±', 'Mesaj baÅŸarÄ±yla gÃ¶nderildi!');
          hideSendMessageModal();
        } else {
          throw new Error('Firebase baÄŸlantÄ±sÄ± yok');
        }
      } catch (error) {
        console.error('Mesaj gÃ¶nderme hatasÄ±:', error);
        showToast('error', 'Hata', 'Mesaj gÃ¶nderilirken bir hata oluÅŸtu: ' + (error.message || 'Bilinmeyen hata'));
      } finally {
        if (sendBtn) {
          sendBtn.disabled = false;
          if (sendBtnText) sendBtnText.textContent = 'GÃ¶nder';
          if (sendBtnSpinner) sendBtnSpinner.style.display = 'none';
        }
      }
    }

    // Personel detaylarÄ± iÃ§in zaman filtresi
    let staffDateFilter = 'all'; // 'all', 'yesterday', 'week', 'month', 'custom'
    let staffCustomDateRange = { start: null, end: null };

    function setStaffDateFilter(filter) {
      staffDateFilter = filter;
      renderStaffDetails();
    }

    function setStaffCustomDateRange() {
      const startInput = document.getElementById('staffCustomDateStart');
      const endInput = document.getElementById('staffCustomDateEnd');
      
      if (startInput && endInput && startInput.value && endInput.value) {
        staffCustomDateRange.start = new Date(startInput.value);
        staffCustomDateRange.end = new Date(endInput.value);
        staffCustomDateRange.end.setHours(23, 59, 59, 999);
        staffDateFilter = 'custom';
        renderStaffDetails();
      }
    }

    function filterStaffSalesByDate(sales) {
      if (staffDateFilter === 'all') return sales;
      
      const now = new Date();
      now.setHours(23, 59, 59, 999);
      
      if (staffDateFilter === 'yesterday') {
        const yesterday = new Date(now);
        yesterday.setDate(yesterday.getDate() - 1);
        yesterday.setHours(0, 0, 0, 0);
        return sales.filter(sale => {
          if (!sale.sale_date || sale.sale_date === 'Bilinmeyen') return false;
          const [day, month, year] = sale.sale_date.split('.');
          if (!day || !month || !year) return false;
          const saleDate = new Date(year, month - 1, day);
          saleDate.setHours(0, 0, 0, 0);
          return saleDate >= yesterday && saleDate <= now;
        });
      } else if (staffDateFilter === 'week') {
        const weekAgo = new Date(now);
        weekAgo.setDate(weekAgo.getDate() - 7);
        weekAgo.setHours(0, 0, 0, 0);
        return sales.filter(sale => {
          if (!sale.sale_date || sale.sale_date === 'Bilinmeyen') return false;
          const [day, month, year] = sale.sale_date.split('.');
          if (!day || !month || !year) return false;
          const saleDate = new Date(year, month - 1, day);
          saleDate.setHours(0, 0, 0, 0);
          return saleDate >= weekAgo && saleDate <= now;
        });
      } else if (staffDateFilter === 'month') {
        const monthAgo = new Date(now);
        monthAgo.setMonth(monthAgo.getMonth() - 1);
        monthAgo.setHours(0, 0, 0, 0);
        return sales.filter(sale => {
          if (!sale.sale_date || sale.sale_date === 'Bilinmeyen') return false;
          const [day, month, year] = sale.sale_date.split('.');
          if (!day || !month || !year) return false;
          const saleDate = new Date(year, month - 1, day);
          saleDate.setHours(0, 0, 0, 0);
          return saleDate >= monthAgo && saleDate <= now;
        });
      } else if (staffDateFilter === 'custom' && staffCustomDateRange.start && staffCustomDateRange.end) {
        return sales.filter(sale => {
          if (!sale.sale_date || sale.sale_date === 'Bilinmeyen') return false;
          const [day, month, year] = sale.sale_date.split('.');
          if (!day || !month || !year) return false;
          const saleDate = new Date(year, month - 1, day);
          saleDate.setHours(0, 0, 0, 0);
          return saleDate >= staffCustomDateRange.start && saleDate <= staffCustomDateRange.end;
        });
      }
      
      return sales;
    }

    function renderStaffDetails() {
      const container = document.getElementById('staffContainer');
      if (!container) return;

      let reportSales = allSales.filter(sale => !sale.isExpense);
      reportSales = filterStaffSalesByDate(reportSales);
      
      // Toplam istatistikler
      const totalRevenue = reportSales.reduce((sum, sale) => sum + parseFloat(sale.total_amount || 0), 0);
      const targetProducts = ['Limonata', 'Filtre Kahve', 'Salep'];
      const totalProductSales = {};
      
      reportSales.forEach(sale => {
        if (sale.items_array && Array.isArray(sale.items_array)) {
          sale.items_array.forEach(item => {
            if (item.isGift) return;
            const productName = item.product_name;
            if (targetProducts.includes(productName)) {
              if (!totalProductSales[productName]) {
                totalProductSales[productName] = { count: 0, revenue: 0 };
              }
              totalProductSales[productName].count += (item.quantity || 0);
              totalProductSales[productName].revenue += (parseFloat(item.price || 0) * (item.quantity || 0));
            }
          });
        }
      });
      
      const staffStats = {};
      
      reportSales.forEach(sale => {
        if (sale.items_array && Array.isArray(sale.items_array) && sale.items_array.length > 0) {
          const staffInThisSale = new Set();
          
          sale.items_array.forEach(item => {
            const itemStaffName = item.staff_name || sale.staff_name;
            
            if (!itemStaffName) return;
            
            staffInThisSale.add(itemStaffName);
            
            if (!staffStats[itemStaffName]) {
              staffStats[itemStaffName] = {
                name: itemStaffName,
                totalRevenue: 0,
                totalSales: 0,
                products: {},
                averageSale: 0,
                totalItemsSold: 0,
                totalGiftItems: 0
              };
            }
            
            const productName = item.product_name;
            const quantity = item.quantity || 0;
            const price = parseFloat(item.price || 0);
            const isGift = item.isGift || false;
            
            if (!isGift) {
              staffStats[itemStaffName].totalRevenue += (price * quantity);
            }
            
            if (!staffStats[itemStaffName].products[productName]) {
              staffStats[itemStaffName].products[productName] = {
                count: 0,
                revenue: 0
              };
            }
            
            staffStats[itemStaffName].products[productName].count += quantity;
            if (!isGift) {
              staffStats[itemStaffName].products[productName].revenue += (price * quantity);
            }
            
            staffStats[itemStaffName].totalItemsSold += quantity;
            if (isGift) {
              staffStats[itemStaffName].totalGiftItems += quantity;
            }
          });
          
          staffInThisSale.forEach(staffName => {
            if (staffStats[staffName]) {
              staffStats[staffName].totalSales += 1;
            }
          });
        } else if (sale.staff_name) {
          if (!staffStats[sale.staff_name]) {
            staffStats[sale.staff_name] = {
              name: sale.staff_name,
              totalRevenue: 0,
              totalSales: 0,
              products: {},
              averageSale: 0,
              totalItemsSold: 0,
              totalGiftItems: 0
            };
          }
          
          staffStats[sale.staff_name].totalRevenue += parseFloat(sale.total_amount);
          staffStats[sale.staff_name].totalSales += 1;
        }
      });
      
      Object.keys(staffStats).forEach(staffName => {
        const stats = staffStats[staffName];
        stats.averageSale = stats.totalSales > 0 ? stats.totalRevenue / stats.totalSales : 0;
      });
      
      const sortedStaff = Object.values(staffStats).sort((a, b) => b.totalRevenue - a.totalRevenue);
      
      if (sortedStaff.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">ğŸ‘¥</div>
            <h3>Personel satÄ±ÅŸ verisi bulunamadÄ±</h3>
            <p>HenÃ¼z personel satÄ±ÅŸ verisi yok</p>
          </div>
        `;
        return;
      }

      // Zaman dilimi bilgisi
      const filterLabels = {
        'all': 'TÃ¼m Zamanlar',
        'yesterday': 'DÃ¼n',
        'week': 'Son 1 Hafta',
        'month': 'Son 1 Ay',
        'custom': staffCustomDateRange.start && staffCustomDateRange.end 
          ? `${staffCustomDateRange.start.toLocaleDateString('tr-TR')} - ${staffCustomDateRange.end.toLocaleDateString('tr-TR')}`
          : 'Ã–zel Tarih AralÄ±ÄŸÄ±'
      };

      let html = `
        <div class="staff-container">
          <div class="staff-header-section">
            <h2 class="staff-title">ğŸ‘¥ Personel DetaylarÄ±</h2>
            <div class="staff-date-filter-wrapper">
              <button class="staff-date-filter-trigger" onclick="toggleStaffDateFilterModal(event)">
                <span>ğŸ“…</span>
                <span>${filterLabels[staffDateFilter] || 'Tarih SeÃ§'}</span>
                <span class="date-filter-arrow">â–¼</span>
              </button>
              <div id="staffDateFilterModal" class="date-filter-modal">
                <div class="date-filter-modal-content">
                  <div class="date-filter-option ${staffDateFilter === 'yesterday' ? 'active' : ''}" onclick="setStaffDateFilter('yesterday'); closeStaffDateFilterModal();">
                    <span class="date-filter-icon">ğŸ“†</span>
                    <span>DÃ¼n</span>
                  </div>
                  <div class="date-filter-option ${staffDateFilter === 'week' ? 'active' : ''}" onclick="setStaffDateFilter('week'); closeStaffDateFilterModal();">
                    <span class="date-filter-icon">ğŸ“†</span>
                    <span>Son 1 Hafta</span>
                  </div>
                  <div class="date-filter-option ${staffDateFilter === 'month' ? 'active' : ''}" onclick="setStaffDateFilter('month'); closeStaffDateFilterModal();">
                    <span class="date-filter-icon">ğŸ“…</span>
                    <span>Son 1 Ay</span>
                  </div>
                  <div class="date-filter-option ${staffDateFilter === 'all' ? 'active' : ''}" onclick="setStaffDateFilter('all'); closeStaffDateFilterModal();">
                    <span class="date-filter-icon">ğŸ“Š</span>
                    <span>TÃ¼m Zamanlar</span>
                  </div>
                  <div class="date-filter-divider"></div>
                  <div class="date-filter-option ${staffDateFilter === 'custom' ? 'active' : ''}" onclick="document.getElementById('staffCustomDateRangeSection').style.display = 'block';">
                    <span class="date-filter-icon">ğŸ—“ï¸</span>
                    <span>Ã–zel Tarih AralÄ±ÄŸÄ±</span>
                  </div>
                  <div id="staffCustomDateRangeSection" class="custom-date-range-section" style="display: ${staffDateFilter === 'custom' ? 'block' : 'none'};">
                    <div class="custom-date-inputs">
                      <div class="custom-date-input-group">
                        <label>BaÅŸlangÄ±Ã§:</label>
                        <input type="date" id="staffCustomDateStart" value="${staffCustomDateRange.start ? staffCustomDateRange.start.toISOString().split('T')[0] : ''}" class="custom-date-input">
                      </div>
                      <div class="custom-date-input-group">
                        <label>BitiÅŸ:</label>
                        <input type="date" id="staffCustomDateEnd" value="${staffCustomDateRange.end ? staffCustomDateRange.end.toISOString().split('T')[0] : ''}" class="custom-date-input">
                      </div>
                    </div>
                    <button class="custom-date-apply-btn" onclick="setStaffCustomDateRange();">Uygula</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Toplam Ä°statistikler -->
          <div class="staff-summary-cards">
            <div class="staff-summary-card revenue-card">
              <div class="summary-icon">ğŸ’°</div>
              <div class="summary-content">
                <div class="summary-label">Toplam Ciro</div>
                <div class="summary-value">â‚º${totalRevenue.toFixed(2)}</div>
              </div>
            </div>
            ${targetProducts.map(productName => {
              const sales = totalProductSales[productName] || { count: 0, revenue: 0 };
              const config = {
                'Limonata': { icon: 'ğŸ‹', color: '#fef3c7', textColor: '#92400e' },
                'Filtre Kahve': { icon: 'â˜•', color: '#ddd6fe', textColor: '#5b21b6' },
                'Salep': { icon: 'ğŸ¥›', color: '#fce7f3', textColor: '#9f1239' }
              }[productName];
              
              return `
                <div class="staff-summary-card product-card" style="background: ${config.color};">
                  <div class="summary-icon">${config.icon}</div>
                  <div class="summary-content">
                    <div class="summary-label" style="color: ${config.textColor};">${productName}</div>
                    <div class="summary-value" style="color: ${config.textColor};">${sales.count} adet</div>
                    <div class="summary-sub" style="color: ${config.textColor};">â‚º${sales.revenue.toFixed(2)}</div>
                  </div>
                </div>
              `;
            }).join('')}
          </div>
          
          <div class="staff-grid">
            ${sortedStaff.map((staff, index) => {
              // Belirli Ã¼rÃ¼nlerin satÄ±ÅŸlarÄ±nÄ± hesapla
              const targetProducts = ['Limonata', 'Filtre Kahve', 'Salep'];
              const productSales = {};
              
              targetProducts.forEach(productName => {
                const productData = staff.products[productName];
                if (productData) {
                  productSales[productName] = {
                    count: typeof productData === 'object' ? productData.count : productData,
                    revenue: typeof productData === 'object' ? productData.revenue : 0
                  };
                } else {
                  productSales[productName] = { count: 0, revenue: 0 };
                }
              });
              
              // ÃœrÃ¼n ikonlarÄ± ve renkleri
              const productConfig = {
                'Limonata': { icon: 'ğŸ‹', color: '#fef3c7', textColor: '#92400e', gradient: 'linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)' },
                'Filtre Kahve': { icon: 'â˜•', color: '#ddd6fe', textColor: '#5b21b6', gradient: 'linear-gradient(135deg, #ddd6fe 0%, #c4b5fd 100%)' },
                'Salep': { icon: 'ğŸ¥›', color: '#fce7f3', textColor: '#9f1239', gradient: 'linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%)' }
              };
              
              return `
                <div class="staff-card-compact">
                  <div class="staff-header-compact">
                    <div class="staff-avatar-compact ${index === 0 ? 'rank-gold' : index === 1 ? 'rank-silver' : index === 2 ? 'rank-bronze' : 'rank-default'}">
                      ${index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : 'ğŸ‘¤'}
                    </div>
                    <div class="staff-info-compact">
                      <h3 class="staff-name-compact">${staff.name}</h3>
                      <div class="staff-meta-compact">
                        <span>${staff.totalSales} satÄ±ÅŸ</span>
                        <span>â€¢</span>
                        <span>â‚º${staff.totalRevenue.toFixed(2)}</span>
                      </div>
                    </div>
                  </div>
                  
                  <div class="staff-products-compact">
                    ${targetProducts.map(productName => {
                      const sales = productSales[productName] || { count: 0, revenue: 0 };
                      const config = productConfig[productName];
                      
                      return `
                        <div class="staff-product-compact" style="border-left: 3px solid ${config.color};">
                          <span class="product-icon-compact">${config.icon}</span>
                          <span class="product-name-compact">${productName}</span>
                          <span class="product-count-compact">${sales.count} adet</span>
                          ${sales.revenue > 0 ? `<span class="product-revenue-compact">â‚º${sales.revenue.toFixed(2)}</span>` : ''}
                        </div>
                      `;
                    }).join('')}
                  </div>
                </div>
              `;
            }).join('')}
          </div>
        </div>
      `;

      container.innerHTML = html;
    }

    // Modal dÄ±ÅŸÄ±na tÄ±klanÄ±nca kapat - sayfa yÃ¼klendiÄŸinde ekle
    function setupDateFilterModal() {
      document.addEventListener('click', function(event) {
        const modal = document.getElementById('dateFilterModal');
        const trigger = event.target.closest('.date-filter-trigger');
        const wrapper = event.target.closest('.date-filter-wrapper');
        
        if (modal && !wrapper) {
          modal.classList.remove('show');
        }
      });
    }

    // Analiz Modal FonksiyonlarÄ±
    function showAnalysisModal() {
      const modal = document.getElementById('analysisModal');
      if (!modal) return;
      
      modal.style.display = 'flex';
      document.body.style.overflow = 'hidden';
      
      // Analizi baÅŸlat
      startAnalysis();
    }

    function closeAnalysisModal() {
      const modal = document.getElementById('analysisModal');
      if (!modal) return;
      
      modal.style.display = 'none';
      document.body.style.overflow = '';
      
      // Typing'i durdur
      if (typingInterval) {
        clearInterval(typingInterval);
        typingInterval = null;
      }
    }

    let typingInterval = null;
    let currentAnalysisText = '';
    let currentIndex = 0;

    // Typing efekti ile metin yazdÄ±r
    function typeText(text, element, callback) {
      currentAnalysisText = text;
      currentIndex = 0;
      element.textContent = '';
      
      if (typingInterval) {
        clearInterval(typingInterval);
      }
      
      const indicator = document.getElementById('analysisTypingIndicator');
      if (indicator) indicator.style.display = 'flex';
      
      typingInterval = setInterval(() => {
        if (currentIndex < text.length) {
          element.textContent += text[currentIndex];
          currentIndex++;
          element.scrollTop = element.scrollHeight;
        } else {
          clearInterval(typingInterval);
          typingInterval = null;
          if (indicator) indicator.style.display = 'none';
          if (callback) callback();
        }
      }, 30); // Her karakter 30ms'de yazÄ±lsÄ±n
    }

    // Analiz yap
    async function startAnalysis() {
      const content = document.getElementById('analysisContent');
      if (!content) return;
      
      content.innerHTML = '';
      
      // DÃ¼n ve bugÃ¼n verilerini hesapla
      const today = new Date().toLocaleDateString('tr-TR');
      const yesterday = new Date();
      yesterday.setDate(yesterday.getDate() - 1);
      const yesterdayStr = yesterday.toLocaleDateString('tr-TR');
      
      // MasraflarÄ± hariÃ§ tut
      const todaySales = allSales.filter(s => 
        s.sale_date === today && 
        !s.isExpense && 
        s.payment_method !== 'Masraf'
      );
      const yesterdaySales = allSales.filter(s => 
        s.sale_date === yesterdayStr && 
        !s.isExpense && 
        s.payment_method !== 'Masraf'
      );
      
      const todayRevenue = todaySales.reduce((sum, s) => sum + parseFloat(s.total_amount || 0), 0);
      const yesterdayRevenue = yesterdaySales.reduce((sum, s) => sum + parseFloat(s.total_amount || 0), 0);
      
      // ÃœrÃ¼n istatistikleri (fiyat bilgisi ile)
      const todayProductStats = {};
      const yesterdayProductStats = {};
      const productPrices = {}; // ÃœrÃ¼n adÄ± -> fiyat mapping
      
      todaySales.forEach(sale => {
        const items = sale.items_array || sale.items || [];
        items.forEach(item => {
          if (item && item.product_name && !item.isExpense) {
            const name = item.product_name;
            if (!todayProductStats[name]) {
              todayProductStats[name] = { count: 0, revenue: 0 };
            }
            const qty = item.quantity || 1;
            const price = parseFloat(item.price) || 0;
            todayProductStats[name].count += qty;
            todayProductStats[name].revenue += price * qty;
            
            // Fiyat bilgisini kaydet
            if (price > 0 && (!productPrices[name] || productPrices[name] === 0)) {
              productPrices[name] = price;
            }
          }
        });
      });
      
      yesterdaySales.forEach(sale => {
        const items = sale.items_array || sale.items || [];
        items.forEach(item => {
          if (item && item.product_name && !item.isExpense) {
            const name = item.product_name;
            if (!yesterdayProductStats[name]) {
              yesterdayProductStats[name] = { count: 0, revenue: 0 };
            }
            const qty = item.quantity || 1;
            const price = parseFloat(item.price) || 0;
            yesterdayProductStats[name].count += qty;
            yesterdayProductStats[name].revenue += price * qty;
            
            // Fiyat bilgisini kaydet
            if (price > 0 && (!productPrices[name] || productPrices[name] === 0)) {
              productPrices[name] = price;
            }
          }
        });
      });
      
      // Firebase'den Ã¼rÃ¼n fiyatlarÄ±nÄ± al (eÄŸer satÄ±ÅŸ verilerinde yoksa)
      if (db && db.collection) {
        try {
          const productsRef = db.collection('products');
          const productsSnapshot = await productsRef.get();
          if (productsSnapshot && productsSnapshot.forEach) {
            productsSnapshot.forEach((doc) => {
              const product = doc.data();
              const productName = product.name;
              const productPrice = parseFloat(product.price) || 0;
              if (productName && productPrice > 0) {
                if (!productPrices[productName] || productPrices[productName] === 0) {
                  productPrices[productName] = productPrice;
                }
              }
            });
          }
        } catch (error) {
          console.log('Firebase Ã¼rÃ¼n fiyatlarÄ± alÄ±namadÄ±, satÄ±ÅŸ verilerinden devam ediliyor:', error);
        }
      }
      
      // En Ã§ok satÄ±lan Ã¼rÃ¼nler (count'a gÃ¶re)
      const todayTopProducts = Object.entries(todayProductStats)
        .sort(([, a], [, b]) => b.count - a.count)
        .slice(0, 5);
      const yesterdayTopProducts = Object.entries(yesterdayProductStats)
        .sort(([, a], [, b]) => b.count - a.count)
        .slice(0, 5);
      
      // En az satÄ±lan Ã¼rÃ¼nler
      const todayLeastProducts = Object.entries(todayProductStats)
        .sort(([, a], [, b]) => a.count - b.count)
        .slice(0, 5);
      
      // TÃ¼m Ã¼rÃ¼nler (bugÃ¼n + dÃ¼n birleÅŸik)
      const allProducts = new Set([...Object.keys(todayProductStats), ...Object.keys(yesterdayProductStats)]);
      
      const revenueDiff = todayRevenue - yesterdayRevenue;
      const revenuePercent = yesterdayRevenue > 0 ? ((revenueDiff / yesterdayRevenue) * 100).toFixed(1) : 0;
      const salesDiff = todaySales.length - yesterdaySales.length;
      const todayAvg = todaySales.length > 0 ? todayRevenue / todaySales.length : 0;
      const yesterdayAvg = yesterdaySales.length > 0 ? yesterdayRevenue / yesterdaySales.length : 0;
      
      // AkÄ±llÄ± Ã¶neriler ve riskler sistemi
      const recommendations = [];
      const risks = [];
      
      // 1. En az satÄ±lan pahalÄ± Ã¼rÃ¼nler iÃ§in fiyat indirimi Ã¶nerisi
      const expensiveLowSales = todayLeastProducts
        .filter(([name, stats]) => {
          const price = productPrices[name] || 0;
          return price > 50 && stats.count <= 2; // 50 TL Ã¼zeri ve 2 veya daha az satÄ±ÅŸ
        })
        .sort(([nameA], [nameB]) => (productPrices[nameB] || 0) - (productPrices[nameA] || 0))
        .slice(0, 3);
      
      expensiveLowSales.forEach(([name, stats]) => {
        const currentPrice = productPrices[name] || 0;
        if (currentPrice > 0) {
          const suggestedPrice = Math.round(currentPrice * 0.85); // %15 indirim
          recommendations.push({
            type: 'price_reduction',
            product: name,
            currentPrice: currentPrice,
            suggestedPrice: suggestedPrice,
            reason: 'YÃ¼ksek fiyatlÄ± ancak dÃ¼ÅŸÃ¼k satÄ±ÅŸ hacimli Ã¼rÃ¼n',
            sales: stats.count
          });
        }
      });
      
      // 2. Ã‡ok satÄ±lan ama dÃ¼ÅŸÃ¼k fiyatlÄ± Ã¼rÃ¼nler iÃ§in fiyat artÄ±rma Ã¶nerisi
      const popularLowPrice = todayTopProducts
        .filter(([name, stats]) => {
          const price = productPrices[name] || 0;
          return price > 0 && price < 30 && stats.count >= 5; // 30 TL altÄ± ve 5+ satÄ±ÅŸ
        })
        .sort(([, a], [, b]) => b.count - a.count)
        .slice(0, 3);
      
      popularLowPrice.forEach(([name, stats]) => {
        const currentPrice = productPrices[name] || 0;
        if (currentPrice > 0) {
          const suggestedPrice = Math.round(currentPrice * 1.15); // %15 artÄ±ÅŸ
          recommendations.push({
            type: 'price_increase',
            product: name,
            currentPrice: currentPrice,
            suggestedPrice: suggestedPrice,
            reason: 'YÃ¼ksek talep gÃ¶ren ancak dÃ¼ÅŸÃ¼k fiyatlÄ± Ã¼rÃ¼n',
            sales: stats.count
          });
        }
      });
      
      // 3. KÃ¢rlÄ±lÄ±k analizi - yÃ¼ksek satÄ±ÅŸ ama dÃ¼ÅŸÃ¼k gelir
      const highVolumeLowRevenue = todayTopProducts
        .filter(([name, stats]) => {
          const price = productPrices[name] || 0;
          const avgRevenuePerSale = stats.count > 0 ? stats.revenue / stats.count : 0;
          return stats.count >= 8 && avgRevenuePerSale < price * 0.7; // Ã‡ok satÄ±ÅŸ ama dÃ¼ÅŸÃ¼k ortalama gelir
        });
      
      if (highVolumeLowRevenue.length > 0) {
        highVolumeLowRevenue.forEach(([name, stats]) => {
          recommendations.push({
            type: 'profitability',
            product: name,
            reason: 'YÃ¼ksek satÄ±ÅŸ hacmi ancak dÃ¼ÅŸÃ¼k kÃ¢r marjÄ± tespit edildi',
            sales: stats.count,
            avgRevenue: (stats.revenue / stats.count).toFixed(2)
          });
        });
      }
      
      // 4. Stok optimizasyonu - hiÃ§ satÄ±lmayan Ã¼rÃ¼nler
      const unsoldProducts = Array.from(allProducts)
        .filter(name => !todayProductStats[name] || todayProductStats[name].count === 0)
        .filter(name => productPrices[name] && productPrices[name] > 0)
        .slice(0, 3);
      
      if (unsoldProducts.length > 0) {
        unsoldProducts.forEach(name => {
          risks.push({
            type: 'unsold',
            product: name,
            reason: 'BugÃ¼n hiÃ§ satÄ±lmayan Ã¼rÃ¼n - stok kontrolÃ¼ gerekli',
            price: productPrices[name]
          });
        });
      }
      
      // 5. Trend analizi - dÃ¼n Ã§ok satÄ±lan ama bugÃ¼n az satÄ±lan
      const decliningProducts = yesterdayTopProducts
        .filter(([name]) => {
          const todayCount = todayProductStats[name]?.count || 0;
          const yesterdayCount = yesterdayProductStats[name]?.count || 0;
          return yesterdayCount >= 5 && todayCount < yesterdayCount * 0.5; // %50'den fazla dÃ¼ÅŸÃ¼ÅŸ
        })
        .slice(0, 3);
      
      if (decliningProducts.length > 0) {
        decliningProducts.forEach(([name]) => {
          risks.push({
            type: 'declining',
            product: name,
            reason: 'DÃ¼n popÃ¼ler olan ancak bugÃ¼n satÄ±ÅŸlarÄ± dÃ¼ÅŸen Ã¼rÃ¼n',
            yesterdaySales: yesterdayProductStats[name]?.count || 0,
            todaySales: todayProductStats[name]?.count || 0
          });
        });
      }
      
      // 6. Genel trend analizi
      if (revenueDiff < 0 && Math.abs(revenuePercent) > 10) {
        risks.push({
          type: 'revenue_decline',
          reason: `Ciroda %${Math.abs(revenuePercent)} dÃ¼ÅŸÃ¼ÅŸ tespit edildi. Acil aksiyon gerekli.`,
          percentage: Math.abs(revenuePercent)
        });
        recommendations.push({
          type: 'general',
          reason: 'MÃ¼ÅŸteri Ã§ekme kampanyalarÄ± ve promosyonlar dÃ¼ÅŸÃ¼nÃ¼lmeli'
        });
      } else if (revenueDiff > 0 && revenuePercent > 10) {
        recommendations.push({
          type: 'general',
          reason: `%${revenuePercent} ciro artÄ±ÅŸÄ± devam ettirilmeli. Mevcut strateji baÅŸarÄ±lÄ±.`
        });
      }
      
      if (salesDiff < -5) {
        risks.push({
          type: 'sales_decline',
          reason: 'SatÄ±ÅŸ sayÄ±sÄ±nda Ã¶nemli dÃ¼ÅŸÃ¼ÅŸ var. Personel performansÄ± ve mÃ¼ÅŸteri memnuniyeti gÃ¶zden geÃ§irilmeli.',
          decline: Math.abs(salesDiff)
        });
      }
      
      if (todayAvg < yesterdayAvg * 0.8) {
        risks.push({
          type: 'avg_decline',
          reason: 'Ortalama satÄ±ÅŸ deÄŸeri dÃ¼ÅŸÃ¼yor. YÃ¼ksek deÄŸerli Ã¼rÃ¼nlere yÃ¶nelik cross-selling stratejileri uygulanmalÄ±.',
          todayAvg: todayAvg.toFixed(2),
          yesterdayAvg: yesterdayAvg.toFixed(2)
        });
      }
      
      // 7. En Ã§ok satÄ±lan Ã¼rÃ¼n iÃ§in stok Ã¶nerisi
      if (todayTopProducts.length > 0 && todayTopProducts[0][1].count > 10) {
        recommendations.push({
          type: 'stock',
          product: todayTopProducts[0][0],
          reason: 'YÃ¼ksek talep gÃ¶ren Ã¼rÃ¼n - stok seviyesi kontrol edilmeli ve artÄ±rÄ±lmalÄ±',
          sales: todayTopProducts[0][1].count
        });
      }
      
      // Ã–nce yazÄ± metnini oluÅŸtur
      let analysisText = `SATIÅ ANALÄ°ZÄ° RAPORU\n\n`;
      analysisText += `Tarih: ${today}\n`;
      analysisText += `Analiz ZamanÄ±: ${new Date().toLocaleTimeString('tr-TR')}\n\n`;
      analysisText += `â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n`;
      
      analysisText += `CÄ°RO KARÅILAÅTIRMASI\n\n`;
      analysisText += `DÃ¼n (${yesterdayStr}): â‚º${yesterdayRevenue.toFixed(2)}\n`;
      analysisText += `BugÃ¼n (${today}): â‚º${todayRevenue.toFixed(2)}\n\n`;
      
      if (revenueDiff > 0) {
        analysisText += `YÃ¼kseliÅŸ tespit edildi. BugÃ¼n dÃ¼nden â‚º${Math.abs(revenueDiff).toFixed(2)} daha fazla ciro elde edildi.\n`;
        analysisText += `ArtÄ±ÅŸ oranÄ±: %${Math.abs(revenuePercent)}\n\n`;
      } else if (revenueDiff < 0) {
        analysisText += `DÃ¼ÅŸÃ¼ÅŸ tespit edildi. BugÃ¼n dÃ¼nden â‚º${Math.abs(revenueDiff).toFixed(2)} daha az ciro elde edildi.\n`;
        analysisText += `DÃ¼ÅŸÃ¼ÅŸ oranÄ±: %${Math.abs(revenuePercent)}\n\n`;
      } else {
        analysisText += `Ciro deÄŸiÅŸikliÄŸi tespit edilmedi.\n\n`;
      }
      
      analysisText += `â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n`;
      analysisText += `SATIÅ SAYISI\n\n`;
      analysisText += `DÃ¼n: ${yesterdaySales.length} satÄ±ÅŸ\n`;
      analysisText += `BugÃ¼n: ${todaySales.length} satÄ±ÅŸ\n\n`;
      
      if (salesDiff > 0) {
        analysisText += `BugÃ¼n ${salesDiff} satÄ±ÅŸ daha fazla yapÄ±ldÄ±.\n\n`;
      } else if (salesDiff < 0) {
        analysisText += `BugÃ¼n ${Math.abs(salesDiff)} satÄ±ÅŸ daha az yapÄ±ldÄ±.\n\n`;
      }
      
      if (todayTopProducts.length > 0) {
        analysisText += `â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n`;
        analysisText += `EN Ã‡OK SATILAN ÃœRÃœNLER\n\n`;
        todayTopProducts.forEach(([name, stats], index) => {
          analysisText += `${index + 1}. ${name}: ${stats.count} adet\n`;
        });
        analysisText += `\n`;
      }
      
      analysisText += `â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n`;
      analysisText += `DetaylÄ± analiz tablolarÄ± aÅŸaÄŸÄ±da gÃ¶sterilmektedir.\n\n`;
      
      // HTML tablolarÄ±
      const htmlTables = `
        <div class="analysis-summary">
          <div class="analysis-card revenue-card">
            <div class="analysis-card-header">
              <span class="analysis-icon">ğŸ’°</span>
              <h3>Ciro Analizi</h3>
            </div>
            <div class="analysis-card-body">
              <div class="analysis-comparison">
                <div class="comparison-item">
                  <span class="comparison-label">DÃ¼n</span>
                  <span class="comparison-value">â‚º${yesterdayRevenue.toFixed(2)}</span>
                </div>
                <div class="comparison-arrow">â†’</div>
                <div class="comparison-item">
                  <span class="comparison-label">BugÃ¼n</span>
                  <span class="comparison-value ${revenueDiff >= 0 ? 'positive' : 'negative'}">â‚º${todayRevenue.toFixed(2)}</span>
                </div>
              </div>
              <div class="analysis-trend ${revenueDiff >= 0 ? 'trend-up' : 'trend-down'}">
                ${revenueDiff >= 0 ? 'ğŸ“ˆ' : 'ğŸ“‰'} ${revenueDiff >= 0 ? 'YÃ¼kseliÅŸ' : 'DÃ¼ÅŸÃ¼ÅŸ'}: %${Math.abs(revenuePercent)}
              </div>
            </div>
          </div>
          
          <div class="analysis-card sales-card">
            <div class="analysis-card-header">
              <span class="analysis-icon">ğŸ›’</span>
              <h3>SatÄ±ÅŸ SayÄ±sÄ±</h3>
            </div>
            <div class="analysis-card-body">
              <div class="analysis-comparison">
                <div class="comparison-item">
                  <span class="comparison-label">DÃ¼n</span>
                  <span class="comparison-value">${yesterdaySales.length}</span>
                </div>
                <div class="comparison-arrow">â†’</div>
                <div class="comparison-item">
                  <span class="comparison-label">BugÃ¼n</span>
                  <span class="comparison-value ${salesDiff >= 0 ? 'positive' : 'negative'}">${todaySales.length}</span>
                </div>
              </div>
            </div>
          </div>
          
          ${todayTopProducts.length > 0 ? `
          <div class="analysis-card products-card">
            <div class="analysis-card-header">
              <span class="analysis-icon">â­</span>
              <h3>En Ã‡ok SatÄ±lan</h3>
            </div>
            <div class="analysis-card-body">
              ${todayTopProducts.map(([name, stats], idx) => `
                <div class="product-item">
                  <span class="product-rank">${idx + 1}</span>
                  <span class="product-name">${name}</span>
                  <span class="product-count">${stats.count} adet</span>
                </div>
              `).join('')}
            </div>
          </div>
          ` : ''}
        </div>
        
        <div class="analysis-tables">
          <div class="analysis-table recommendations-table">
            <div class="table-header">
              <span class="table-icon">ğŸ’¡</span>
              <h3>Ã–neriler</h3>
            </div>
            <div class="table-body">
              ${recommendations.length > 0 ? recommendations.map(rec => {
                if (typeof rec === 'string') {
                  return `<div class="table-row"><span class="row-bullet">â€¢</span><span class="row-text">${rec}</span></div>`;
                }
                
                // Fiyat indirimi Ã¶nerisi
                if (rec.type === 'price_reduction') {
                  return `
                    <div class="table-row recommendation-price">
                      <span class="row-bullet">ğŸ’°</span>
                      <div class="row-content">
                        <div class="row-main-text">
                          <strong>${rec.product}</strong> iÃ§in fiyat indirimi Ã¶neriliyor
                        </div>
                        <div class="price-suggestion">
                          <span class="old-price">â‚º${rec.currentPrice.toFixed(2)}</span>
                          <span class="new-price">â‚º${rec.suggestedPrice.toFixed(2)}</span>
                          <span class="price-change">(%${Math.round((1 - rec.suggestedPrice/rec.currentPrice) * 100)} indirim)</span>
                        </div>
                        <div class="row-reason">${rec.reason} - Sadece ${rec.sales} satÄ±ÅŸ</div>
                      </div>
                    </div>
                  `;
                }
                
                // Fiyat artÄ±rma Ã¶nerisi
                if (rec.type === 'price_increase') {
                  return `
                    <div class="table-row recommendation-price">
                      <span class="row-bullet">ğŸ“ˆ</span>
                      <div class="row-content">
                        <div class="row-main-text">
                          <strong>${rec.product}</strong> iÃ§in fiyat artÄ±rÄ±mÄ± Ã¶neriliyor
                        </div>
                        <div class="price-suggestion">
                          <span class="old-price">â‚º${rec.currentPrice.toFixed(2)}</span>
                          <span class="new-price">â‚º${rec.suggestedPrice.toFixed(2)}</span>
                          <span class="price-change positive">(%${Math.round((rec.suggestedPrice/rec.currentPrice - 1) * 100)} artÄ±ÅŸ)</span>
                        </div>
                        <div class="row-reason">${rec.reason} - ${rec.sales} satÄ±ÅŸ ile yÃ¼ksek talep</div>
                      </div>
                    </div>
                  `;
                }
                
                // KÃ¢rlÄ±lÄ±k Ã¶nerisi
                if (rec.type === 'profitability') {
                  return `
                    <div class="table-row">
                      <span class="row-bullet">ğŸ’¼</span>
                      <div class="row-content">
                        <div class="row-main-text"><strong>${rec.product}</strong>: ${rec.reason}</div>
                        <div class="row-reason">${rec.sales} satÄ±ÅŸ, ortalama gelir: â‚º${rec.avgRevenue}</div>
                      </div>
                    </div>
                  `;
                }
                
                // Stok Ã¶nerisi
                if (rec.type === 'stock') {
                  return `
                    <div class="table-row">
                      <span class="row-bullet">ğŸ“¦</span>
                      <div class="row-content">
                        <div class="row-main-text"><strong>${rec.product}</strong>: ${rec.reason}</div>
                        <div class="row-reason">${rec.sales} satÄ±ÅŸ ile yÃ¼ksek talep</div>
                      </div>
                    </div>
                  `;
                }
                
                // Genel Ã¶neri
                return `
                  <div class="table-row">
                    <span class="row-bullet">ğŸ’¡</span>
                    <span class="row-text">${rec.reason}</span>
                  </div>
                `;
              }).join('') : '<div class="table-row"><span class="row-text">Åu an iÃ§in Ã¶zel Ã¶neri bulunmuyor.</span></div>'}
            </div>
          </div>
          
          <div class="analysis-table risks-table">
            <div class="table-header">
              <span class="table-icon">âš ï¸</span>
              <h3>Riskler</h3>
            </div>
            <div class="table-body">
              ${risks.length > 0 ? risks.map(risk => {
                if (typeof risk === 'string') {
                  return `<div class="table-row"><span class="row-bullet">âš ï¸</span><span class="row-text">${risk}</span></div>`;
                }
                
                // SatÄ±lmayan Ã¼rÃ¼n riski
                if (risk.type === 'unsold') {
                  return `
                    <div class="table-row risk-item">
                      <span class="row-bullet">âŒ</span>
                      <div class="row-content">
                        <div class="row-main-text"><strong>${risk.product}</strong>: ${risk.reason}</div>
                        <div class="row-reason">Mevcut fiyat: â‚º${risk.price.toFixed(2)}</div>
                      </div>
                    </div>
                  `;
                }
                
                // DÃ¼ÅŸen Ã¼rÃ¼n riski
                if (risk.type === 'declining') {
                  return `
                    <div class="table-row risk-item">
                      <span class="row-bullet">ğŸ“‰</span>
                      <div class="row-content">
                        <div class="row-main-text"><strong>${risk.product}</strong>: ${risk.reason}</div>
                        <div class="row-reason">DÃ¼n: ${risk.yesterdaySales} satÄ±ÅŸ â†’ BugÃ¼n: ${risk.todaySales} satÄ±ÅŸ</div>
                      </div>
                    </div>
                  `;
                }
                
                // Ciro dÃ¼ÅŸÃ¼ÅŸÃ¼
                if (risk.type === 'revenue_decline') {
                  return `
                    <div class="table-row risk-item">
                      <span class="row-bullet">ğŸ’°</span>
                      <span class="row-text">${risk.reason}</span>
                    </div>
                  `;
                }
                
                // SatÄ±ÅŸ dÃ¼ÅŸÃ¼ÅŸÃ¼
                if (risk.type === 'sales_decline') {
                  return `
                    <div class="table-row risk-item">
                      <span class="row-bullet">ğŸ›’</span>
                      <span class="row-text">${risk.reason}</span>
                    </div>
                  `;
                }
                
                // Ortalama dÃ¼ÅŸÃ¼ÅŸÃ¼
                if (risk.type === 'avg_decline') {
                  return `
                    <div class="table-row risk-item">
                      <span class="row-bullet">ğŸ“Š</span>
                      <div class="row-content">
                        <div class="row-main-text">${risk.reason}</div>
                        <div class="row-reason">DÃ¼n: â‚º${risk.yesterdayAvg} â†’ BugÃ¼n: â‚º${risk.todayAvg}</div>
                      </div>
                    </div>
                  `;
                }
                
                return `<div class="table-row"><span class="row-bullet">âš ï¸</span><span class="row-text">${risk.reason || risk}</span></div>`;
              }).join('') : '<div class="table-row"><span class="row-text">Tespit edilen risk bulunmuyor.</span></div>'}
            </div>
          </div>
        </div>
      `;
      
      // Ã–nce yazÄ±yÄ± typing efektiyle gÃ¶ster, sonra tablolarÄ± ekle
      typeTextThenShowTables(analysisText, htmlTables, content);
    }

    // Ã–nce yazÄ±yÄ± yaz, sonra tablolarÄ± gÃ¶ster
    function typeTextThenShowTables(text, htmlTables, element) {
      element.innerHTML = '<div class="analysis-text-content"></div>';
      const textContent = element.querySelector('.analysis-text-content');
      const indicator = document.getElementById('analysisTypingIndicator');
      if (indicator) indicator.style.display = 'flex';
      
      let currentIndex = 0;
      
      typingInterval = setInterval(() => {
        if (currentIndex < text.length) {
          textContent.textContent += text[currentIndex];
          currentIndex++;
          element.scrollTop = element.scrollHeight;
        } else {
          clearInterval(typingInterval);
          typingInterval = null;
          if (indicator) indicator.style.display = 'none';
          
          // YazÄ± bittikten sonra tablolarÄ± ekle
          setTimeout(() => {
            const tablesDiv = document.createElement('div');
            tablesDiv.innerHTML = htmlTables;
            element.appendChild(tablesDiv);
            element.scrollTop = 0;
          }, 300);
        }
      }, 25);
    }

    // Global fonksiyonlar
    window.verifyPin = verifyPin;
    window.showChangePasswordModal = showChangePasswordModal;
    window.hideChangePasswordModal = hideChangePasswordModal;
    window.changePassword = changePassword;
    
    // Åifre DeÄŸiÅŸtirme Modal FonksiyonlarÄ±
    function showChangePasswordModal() {
      const modal = document.getElementById('changePasswordModal');
      if (!modal) return;
      modal.style.display = 'flex';
      // Input'larÄ± temizle
      document.getElementById('currentPasswordInput').value = '';
      document.getElementById('newPasswordInput').value = '';
      document.getElementById('confirmPasswordInput').value = '';
      // Ä°lk input'a focus
      setTimeout(() => {
        document.getElementById('currentPasswordInput').focus();
      }, 100);
    }
    
    function hideChangePasswordModal() {
      const modal = document.getElementById('changePasswordModal');
      if (modal) {
        modal.style.display = 'none';
      }
    }
    
    async function changePassword() {
      const currentPassword = document.getElementById('currentPasswordInput').value;
      const newPassword = document.getElementById('newPasswordInput').value;
      const confirmPassword = document.getElementById('confirmPasswordInput').value;
      
      // Validasyon
      if (!currentPassword || !newPassword || !confirmPassword) {
        showToast('error', 'Hata', 'LÃ¼tfen tÃ¼m alanlarÄ± doldurun');
        return;
      }
      
      // Mevcut ÅŸifre ÅŸifrelerden biri mi kontrol et
      if (!adminPins.includes(currentPassword)) {
        showToast('error', 'Hata', 'Mevcut ÅŸifre hatalÄ±!');
        document.getElementById('currentPasswordInput').value = '';
        document.getElementById('currentPasswordInput').focus();
        return;
      }
      
      if (newPassword.length < 4) {
        showToast('error', 'Hata', 'Yeni ÅŸifre en az 4 karakter olmalÄ±dÄ±r');
        return;
      }
      
      if (newPassword !== confirmPassword) {
        showToast('error', 'Hata', 'Yeni ÅŸifreler eÅŸleÅŸmiyor!');
        document.getElementById('confirmPasswordInput').value = '';
        document.getElementById('confirmPasswordInput').focus();
        return;
      }
      
      if (newPassword === currentPassword) {
        showToast('error', 'Hata', 'Yeni ÅŸifre mevcut ÅŸifre ile aynÄ± olamaz!');
        return;
      }
      
      // Åifreyi Firebase'e kaydet (mevcut ÅŸifreyi yeni ÅŸifre ile deÄŸiÅŸtir)
      const success = await saveAdminPin(currentPassword, newPassword);
      
      if (success) {
        showToast('success', 'BaÅŸarÄ±lÄ±', 'Åifre baÅŸarÄ±yla deÄŸiÅŸtirildi!');
        hideChangePasswordModal();
        // GiriÅŸ ekranÄ±ndaki PIN input'unu temizle
        const pinInput = document.getElementById('pinInput');
        if (pinInput) {
          pinInput.value = '';
        }
      } else {
        showToast('error', 'Hata', 'Åifre deÄŸiÅŸtirilirken bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin.');
      }
    }
    window.loadSales = loadSales;
    window.setActiveTab = setActiveTab;
    window.setReportDateFilter = setReportDateFilter;
    window.setCustomDateRange = setCustomDateRange;
    window.toggleDateFilterModal = toggleDateFilterModal;
    window.closeDateFilterModal = closeDateFilterModal;
    window.showAnalysisModal = showAnalysisModal;
    window.closeAnalysisModal = closeAnalysisModal;
    window.showNotificationsModal = showNotificationsModal;
    window.toggleNotificationsMute = toggleNotificationsMute;
    window.hideNotificationsModal = hideNotificationsModal;
    window.showOnlineOrdersModal = showOnlineOrdersModal;
    window.hideOnlineOrdersModal = hideOnlineOrdersModal;
    window.setStaffDateFilter = setStaffDateFilter;
    window.setStaffCustomDateRange = setStaffCustomDateRange;
    window.toggleStaffDateFilterModal = toggleStaffDateFilterModal;
    window.closeStaffDateFilterModal = closeStaffDateFilterModal;
    window.toggleOrderDetails = function(orderId) {
      const detailsDiv = document.getElementById('details-' + orderId);
      const arrowDiv = document.getElementById('arrow-' + orderId);
      const card = document.querySelector(`[data-order-id="${orderId}"]`);
      
      if (!detailsDiv || !arrowDiv || !card) return;
      
      const isExpanded = detailsDiv.style.maxHeight && detailsDiv.style.maxHeight !== '0px';
      
      if (isExpanded) {
        // Kapat
        detailsDiv.style.maxHeight = '0px';
        detailsDiv.style.paddingTop = '0';
        arrowDiv.style.transform = 'rotate(0deg)';
        card.style.boxShadow = '0 2px 8px rgba(0,0,0,0.06)';
      } else {
        // AÃ§
        detailsDiv.style.maxHeight = '1000px';
        detailsDiv.style.paddingTop = '20px';
        arrowDiv.style.transform = 'rotate(180deg)';
        card.style.boxShadow = '0 4px 16px rgba(0,0,0,0.12)';
      }
    };
    window.logout = function() {
      sessionStorage.removeItem('adminAuthenticated');
      localStorage.removeItem('adminAuthenticated');
      localStorage.removeItem('adminRememberMe');
      isAuthenticated = false;
      if (realtimeUnsubscribe) {
        realtimeUnsubscribe();
        realtimeUnsubscribe = null;
      }
      if (tablesUnsubscribe) {
        tablesUnsubscribe();
        tablesUnsubscribe = null;
      }
      showLogin();
    };

    // Sayfa yÃ¼klendiÄŸinde modal event listener'Ä± ekle
    window.addEventListener('load', function() {
      setupDateFilterModal();
    });
  </script>
  <style>
    :root {
      --bg-page: #f3f4f6;
      --bg-container: #ffffff;
      --bg-subtle: #f9fafb;
      --border-subtle: #e5e7eb;
      --border-strong: #d1d5db;
      --primary: #dc2626;       /* Makara kÄ±rmÄ±zÄ± */
      --primary-soft: #fee2e2;
      --primary-strong: #b91c1c;
      --accent: #2563eb;
      --text-main: #111827;
      --text-muted: #6b7280;
      --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.12);
      --radius-lg: 16px;
      --radius-md: 12px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      width: 100%;
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: radial-gradient(circle at top, #ffffff 0, #f3f4f6 55%, #e5e7eb 100%);
      min-height: 100vh;
      padding: 24px;
      color: var(--text-main);
      display: flex;
      justify-content: center;
      align-items: stretch;
    }

    .container {
      width: 100%;
      max-width: 1240px;
      background: var(--bg-container);
      border-radius: 20px;
      padding: 20px 22px 24px;
      box-shadow: var(--shadow-soft);
      border: 1px solid var(--border-subtle);
      animation: fadeIn 0.35s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(12px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Header kaldÄ±rÄ±ldÄ± - navbar kullanÄ±lÄ±yor */

    /* Login - sade, aydÄ±nlÄ±k */
    /* Modern Login Container - Minimal & Elegant */
    .login-container {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f8fafc;
      padding: 20px;
      z-index: 1000;
    }

    .login-card {
      background: #ffffff;
      border-radius: 20px;
      width: 100%;
      max-width: 440px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.08), 0 0 0 1px rgba(0, 0, 0, 0.04);
      overflow: hidden;
      animation: loginCardSlideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }

    @keyframes loginCardSlideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .login-card-header {
      padding: 48px 40px 32px;
      text-align: center;
      background: #ffffff;
      border-bottom: 1px solid #f1f5f9;
    }

    .login-logo {
      width: 72px;
      height: 72px;
      margin: 0 auto 24px;
      background: #f8fafc;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid #e2e8f0;
    }

    .login-logo-img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 15px;
    }

    .login-logo-fallback {
      font-size: 36px;
      font-weight: 800;
      color: #1e293b;
      letter-spacing: -1px;
    }

    .login-title {
      font-size: 28px;
      font-weight: 800;
      margin: 0 0 6px 0;
      color: #0f172a;
      letter-spacing: -0.5px;
    }

    .login-subtitle {
      font-size: 14px;
      font-weight: 500;
      margin: 0;
      color: #64748b;
      letter-spacing: 0.2px;
    }

    .login-card-body {
      padding: 32px 40px 40px;
    }

    .login-form-group {
      margin-bottom: 20px;
    }

    .login-label {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      font-weight: 600;
      color: #475569;
      margin-bottom: 8px;
      letter-spacing: 0.2px;
    }

    .login-icon {
      color: #64748b;
      flex-shrink: 0;
      opacity: 0.7;
    }

    .login-input {
      width: 100%;
      padding: 14px 18px;
      font-size: 15px;
      font-weight: 500;
      letter-spacing: 1px;
      border: 1.5px solid #e2e8f0;
      border-radius: 10px;
      background: #ffffff;
      color: #0f172a;
      transition: all 0.2s ease;
    }

    .login-input::placeholder {
      color: #94a3b8;
      letter-spacing: 0;
      font-weight: 400;
    }

    .login-input:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      background: #ffffff;
    }

    .login-remember {
      margin-bottom: 24px;
    }

    .remember-checkbox-label {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      user-select: none;
    }

    .remember-checkbox {
      display: none;
    }

    .remember-checkmark {
      width: 18px;
      height: 18px;
      border: 1.5px solid #cbd5e1;
      border-radius: 5px;
      background: #ffffff;
      position: relative;
      transition: all 0.2s ease;
      flex-shrink: 0;
    }

    .remember-checkbox:checked + .remember-checkmark {
      background: #3b82f6;
      border-color: #3b82f6;
    }

    .remember-checkbox:checked + .remember-checkmark::after {
      content: '';
      position: absolute;
      left: 5px;
      top: 2px;
      width: 4px;
      height: 8px;
      border: solid white;
      border-width: 0 2px 2px 0;
      transform: rotate(45deg);
    }

    .remember-text {
      font-size: 13px;
      font-weight: 500;
      color: #64748b;
      transition: color 0.2s ease;
    }

    .remember-checkbox-label:hover .remember-text {
      color: #475569;
    }

    .login-btn {
      width: 100%;
      padding: 14px 24px;
      font-size: 15px;
      font-weight: 600;
      border: none;
      border-radius: 10px;
      background: #0f172a;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.15);
      transition: all 0.2s ease;
      letter-spacing: 0.3px;
    }

    .login-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(15, 23, 42, 0.2);
      background: #1e293b;
    }

    .login-btn:active {
      transform: translateY(0);
      box-shadow: 0 2px 8px rgba(15, 23, 42, 0.15);
    }

    .login-btn-icon {
      transition: transform 0.2s ease;
    }

    .login-btn:hover .login-btn-icon {
      transform: translateX(3px);
    }

    .change-password-btn {
      width: 100%;
      padding: 12px 24px;
      font-size: 14px;
      font-weight: 600;
      border: 1.5px solid #e2e8f0;
      border-radius: 10px;
      background: white;
      color: #64748b;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.2s ease;
      margin-top: 12px;
    }

    .change-password-btn:hover {
      background: #f8fafc;
      border-color: #cbd5e1;
      color: #475569;
      transform: translateY(-1px);
    }

    .change-password-btn:active {
      transform: translateY(0);
    }

    .change-password-btn svg {
      width: 16px;
      height: 16px;
    }

    /* Åifre DeÄŸiÅŸtirme Modal */
    .change-password-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      z-index: 10000;
      align-items: center;
      justify-content: center;
      padding: 20px;
      animation: fadeIn 0.3s ease;
    }

    .change-password-modal-content {
      background: white;
      border-radius: 20px;
      width: 100%;
      max-width: 440px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      overflow: hidden;
      animation: slideUpScale 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .change-password-modal-header {
      padding: 24px 28px;
      border-bottom: 1px solid #f1f5f9;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #f8fafc;
    }

    .change-password-modal-body {
      padding: 28px;
    }

    .change-password-input {
      width: 100%;
      padding: 12px 16px;
      font-size: 15px;
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      background: white;
      color: #1f2937;
      transition: all 0.2s ease;
      box-sizing: border-box;
    }

    .change-password-input:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
    }

    .change-password-input::placeholder {
      color: #94a3b8;
    }

    .change-password-submit-btn {
      width: 100%;
      padding: 14px 24px;
      font-size: 15px;
      font-weight: 600;
      border: none;
      border-radius: 10px;
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
      transition: all 0.2s ease;
    }

    .change-password-submit-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4);
      background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
    }

    .change-password-submit-btn:active {
      transform: translateY(0);
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
    }

    .login-card-footer {
      padding: 20px 40px;
      background: #f8fafc;
      border-top: 1px solid #f1f5f9;
      text-align: center;
    }

    .login-footer-text {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      font-size: 11px;
      font-weight: 500;
      color: #94a3b8;
      letter-spacing: 0.3px;
    }

    .login-footer-text svg {
      color: #64748b;
      opacity: 0.6;
    }

    @media (max-width: 768px) {
      .login-card {
        max-width: 100%;
        border-radius: 16px;
      }

      .login-card-header {
        padding: 40px 28px 28px;
      }

      .login-logo {
        width: 64px;
        height: 64px;
        margin-bottom: 20px;
      }

      .login-title {
        font-size: 24px;
      }

      .login-card-body {
        padding: 28px 28px 32px;
      }

      .login-card-footer {
        padding: 16px 28px;
      }
    }

    /* Dashboard shell */
    .dashboard {
      display: none;
    }

    .dashboard.active {
      display: block;
    }

    /* Modern Navbar */
    .admin-navbar {
      position: sticky;
      top: 0;
      z-index: 100;
      background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
      border-bottom: 2px solid #ec4899;
      padding: 12px 20px;
      margin: 0;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
      backdrop-filter: blur(10px);
    }

    .navbar-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 100%;
      margin: 0 auto;
    }

    .navbar-brand {
      display: flex;
      align-items: center;
      gap: 12px;
      flex: 1;
    }

    .navbar-logo {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 900;
      font-size: 18px;
      box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
    }

    .navbar-logo-img {
      width: 40px;
      height: 40px;
      object-fit: contain;
      flex-shrink: 0;
      border-radius: 12px;
    }

    .navbar-title-group {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .navbar-title {
      font-size: 18px;
      font-weight: 800;
      color: #1f2937;
      line-height: 1.2;
      margin: 0;
      letter-spacing: -0.3px;
    }

    .navbar-subtitle {
      font-size: 11px;
      font-weight: 500;
      color: #64748b;
      line-height: 1.2;
      margin: 0;
    }

    .navbar-actions {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .refresh-btn,
    .logout-btn,
    .notifications-btn {
      border-radius: 12px;
      padding: 10px 18px;
      font-size: 13px;
      font-weight: 600;
      border: 2px solid transparent;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
      position: relative;
    }

    .refresh-btn {
      border-color: #ec4899;
      color: #ec4899;
      background: #ffffff;
    }

    .refresh-btn:hover {
      border-color: #db2777;
      background: #fdf2f8;
      box-shadow: 0 4px 16px rgba(236, 72, 153, 0.25);
      transform: translateY(-1px);
    }

    .logout-btn {
      border-color: #ec4899;
      color: #ffffff;
      background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);
    }

    .logout-btn:hover {
      border-color: #db2777;
      background: linear-gradient(135deg, #db2777 0%, #be185d 100%);
      box-shadow: 0 4px 16px rgba(236, 72, 153, 0.35);
      transform: translateY(-1px);
    }

    .notifications-btn {
      border-color: #6366f1;
      color: #6366f1;
      background: #ffffff;
    }

    .notifications-btn:hover {
      border-color: #4f46e5;
      background: #eef2ff;
      box-shadow: 0 4px 16px rgba(99, 102, 241, 0.25);
      transform: translateY(-1px);
    }

    .notifications-badge {
      position: absolute;
      top: -6px;
      right: -6px;
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
      font-size: 10px;
      font-weight: 700;
      padding: 2px 6px;
      border-radius: 10px;
      min-width: 18px;
      height: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 8px rgba(239, 68, 68, 0.4);
      border: 2px solid #ffffff;
    }

    /* Bildirimler Modal */
    .notifications-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 10000;
      align-items: center;
      justify-content: center;
      padding: 20px;
      backdrop-filter: blur(4px);
    }

    .notifications-modal-content {
      background: white;
      border-radius: 20px;
      width: 100%;
      max-width: 500px;
      max-height: 80vh;
      display: flex;
      flex-direction: column;
      box-shadow: 0 25px 70px rgba(0, 0, 0, 0.4);
      animation: modalSlideIn 0.3s ease;
    }

    .notifications-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 24px;
      border-bottom: 1px solid #e5e7eb;
      background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
      border-radius: 20px 20px 0 0;
    }

    .online-order-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(0,0,0,0.1) !important;
      border-color: #d1d5db;
    }

    .notifications-list {
      padding: 20px 24px;
      overflow-y: auto;
      flex: 1;
      max-height: calc(80vh - 80px);
    }

    .notification-item {
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .notification-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2) !important;
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(20px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    @media (max-width: 768px) {
      .notifications-modal-content {
        max-width: 100%;
        max-height: 90vh;
        border-radius: 16px;
      }

      .notifications-modal-header {
        padding: 16px 20px;
        border-radius: 16px 16px 0 0;
      }

      .notifications-list {
        padding: 16px 20px;
        max-height: calc(90vh - 70px);
      }
    }

    /* Stats */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      grid-template-rows: auto auto auto;
      gap: 16px;
      margin-bottom: 24px;
    }
    
    /* GÃ¼nlÃ¼k ciro ve masraf kartlarÄ± yan yana, eÅŸ boyutta */
    .stats-grid .stat-card-green {
      grid-column: 1;
      grid-row: 1;
    }
    
    .stats-grid .stat-card-red {
      grid-column: 2;
      grid-row: 1;
    }
    
    /* GÃ¼nlÃ¼k iptal kartÄ± masraf kartÄ±nÄ±n altÄ±nda */
    .stats-grid .stat-card-orange {
      grid-column: 2;
      grid-row: 2;
    }

    .stat-card {
      background: #ffffff;
      padding: 14px 12px;
      border-radius: 16px;
      border: 2px solid #e5e7eb;
      display: flex;
      align-items: center;
      gap: 10px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: default;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.4) 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }

    .stat-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(15, 23, 42, 0.12), 0 0 0 1px rgba(148, 163, 184, 0.1);
    }

    .stat-card:hover::before {
      opacity: 1;
    }

    .stat-card-green {
      border-color: #10b981;
      background: #ffffff;
    }

    .stat-card-green:hover {
      border-color: #059669;
      box-shadow: 0 8px 24px rgba(16, 185, 129, 0.2), 0 0 0 1px rgba(16, 185, 129, 0.1);
    }

    .stat-card-red {
      border-color: #ef4444;
      background: #ffffff;
    }

    .stat-card-red:hover {
      border-color: #dc2626;
      box-shadow: 0 8px 24px rgba(239, 68, 68, 0.2), 0 0 0 1px rgba(239, 68, 68, 0.1);
    }

    .stat-card-purple {
      border-color: #8b5cf6;
      background: #ffffff;
    }

    .stat-card-purple:hover {
      border-color: #7c3aed;
      box-shadow: 0 8px 24px rgba(139, 92, 246, 0.2), 0 0 0 1px rgba(139, 92, 246, 0.1);
    }

    .stat-card-pink {
      border-color: #ec4899;
      background: #ffffff;
    }

    .stat-card-pink:hover {
      border-color: #db2777;
      box-shadow: 0 8px 24px rgba(236, 72, 153, 0.2), 0 0 0 1px rgba(236, 72, 153, 0.1);
    }

    .stat-icon {
      font-size: 24px;
      line-height: 1;
      filter: grayscale(0.2);
      transition: all 0.3s ease;
      flex-shrink: 0;
      min-width: 24px;
    }

    .stat-card:hover .stat-icon {
      filter: grayscale(0);
      transform: scale(1.1);
    }

    .stat-content {
      flex: 1;
      min-width: 0;
    }

    .stat-content {
      flex: 1;
      min-width: 0;
      overflow: hidden;
    }

    .stat-content h3 {
      font-size: 11px;
      font-weight: 600;
      color: #64748b;
      margin: 0 0 6px 0;
      letter-spacing: 0.1px;
      text-transform: uppercase;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      line-height: 1.2;
    }

    .stat-card-green .stat-content h3 {
      color: #059669;
    }

    .stat-card-red .stat-content h3 {
      color: #dc2626;
    }

    .stat-card-purple .stat-content h3 {
      color: #7c3aed;
    }

    .stat-card-pink .stat-content h3 {
      color: #db2777;
    }

    .stat-card-orange {
      border-color: #f97316;
      background: #ffffff;
    }

    .stat-card-orange:hover {
      border-color: #ea580c;
      box-shadow: 0 8px 24px rgba(249, 115, 22, 0.2), 0 0 0 1px rgba(249, 115, 22, 0.1);
    }

    .stat-card-orange .stat-content h3 {
      color: #ea580c;
    }

    .stat-card-orange .stat-value {
      color: #c2410c;
    }

    .stat-value {
      font-size: 20px;
      font-weight: 800;
      color: #1f2937;
      line-height: 1.2;
      letter-spacing: -0.3px;
      white-space: nowrap;
    }

    .stat-card-green .stat-value {
      color: #047857;
    }

    .stat-card-red .stat-value {
      color: #b91c1c;
    }

    .stat-card-purple .stat-value {
      color: #6d28d9;
    }

    .stat-card-pink .stat-value {
      color: #ec4899;
    }

    /* GÃ¼nlÃ¼k Ciro altÄ±nda Ã¶deme detaylarÄ± mini kartÄ± */
    .stat-card-wrapper {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .payment-breakdown-card {
      background: #f8fafc;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid #e2e8f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }

    .payment-breakdown-item {
      display: flex;
      align-items: center;
      gap: 8px;
      flex: 1;
    }

    .payment-breakdown-label {
      font-size: 12px;
      font-weight: 600;
      color: #64748b;
      white-space: nowrap;
    }

    .payment-breakdown-value {
      font-size: 14px;
      font-weight: 700;
      color: #1e293b;
      white-space: nowrap;
    }

    /* Tarih gruplarÄ± + satÄ±ÅŸ kartlarÄ± */
    #salesContainer {
      min-height: 220px;
    }

    .date-group {
      margin-bottom: 24px;
    }

    .date-header {
      background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
      border-radius: 16px;
      padding: 18px 20px;
      border: 2px solid #a7f3d0;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.08), 0 2px 4px rgba(16, 185, 129, 0.04);
      position: relative;
      overflow: hidden;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .date-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #10b981 0%, #059669 50%, #047857 100%);
      border-radius: 16px 16px 0 0;
    }

    .date-header:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(16, 185, 129, 0.12), 0 4px 8px rgba(16, 185, 129, 0.06);
      border-color: #10b981;
      background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
    }

    .date-header > div {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      flex-direction: column;
    }

    .date-title-wrapper {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      width: 100%;
    }

    .date-icon {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      background: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      border: 1px solid rgba(16, 185, 129, 0.2);
      flex-shrink: 0;
    }

    .date-title {
      font-size: 16px;
      font-weight: 700;
      color: #1f2937;
      letter-spacing: -0.02em;
      margin: 0;
      line-height: 1.3;
    }

    .date-subtitle {
      font-size: 13px;
      color: #6b7280;
      margin-top: 6px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .date-stats {
      display: flex !important;
      flex-direction: row !important;
      align-items: center;
      justify-content: center;
      gap: 12px;
      width: 100%;
    }

    .date-stat-item {
      display: flex !important;
      flex-direction: row !important;
      align-items: center;
      gap: 8px;
      background: #ffffff;
      border-radius: 12px;
      padding: 10px 14px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
      border: 1px solid rgba(16, 185, 129, 0.1);
      transition: all 0.2s ease;
      white-space: nowrap;
    }

    .date-stat-item:hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      transform: translateY(-1px);
    }

    .date-stat-label {
      font-size: 13px;
      color: #047857;
      font-weight: 600;
      text-transform: none;
      letter-spacing: 0;
      white-space: nowrap;
    }

    .date-stat-value {
      font-size: 18px;
      font-weight: 700;
      color: #059669;
      line-height: 1;
    }

    .date-stat-value.amount {
      color: #047857;
    }

    .sales-grid {
      display: grid;
      gap: 14px;
      margin-top: 10px;
    }

    .sale-card {
      background: #ffffff;
      border-radius: var(--radius-md);
      border: 1px solid var(--border-subtle);
      padding: 14px 14px 12px;
      transition: box-shadow 0.12s ease, border-color 0.12s ease, transform 0.12s ease;
    }

    .sale-card:hover {
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.08);
      border-color: var(--border-strong);
      transform: translateY(-1px);
    }

    .sale-header {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      padding-bottom: 8px;
      border-bottom: 1px solid #f3f4f6;
      margin-bottom: 10px;
      align-items: flex-start;
    }

    .sale-info {
      flex: 1;
      min-width: 0;
    }

    .sale-id {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-main);
      margin-bottom: 2px;
    }

    .sale-time {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    .sale-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }

    .badge {
      padding: 4px 9px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 500;
      border: 1px solid transparent;
      background: #f3f4f6;
      color: var(--text-muted);
    }

    .badge-cash {
      background: #ecfdf3;
      color: #166534;
      border-color: #bbf7d0;
    }

    .badge-card {
      background: #eff6ff;
      color: #1d4ed8;
      border-color: #bfdbfe;
    }

    .badge-online {
      background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
      color: white;
      border-color: #7c3aed;
    }

    .badge-staff {
      background: #f3e8ff;
      color: #7c3aed;
      border-color: #e9d5ff;
    }

    .badge-table {
      background: #fef9c3;
      color: #854d0e;
      border-color: #fde68a;
    }

    .badge-expense {
      background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
      color: #c62828;
      border-color: #ef5350;
    }

    /* Masraf KartÄ± Stilleri */
    .expense-card {
      background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
      border: 1px solid #ef5350;
      border-left: 4px solid #e53935;
      padding: 12px 16px;
    }

    .expense-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
    }

    .expense-info {
      flex: 1;
      min-width: 0;
    }

    .expense-title {
      font-size: 15px;
      font-weight: 700;
      color: #c62828;
      margin-bottom: 4px;
    }

    .expense-time {
      color: #d32f2f;
      font-size: 11px;
      margin-bottom: 8px;
    }

    .expense-amount {
      text-align: right;
      flex-shrink: 0;
    }

    .expense-label {
      font-size: 10px;
      color: #d32f2f;
      font-weight: 700;
      margin-bottom: 4px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .expense-value {
      font-size: 18px;
      font-weight: 700;
      color: #c62828;
    }

    /* Ä°ptaller Listesi Stilleri */
    .cancels-list {
      display: flex;
      flex-direction: column;
      gap: 16px;
      padding: 20px 0;
    }

    .cancel-card {
      background: linear-gradient(135deg, #ffffff 0%, #fef2f2 100%);
      border: 2px solid #fecaca;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.1);
      transition: all 0.3s ease;
    }

    .cancel-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(239, 68, 68, 0.15);
      border-color: #fca5a5;
    }

    .cancel-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
      padding-bottom: 16px;
      border-bottom: 2px solid #fee2e2;
    }

    .cancel-header-left {
      flex: 1;
    }

    .cancel-product-name {
      font-size: 18px;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 8px;
    }

    .cancel-meta {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      font-size: 13px;
      color: #6b7280;
    }

    .cancel-meta-item {
      display: flex;
      align-items: center;
    }

    .cancel-meta-separator {
      color: #d1d5db;
      margin: 0 4px;
    }

    .cancel-header-right {
      text-align: right;
    }

    .cancel-amount {
      font-size: 22px;
      font-weight: 800;
      color: #dc2626;
      letter-spacing: -0.5px;
    }

    .cancel-details {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 12px;
      margin-bottom: 16px;
      padding: 12px;
      background: #fef2f2;
      border-radius: 10px;
    }

    .cancel-detail-row {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .cancel-detail-label {
      font-size: 12px;
      font-weight: 600;
      color: #9ca3af;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .cancel-detail-value {
      font-size: 15px;
      font-weight: 700;
      color: #1f2937;
    }

    .cancel-reason {
      padding: 14px;
      background: #ffffff;
      border: 2px solid #fee2e2;
      border-radius: 12px;
      border-left: 4px solid #ef4444;
    }

    .cancel-reason-label {
      font-size: 12px;
      font-weight: 700;
      color: #991b1b;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
    }

    .cancel-reason-text {
      font-size: 15px;
      font-weight: 500;
      color: #374151;
      line-height: 1.6;
    }

    @media (max-width: 768px) {
      .cancel-header {
        flex-direction: column;
        gap: 12px;
      }

      .cancel-header-right {
        text-align: left;
        width: 100%;
      }

      .cancel-details {
        grid-template-columns: 1fr;
      }

      .cancel-product-name {
        font-size: 16px;
      }

      .cancel-amount {
        font-size: 20px;
      }
    }

    .sale-total {
      text-align: right;
      min-width: 120px;
    }

    .total-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .total-amount {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-main);
    }

    .sale-items {
      margin-top: 8px;
    }

    .items-label {
      font-size: 12px;
      font-weight: 500;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    .items-list {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .sale-item {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      background: #f3f4f6;
      font-size: 12px;
      color: var(--text-main);
    }

    .item-name {
      font-weight: 500;
    }

    .item-quantity {
      color: var(--text-muted);
      font-weight: 500;
    }

    .gift-badge {
      font-size: 10px;
      font-weight: 600;
      padding: 2px 6px;
      border-radius: 999px;
      background: #ecfdf5;
      color: #047857;
      border: 1px solid #a7f3d0;
    }

    /* BoÅŸ & hata durumlarÄ± */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      border-radius: var(--radius-lg);
      background: #ffffff;
      border: 1px dashed var(--border-subtle);
    }

    .empty-icon {
      font-size: 56px;
      margin-bottom: 10px;
    }

    .empty-state h3 {
      font-size: 20px;
      font-weight: 600;
      color: var(--text-main);
      margin-bottom: 4px;
    }

    .empty-state p {
      font-size: 14px;
      color: var(--text-muted);
    }

    .empty-message {
      text-align: center;
      padding: 20px;
      color: var(--text-muted);
      font-size: 14px;
      font-style: italic;
    }

    /* Masalar Stilleri */
    .tables-container {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .tables-section {
      background: #ffffff;
      border-radius: var(--radius-lg);
      padding: 12px;
      border: 1px solid var(--border-subtle);
      margin-bottom: 12px;
    }

    .section-title {
      font-size: 14px;
      font-weight: 700;
      color: var(--text-main);
      margin-bottom: 10px;
      padding-bottom: 8px;
      border-bottom: 2px solid var(--border-subtle);
    }

    .tables-grid {
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      gap: 6px;
    }

    .tables-grid.package-grid {
      grid-template-columns: repeat(5, 1fr);
      gap: 6px;
    }

    .table-card {
      background: #ffffff;
      border: 2px solid var(--border-subtle);
      border-radius: 8px;
      padding: 6px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      aspect-ratio: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      min-height: 0;
    }

    .table-amount-badge {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.7);
      color: #ffffff;
      font-size: 9px;
      font-weight: 700;
      text-align: center;
      padding: 2px 4px;
      z-index: 10;
      border-radius: 8px 8px 0 0;
    }

    .table-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
    }

    .table-card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 4px;
    }

    .table-number {
      font-size: 16px;
      font-weight: 800;
      color: var(--text-main);
      line-height: 1;
    }

    .table-status {
      padding: 2px 5px;
      border-radius: 999px;
      font-size: 7px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      white-space: nowrap;
      flex-shrink: 0;
    }

    .table-name {
      font-size: 9px;
      font-weight: 600;
      color: var(--text-main);
      margin-bottom: 4px;
      line-height: 1.2;
    }

    .table-details {
      margin-top: auto;
      padding-top: 4px;
      border-top: 1px solid var(--border-subtle);
      flex-shrink: 0;
    }

    .table-amount {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 3px;
    }

    .amount-label {
      font-size: 7px;
      color: var(--text-muted);
      font-weight: 500;
    }

    .amount-value {
      font-size: 10px;
      font-weight: 700;
      color: #dc2626;
      line-height: 1;
    }

    .table-items-count {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 3px;
    }

    .items-label {
      font-size: 7px;
      color: var(--text-muted);
      font-weight: 500;
    }

    .items-value {
      font-size: 9px;
      font-weight: 600;
      color: var(--text-main);
    }

    .table-items {
      margin-top: 3px;
      max-height: 50px;
      overflow-y: auto;
    }

    .table-items-title {
      font-size: 7px;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.3px;
      margin-bottom: 2px;
    }

    .table-card.occupied .table-items-title {
      color: rgba(255, 255, 255, 0.8);
    }

    .table-card.occupied .table-item {
      background: rgba(255, 255, 255, 0.2);
      color: #ffffff;
    }

    .table-card.occupied .item-name,
    .table-card.occupied .item-quantity {
      color: #ffffff;
    }

    .table-card.occupied .table-item-more {
      color: rgba(255, 255, 255, 0.8);
    }

    /* Dolu Masalar - Modern Gradient TasarÄ±m */
    .table-card-occupied {
      background: linear-gradient(135deg, #dc2626 0%, #b91c1c 50%, #991b1b 100%);
      border: none;
      padding: 0;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(220, 38, 38, 0.25);
    }

    .table-card-occupied:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(220, 38, 38, 0.35);
    }

    .table-card-gradient {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      padding: 12px 8px;
      min-height: 100%;
    }

    .table-number-occupied {
      font-size: 24px;
      font-weight: 800;
      color: #ffffff;
      line-height: 1;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      letter-spacing: -0.5px;
    }

    .table-amount-occupied {
      font-size: 14px;
      font-weight: 700;
      color: #ffffff;
      line-height: 1;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
      opacity: 0.95;
      margin-top: auto;
    }

    .table-items-list {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .table-item {
      display: flex;
      align-items: center;
      gap: 3px;
      padding: 2px 4px;
      background: #f3f4f6;
      border-radius: 4px;
      font-size: 7px;
    }

    .item-name {
      flex: 1;
      font-weight: 500;
      color: var(--text-main);
      font-size: 6px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .item-quantity {
      color: var(--text-muted);
      font-weight: 600;
      font-size: 6px;
    }

    .item-gift {
      font-size: 6px;
      font-weight: 700;
      padding: 1px 3px;
      border-radius: 999px;
      background: #ecfdf5;
      color: #047857;
      border: 1px solid #a7f3d0;
      white-space: nowrap;
    }

    .table-item-more {
      font-size: 6px;
      color: var(--text-muted);
      font-style: italic;
      text-align: center;
      padding: 2px;
    }

    .error-card {
      text-align: center;
      padding: 32px 20px;
      background: #fef2f2;
      border-radius: var(--radius-lg);
      border: 1px solid #fecaca;
    }

    .error-icon {
      font-size: 48px;
      margin-bottom: 12px;
    }

    .error-card h3 {
      font-size: 18px;
      color: #b91c1c;
      margin-bottom: 6px;
      font-weight: 600;
    }

    .error-card p {
      color: var(--text-muted);
      margin-bottom: 14px;
      font-size: 14px;
    }

    .retry-btn {
      padding: 9px 20px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(90deg, #dc2626, #b91c1c);
      color: #ffffff;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      box-shadow: 0 8px 18px rgba(220, 38, 38, 0.25);
    }

    /* Admin Splash Screen */
    .admin-splash-screen {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 99999;
      overflow: hidden;
    }

    .splash-content {
      position: relative;
      z-index: 1;
      width: 100%;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .splash-logo {
      width: 120px;
      height: 120px;
      object-fit: contain;
      margin-bottom: 32px;
      animation: logoFadeIn 0.8s ease-out forwards;
      opacity: 0;
    }

    .splash-main-text {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      font-weight: 800;
      font-size: clamp(4rem, 12vw, 8rem);
      line-height: 0.9;
      letter-spacing: 0.15em;
      color: #0a0a0a;
      margin: 0;
      padding: 0;
      text-align: center;
      text-transform: uppercase;
      animation: mainTextReveal 1.2s cubic-bezier(0.16, 1, 0.3, 1) forwards;
      opacity: 0;
    }

    .splash-decorative-line {
      width: 0%;
      height: 1px;
      background: linear-gradient(90deg, transparent 0%, #d1d5db 50%, transparent 100%);
      margin: 32px auto 40px;
      max-width: 400px;
      animation: lineExpand 1s ease-out forwards;
      animation-delay: 0.5s;
      opacity: 0;
    }

    .splash-subtitle-text {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      font-size: clamp(0.875rem, 1.5vw, 1.125rem);
      font-weight: 400;
      color: #6b7280;
      margin: 0;
      padding: 0;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      text-align: center;
      opacity: 0.7;
      animation: subtitleFadeIn 0.8s ease-out forwards;
      animation-delay: 0.3s;
      opacity: 0;
    }

    @keyframes logoFadeIn {
      from {
        opacity: 0;
        transform: scale(0.8);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    @keyframes mainTextReveal {
      0% {
        opacity: 0;
        transform: translateY(40px) scale(0.95);
        letter-spacing: 0.3em;
      }
      100% {
        opacity: 1;
        transform: translateY(0) scale(1);
        letter-spacing: 0.15em;
      }
    }

    @keyframes subtitleFadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes lineExpand {
      from {
        width: 0%;
        opacity: 0;
      }
      to {
        width: 100%;
        opacity: 1;
      }
    }

    /* Dekoratif arka plan elementleri */
    .admin-splash-screen::before {
      content: '';
      position: absolute;
      top: 20%;
      left: 10%;
      width: 200px;
      height: 200px;
      background: radial-gradient(circle, rgba(236, 72, 153, 0.03) 0%, transparent 70%);
      border-radius: 50%;
      filter: blur(40px);
      pointer-events: none;
    }

    .admin-splash-screen::after {
      content: '';
      position: absolute;
      bottom: 20%;
      right: 10%;
      width: 300px;
      height: 300px;
      background: radial-gradient(circle, rgba(236, 72, 153, 0.02) 0%, transparent 70%);
      border-radius: 50%;
      filter: blur(60px);
      pointer-events: none;
    }

    /* Sekme butonlarÄ± */
    .tab-buttons-container {
      width: 100%;
      padding: 0 16px;
      margin-bottom: 20px;
    }

    .tab-buttons {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      grid-template-rows: repeat(2, auto);
      gap: 12px;
      margin: 20px 0 24px;
    }

    @media (min-width: 768px) {
      .tab-buttons {
        grid-template-columns: repeat(3, minmax(0, 1fr));
        grid-template-rows: repeat(2, auto);
      }
    }

    .tab-btn {
      padding: 16px 8px;
      border-radius: 16px;
      border: 2px solid #e5e7eb;
      background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
      font-size: 12px;
      font-weight: 600;
      color: #64748b;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 8px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      min-height: 72px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    }

    .tab-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.4) 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }

    .tab-btn span {
      white-space: nowrap;
      text-overflow: ellipsis;
      max-width: 100%;
      overflow: hidden;
    }

    .tab-btn-icon {
      font-size: 24px;
      line-height: 1;
      filter: grayscale(0.3);
      transition: all 0.3s ease;
    }

    .tab-btn-text {
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.2px;
      transition: all 0.3s ease;
    }

    .tab-btn-indicator {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #ec4899 0%, #db2777 100%);
      transform: scaleX(0);
      transform-origin: left;
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: 0 0 16px 16px;
    }

    .tab-btn:hover {
      border-color: #cbd5e1;
      background: linear-gradient(135deg, #ffffff 0%, #f1f5f9 100%);
      box-shadow: 0 8px 24px rgba(15, 23, 42, 0.12), 0 0 0 1px rgba(148, 163, 184, 0.1);
      transform: translateY(-2px);
      color: #475569;
    }

    .tab-btn:hover::before {
      opacity: 1;
    }

    .tab-btn:hover .tab-btn-icon {
      filter: grayscale(0);
      transform: scale(1.1);
    }

    .tab-btn.active {
      border-color: #ec4899;
      background: linear-gradient(135deg, #fdf2f8 0%, #fce7f3 100%);
      color: #db2777;
      box-shadow: 0 8px 24px rgba(236, 72, 153, 0.2), 0 0 0 1px rgba(236, 72, 153, 0.1);
      transform: translateY(-2px);
    }

    .tab-btn.active::before {
      opacity: 0;
    }

    .tab-btn.active .tab-btn-icon {
      filter: grayscale(0);
      transform: scale(1.15);
    }

    .tab-btn.active .tab-btn-text {
      color: #db2777;
      font-weight: 700;
    }

    .tab-btn.active .tab-btn-indicator {
      transform: scaleX(1);
      background: linear-gradient(90deg, #ec4899 0%, #db2777 100%);
    }

    /* Raporlar */
    .reports-container {
      padding: 10px 0 6px;
    }

    .reports-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 18px;
    }

    .reports-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-main);
      white-space: nowrap;
      flex-shrink: 0;
    }

    .analyze-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 10px 20px;
      background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
      color: #1f2937;
      border: 2px solid #ec4899;
      border-radius: 12px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 2px 8px rgba(236, 72, 153, 0.15);
      position: relative;
      overflow: hidden;
    }

    .analyze-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);
      transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 0;
    }

    .analyze-btn span {
      position: relative;
      z-index: 1;
      transition: color 0.3s ease;
    }

    .analyze-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(236, 72, 153, 0.3);
      border-color: #db2777;
    }

    .analyze-btn:hover::before {
      left: 0;
    }

    .analyze-btn:hover span {
      color: #ffffff;
    }

    .analyze-btn:active {
      transform: translateY(0);
      box-shadow: 0 2px 8px rgba(236, 72, 153, 0.2);
    }

    .date-filter-wrapper {
      position: relative;
    }

    .date-filter-trigger {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      font-size: 12px;
      background: #ffffff;
      cursor: pointer;
      color: var(--text-muted);
    }

    .date-filter-arrow {
      font-size: 10px;
    }

    .date-filter-modal {
      position: absolute;
      right: 0;
      top: calc(100% + 6px);
      min-width: 200px;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 14px 30px rgba(15, 23, 42, 0.18);
      border: 1px solid var(--border-subtle);
      opacity: 0;
      visibility: hidden;
      transform: translateY(-6px);
      transition: all 0.15s ease;
      z-index: 20;
    }

    .date-filter-modal.show {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .date-filter-modal-content {
      padding: 6px;
    }

    .date-filter-option {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      border-radius: 8px;
      font-size: 13px;
      color: var(--text-muted);
      cursor: pointer;
    }

    .date-filter-option:hover {
      background: var(--bg-subtle);
    }

    .date-filter-option.active {
      background: var(--primary-soft);
      color: var(--primary-strong);
      font-weight: 500;
    }

    .date-filter-divider {
      height: 1px;
      background: var(--border-subtle);
      margin: 4px 0;
    }

    .custom-date-range-section {
      padding: 10px;
      background: var(--bg-subtle);
      border-radius: 8px;
      margin-top: 4px;
    }

    .custom-date-inputs {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 10px;
    }

    .custom-date-input-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .custom-date-input-group label {
      font-size: 11px;
      font-weight: 600;
      color: var(--text-muted);
    }

    .custom-date-input {
      padding: 6px 8px;
      border: 1px solid var(--border-subtle);
      border-radius: 6px;
      font-size: 12px;
      background: #ffffff;
      color: var(--text-main);
    }

    .custom-date-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px var(--primary-soft);
    }

    .custom-date-apply-btn {
      width: 100%;
      padding: 8px;
      background: var(--primary);
      color: #ffffff;
      border: none;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .custom-date-apply-btn:hover {
      background: var(--primary-strong);
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(220, 38, 38, 0.2);
    }

    /* SeÃ§ilen Zaman Dilimi Ciro ve Masraf Container */
    .period-revenue-container {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 18px;
      margin-bottom: 28px;
    }

    /* SeÃ§ilen Zaman Dilimi Ciro KartÄ± */
    .period-revenue-card,
    .period-expense-card,
    .period-online-revenue-card {
      position: relative;
      background: linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%);
      border-radius: 20px;
      padding: 24px;
      box-shadow: 0 10px 40px rgba(16, 185, 129, 0.3), 0 4px 16px rgba(16, 185, 129, 0.2);
      overflow: hidden;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .period-expense-card {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 50%, #b91c1c 100%);
      box-shadow: 0 10px 40px rgba(239, 68, 68, 0.3), 0 4px 16px rgba(239, 68, 68, 0.2);
    }

    .period-online-revenue-card {
      background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 50%, #6d28d9 100%);
      border: 1px solid rgba(139, 92, 246, 0.3);
    }

    .period-revenue-card:hover,
    .period-expense-card:hover,
    .period-online-revenue-card:hover {
      transform: translateY(-4px) scale(1.02);
      box-shadow: 0 16px 48px rgba(16, 185, 129, 0.4), 0 8px 24px rgba(16, 185, 129, 0.3);
    }

    .period-expense-card:hover {
      box-shadow: 0 16px 48px rgba(239, 68, 68, 0.4), 0 8px 24px rgba(239, 68, 68, 0.3);
    }

    .period-card-background {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.2) 0%, transparent 50%);
      opacity: 0;
      transition: opacity 0.4s ease;
    }

    .period-online-revenue-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 32px rgba(139, 92, 246, 0.4);
    }

    .period-revenue-card:hover .period-card-background,
    .period-expense-card:hover .period-card-background,
    .period-online-revenue-card:hover .period-card-background {
      opacity: 1;
    }

    .period-card-icon {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 56px;
      height: 56px;
      background: rgba(255, 255, 255, 0.15);
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
    }

    .period-card-icon svg {
      width: 28px;
      height: 28px;
      color: rgba(255, 255, 255, 0.9);
    }

    .period-revenue-card:hover .period-card-icon,
    .period-expense-card:hover .period-card-icon {
      transform: scale(1.1) rotate(5deg);
      background: rgba(255, 255, 255, 0.25);
    }

    .period-card-decoration {
      position: absolute;
      bottom: 0;
      right: 0;
      width: 200px;
      height: 200px;
      opacity: 0.3;
      pointer-events: none;
    }

    .period-card-decoration svg {
      width: 100%;
      height: 100%;
    }

    .period-revenue-content {
      position: relative;
      z-index: 2;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .period-revenue-label {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 11px;
      font-weight: 700;
      color: rgba(255, 255, 255, 0.95);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .period-label-icon {
      font-size: 16px;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
    }

    /* Analiz Modal */
    .analysis-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 10000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .analysis-modal-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(8px);
    }

    .analysis-modal-content {
      position: relative;
      background: #ffffff;
      border-radius: 20px;
      width: 100%;
      max-width: 900px;
      max-height: 85vh;
      display: flex;
      flex-direction: column;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      overflow: hidden;
      animation: modalSlideIn 0.3s ease-out;
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-20px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .analysis-modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 24px 28px;
      border-bottom: 2px solid #ec4899;
      background: linear-gradient(135deg, #fdf2f8 0%, #fce7f3 100%);
    }

    .analysis-modal-title {
      font-size: 22px;
      font-weight: 700;
      color: #1f2937;
      margin: 0;
    }

    .analysis-modal-close {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      border: none;
      background: #ffffff;
      color: #6b7280;
      font-size: 24px;
      font-weight: 300;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
      line-height: 1;
    }

    .analysis-modal-close:hover {
      background: #f3f4f6;
      color: #1f2937;
      transform: rotate(90deg);
    }

    .analysis-modal-body {
      padding: 28px;
      overflow-y: auto;
      flex: 1;
      background: #ffffff;
    }

    .analysis-content {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      font-size: 14px;
      line-height: 1.6;
      color: #1f2937;
      min-height: 200px;
    }

    .analysis-text-content {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      font-size: 14px;
      line-height: 1.8;
      color: #1f2937;
      white-space: pre-wrap;
      word-wrap: break-word;
      margin-bottom: 24px;
      padding: 20px;
      background: #f9fafb;
      border-radius: 12px;
      border-left: 4px solid #ec4899;
    }

    .analysis-summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }

    .analysis-card {
      background: #ffffff;
      border: 2px solid #e5e7eb;
      border-radius: 16px;
      padding: 20px;
      transition: all 0.3s ease;
    }

    .analysis-card:hover {
      border-color: #ec4899;
      box-shadow: 0 4px 12px rgba(236, 72, 153, 0.1);
      transform: translateY(-2px);
    }

    .analysis-card-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid #f3f4f6;
    }

    .analysis-icon {
      font-size: 20px;
    }

    .analysis-card-header h3 {
      font-size: 16px;
      font-weight: 700;
      color: #1f2937;
      margin: 0;
    }

    .analysis-card-body {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .analysis-comparison {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .comparison-item {
      display: flex;
      flex-direction: column;
      gap: 4px;
      flex: 1;
    }

    .comparison-label {
      font-size: 12px;
      color: #6b7280;
      font-weight: 500;
    }

    .comparison-value {
      font-size: 18px;
      font-weight: 700;
      color: #1f2937;
    }

    .comparison-value.positive {
      color: #10b981;
    }

    .comparison-value.negative {
      color: #ef4444;
    }

    .comparison-arrow {
      font-size: 20px;
      color: #9ca3af;
      font-weight: 300;
    }

    .analysis-trend {
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      text-align: center;
    }

    .analysis-trend.trend-up {
      background: #ecfdf5;
      color: #059669;
    }

    .analysis-trend.trend-down {
      background: #fef2f2;
      color: #dc2626;
    }

    .product-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px;
      background: #f9fafb;
      border-radius: 10px;
    }

    .product-rank {
      width: 28px;
      height: 28px;
      border-radius: 8px;
      background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);
      color: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 13px;
    }

    .product-name {
      flex: 1;
      font-weight: 600;
      color: #1f2937;
    }

    .product-count {
      font-size: 13px;
      color: #6b7280;
      font-weight: 500;
    }

    .analysis-tables {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    .analysis-table {
      background: #ffffff;
      border: 2px solid #e5e7eb;
      border-radius: 16px;
      overflow: hidden;
    }

    .table-header {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 16px 20px;
      background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
      border-bottom: 2px solid #e5e7eb;
    }

    .table-icon {
      font-size: 18px;
    }

    .table-header h3 {
      font-size: 16px;
      font-weight: 700;
      color: #1f2937;
      margin: 0;
    }

    .recommendations-table .table-header {
      border-bottom-color: #10b981;
    }

    .risks-table .table-header {
      border-bottom-color: #ef4444;
    }

    .table-body {
      padding: 16px 20px;
    }

    .table-row {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 10px 0;
      border-bottom: 1px solid #f3f4f6;
    }

    .table-row:last-child {
      border-bottom: none;
    }

    .row-bullet {
      color: #ec4899;
      font-weight: 700;
      font-size: 16px;
      line-height: 1.4;
    }

    .row-text {
      flex: 1;
      font-size: 14px;
      line-height: 1.6;
      color: #374151;
    }

    .row-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .row-main-text {
      font-size: 14px;
      line-height: 1.5;
      color: #1f2937;
      font-weight: 500;
    }

    .row-reason {
      font-size: 12px;
      color: #6b7280;
      line-height: 1.4;
    }

    .recommendation-price {
      background: #f0fdf4;
      border-left: 3px solid #10b981;
      padding-left: 16px;
    }

    .risk-item {
      background: #fef2f2;
      border-left: 3px solid #ef4444;
      padding-left: 16px;
    }

    .price-suggestion {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 4px;
    }

    .old-price {
      font-size: 14px;
      color: #9ca3af;
      text-decoration: line-through;
      font-weight: 500;
    }

    .new-price {
      font-size: 16px;
      color: #10b981;
      font-weight: 700;
    }

    .price-change {
      font-size: 12px;
      color: #6b7280;
      font-weight: 500;
    }

    .price-change.positive {
      color: #10b981;
    }

    .typing-indicator {
      display: flex;
      align-items: center;
      gap: 4px;
      margin-top: 16px;
      padding: 12px;
      background: #f9fafb;
      border-radius: 8px;
    }

    .typing-indicator span {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #ec4899;
      animation: typingDot 1.4s infinite;
    }

    .typing-indicator span:nth-child(2) {
      animation-delay: 0.2s;
    }

    .typing-indicator span:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes typingDot {
      0%, 60%, 100% {
        transform: translateY(0);
        opacity: 0.7;
      }
      30% {
        transform: translateY(-10px);
        opacity: 1;
      }
    }

    .period-revenue-period {
      font-size: 13px;
      color: rgba(255, 255, 255, 0.85);
      font-weight: 500;
      letter-spacing: 0.3px;
    }

    .period-revenue-amount {
      font-size: 36px;
      font-weight: 900;
      color: #ffffff;
      line-height: 1.1;
      text-shadow: 0 4px 12px rgba(0, 0, 0, 0.3), 0 2px 4px rgba(0, 0, 0, 0.2);
      letter-spacing: -0.02em;
      margin-top: 4px;
    }

    /* Raporlama BaÅŸlÄ±k Ä°yileÅŸtirmeleri */
    .reports-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 20px;
      gap: 16px;
    }

    .reports-title {
      font-size: 24px;
      font-weight: 800;
      color: var(--text-main);
      margin: 0;
      line-height: 1.2;
    }

    .reports-subtitle {
      font-size: 13px;
      color: var(--text-muted);
      margin-top: 4px;
      font-weight: 500;
    }

    .reports-container-modern {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-bottom: 18px;
    }

    .report-group {
      position: relative;
      background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
      border-radius: 20px;
      padding: 20px;
      border: 1px solid rgba(0, 0, 0, 0.06);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08), 0 2px 8px rgba(0, 0, 0, 0.06);
      overflow: hidden;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .report-group:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12), 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .report-group-rising {
      background: linear-gradient(135deg, #ffffff 0%, #f0fdf4 50%, #ffffff 100%);
      border-color: rgba(16, 185, 129, 0.15);
    }

    .report-group-rising::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #10b981 0%, #059669 50%, #047857 100%);
    }

    .report-group-falling {
      background: linear-gradient(135deg, #ffffff 0%, #fffbeb 50%, #ffffff 100%);
      border-color: rgba(245, 158, 11, 0.15);
    }

    .report-group-falling::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #f59e0b 0%, #d97706 50%, #b45309 100%);
    }

    .report-group-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 18px;
      padding-bottom: 14px;
      border-bottom: 2px solid #f1f5f9;
    }

    .report-group-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 15px;
      font-weight: 700;
      color: #0f172a;
      letter-spacing: -0.02em;
    }

    .report-group-rising .report-group-title {
      color: #059669;
    }

    .report-group-falling .report-group-title {
      color: #d97706;
    }

    .chart-icon {
      width: 24px;
      height: 24px;
      flex-shrink: 0;
    }

    .chart-icon-rising {
      color: #10b981;
    }

    .chart-icon-falling {
      color: #f59e0b;
    }

    .report-group-chart {
      width: 120px;
      height: 40px;
      flex-shrink: 0;
      opacity: 0.8;
      transition: opacity 0.3s ease;
    }

    .report-group:hover .report-group-chart {
      opacity: 1;
    }

    .chart-svg {
      width: 100%;
      height: 100%;
    }

    .report-group-cards {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 14px;
    }

    .reports-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 14px;
      margin-bottom: 18px;
    }

    .report-card {
      position: relative;
      background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
      border-radius: 16px;
      padding: 18px;
      border: 1px solid rgba(0, 0, 0, 0.06);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06), 0 1px 3px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
      gap: 14px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      overflow: hidden;
    }

    .report-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      pointer-events: none;
    }

    .report-card::after {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle, rgba(255, 255, 255, 0.3) 0%, transparent 70%);
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .report-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12), 0 4px 8px rgba(0, 0, 0, 0.08);
    }

    .report-card:hover::after {
      opacity: 1;
    }

    .report-card-top-sold {
      background: linear-gradient(135deg, #ffffff 0%, #f0fdf4 100%);
      border-color: rgba(16, 185, 129, 0.2);
    }

    .report-card-top-sold::before {
      background: linear-gradient(90deg, #10b981 0%, #059669 50%, #047857 100%);
    }

    .report-card-top-sold:hover {
      box-shadow: 0 8px 24px rgba(16, 185, 129, 0.15), 0 4px 8px rgba(16, 185, 129, 0.1);
    }

    .report-card-least-sold {
      background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%);
      border-color: rgba(107, 114, 128, 0.2);
    }

    .report-card-least-sold::before {
      background: linear-gradient(90deg, #6b7280 0%, #4b5563 50%, #374151 100%);
    }

    .report-card-least-sold:hover {
      box-shadow: 0 8px 24px rgba(107, 114, 128, 0.15), 0 4px 8px rgba(107, 114, 128, 0.1);
    }

    .report-card-top-earning {
      background: linear-gradient(135deg, #ffffff 0%, #eff6ff 100%);
      border-color: rgba(59, 130, 246, 0.2);
    }

    .report-card-top-earning::before {
      background: linear-gradient(90deg, #3b82f6 0%, #2563eb 50%, #1d4ed8 100%);
    }

    .report-card-top-earning:hover {
      box-shadow: 0 8px 24px rgba(59, 130, 246, 0.15), 0 4px 8px rgba(59, 130, 246, 0.1);
    }

    .report-card-least-earning {
      background: linear-gradient(135deg, #ffffff 0%, #fffbeb 100%);
      border-color: rgba(245, 158, 11, 0.2);
    }

    .report-card-least-earning::before {
      background: linear-gradient(90deg, #f59e0b 0%, #d97706 50%, #b45309 100%);
    }

    .report-card-least-earning:hover {
      box-shadow: 0 8px 24px rgba(245, 158, 11, 0.15), 0 4px 8px rgba(245, 158, 11, 0.1);
    }

    .report-card-title {
      font-size: 12px;
      font-weight: 700;
      margin: 0;
      color: #1f2937;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .report-card-title::before {
      content: '';
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: currentColor;
    }

    .report-card-top-sold .report-card-title {
      color: #059669;
    }

    .report-card-least-sold .report-card-title {
      color: #4b5563;
    }

    .report-card-top-earning .report-card-title {
      color: #2563eb;
    }

    .report-card-least-earning .report-card-title {
      color: #d97706;
    }

    .product-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .product-item {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 14px;
      border-radius: 12px;
      background: #ffffff;
      border: 1.5px solid #f1f5f9;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .product-item::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 3px;
      background: #e2e8f0;
      transition: width 0.25s ease;
    }

    .product-item:hover {
      background: #f8fafc;
      border-color: #e2e8f0;
      transform: translateX(2px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    }

    .product-item:hover::before {
      width: 4px;
    }

    .report-card-top-sold .product-item:hover::before {
      background: linear-gradient(180deg, #10b981 0%, #059669 100%);
    }

    .report-card-top-earning .product-item:hover::before {
      background: linear-gradient(180deg, #3b82f6 0%, #2563eb 100%);
    }

    .report-card-least-sold .product-item:hover::before {
      background: linear-gradient(180deg, #6b7280 0%, #4b5563 100%);
    }

    .report-card-least-earning .product-item:hover::before {
      background: linear-gradient(180deg, #f59e0b 0%, #d97706 100%);
    }

    .product-rank {
      width: 28px;
      height: 28px;
      border-radius: 8px;
      background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
      color: #475569;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 700;
      border: 2px solid #ffffff;
      flex-shrink: 0;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      transition: all 0.25s ease;
    }

    .product-item:hover .product-rank {
      transform: scale(1.05);
    }

    .report-card-top-sold .product-item:first-child .product-rank {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: #ffffff;
      border-color: #10b981;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    .report-card-top-earning .product-item:first-child .product-rank {
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      color: #ffffff;
      border-color: #3b82f6;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }

    .report-card-least-sold .product-item:first-child .product-rank {
      background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
      color: #ffffff;
      border-color: #6b7280;
      box-shadow: 0 4px 12px rgba(107, 114, 128, 0.3);
    }

    .report-card-least-earning .product-item:first-child .product-rank {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      color: #ffffff;
      border-color: #f59e0b;
      box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
    }

    .product-info {
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .product-name {
      font-size: 14px;
      font-weight: 600;
      color: #0f172a;
      line-height: 1.5;
      word-break: break-word;
      letter-spacing: -0.01em;
    }

    .product-meta {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 4px;
    }

    .product-quantity {
      font-size: 12px;
      color: #64748b;
      font-weight: 500;
      background: #f1f5f9;
      padding: 4px 8px;
      border-radius: 6px;
    }

    .product-total {
      font-size: 15px;
      font-weight: 700;
      color: #059669;
      letter-spacing: -0.02em;
    }

    .product-total-emphasis {
      font-size: 16px;
      font-weight: 800;
      color: #2563eb;
      text-shadow: 0 1px 2px rgba(37, 99, 235, 0.1);
    }

    .report-card-top-earning .product-total {
      color: #2563eb;
    }

    .report-card-top-earning .product-total-emphasis {
      color: #1d4ed8;
    }

    .report-card-least-earning .product-total {
      color: #d97706;
    }

    .report-card-least-sold .product-total {
      color: #475569;
    }

    .no-data {
      text-align: center;
      font-size: 13px;
      color: var(--text-muted);
      padding: 10px 0;
    }

    .payment-methods {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .payment-method-item {
      padding: 10px 10px 8px;
      border-radius: 10px;
      background: var(--bg-subtle);
    }

    .payment-method-header {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      color: var(--text-main);
      margin-bottom: 4px;
    }

    .payment-method-count {
      font-size: 12px;
      color: var(--text-muted);
    }

    .payment-progress-bar {
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: #e5e7eb;
      overflow: hidden;
      margin-bottom: 4px;
    }

    .payment-progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #6366f1, #ec4899);
      transition: width 0.2s ease;
    }

    .payment-total {
      font-size: 12px;
      color: var(--text-muted);
    }

    /* ÃœrÃ¼n SatÄ±ÅŸ Tablosu BaÅŸlÄ±k */
    .products-table-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
      gap: 12px;
      flex-wrap: wrap;
    }

    .products-table-title {
      margin: 0;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 16px;
      font-weight: 700;
      color: #1f2937;
    }

    .products-table-title-text {
      white-space: nowrap;
    }

    .products-table-period {
      font-size: 12px;
      color: #6b7280;
      font-weight: 600;
      white-space: nowrap;
    }

    @media (max-width: 768px) {
      .products-table-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }

      .products-table-title {
        font-size: 14px;
      }

      .products-table-title-text {
        font-size: 13px;
      }

      .products-table-period {
        font-size: 11px;
      }
    }

    @media (max-width: 480px) {
      .products-table-title {
        font-size: 13px;
      }

      .products-table-title-text {
        font-size: 12px;
      }

      .products-table-period {
        font-size: 10px;
      }
    }

    /* ÃœrÃ¼n SatÄ±ÅŸ Tablosu */
    .products-sales-table {
      width: 100%;
      border-collapse: collapse;
      background: #ffffff;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      font-size: 13px;
      table-layout: fixed;
    }

    .products-sales-table thead {
      background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
      color: #ffffff;
    }

    .products-sales-table thead th {
      padding: 12px 8px;
      font-weight: 700;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      border-bottom: 2px solid #4b5563;
      white-space: nowrap;
    }

    .products-sales-table .col-rank {
      width: 35px;
      text-align: center;
    }

    .products-sales-table .col-product {
      width: auto;
      text-align: left;
      min-width: 0;
    }

    .products-sales-table .col-quantity {
      width: 60px;
      text-align: right;
    }

    .products-sales-table .col-revenue {
      width: 90px;
      text-align: right;
    }

    .products-sales-table .col-percentage {
      width: 80px;
      text-align: right;
    }

    .products-sales-table tbody tr {
      border-bottom: 1px solid #f3f4f6;
      transition: all 0.2s ease;
    }

    .products-sales-table tbody tr:hover {
      background: linear-gradient(90deg, #f9fafb 0%, #ffffff 100%);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .products-sales-table tbody td {
      padding: 10px 8px;
      border-right: 1px solid #f3f4f6;
      font-size: 12px;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .products-sales-table tbody td:last-child {
      border-right: none;
    }

    .products-sales-table .col-rank {
      color: #6b7280;
      font-weight: 600;
      font-size: 11px;
    }

    .products-sales-table .col-product {
      font-weight: 600;
      color: #1f2937;
      font-size: 12px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 0;
    }

    .products-sales-table .col-quantity {
      color: #374151;
      font-weight: 600;
      font-size: 12px;
    }

    .products-sales-table .col-revenue {
      color: #059669;
      font-weight: 700;
      font-size: 13px;
    }

    .products-sales-table .col-percentage {
      padding: 8px;
    }

    .percentage-cell {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: 6px;
    }

    .percentage-bar {
      flex: 1;
      max-width: 50px;
      background: #e5e7eb;
      border-radius: 3px;
      height: 6px;
      overflow: hidden;
    }

    .percentage-fill {
      background: linear-gradient(90deg, #10b981 0%, #059669 100%);
      height: 100%;
      border-radius: 3px;
      transition: width 0.3s ease;
    }

    .percentage-text {
      color: #6b7280;
      font-weight: 600;
      font-size: 11px;
      min-width: 35px;
      text-align: right;
    }

    .products-sales-table tfoot {
      background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
      border-top: 2px solid #e5e7eb;
    }

    .products-sales-table tfoot td {
      padding: 12px 8px;
      border-right: 1px solid #e5e7eb;
      font-size: 12px;
    }

    .products-sales-table tfoot td:last-child {
      border-right: none;
    }

    .table-footer .footer-label {
      text-align: left;
      font-weight: 700;
      color: #1f2937;
      font-size: 13px;
    }

    .table-footer .footer-quantity {
      text-align: right;
      font-weight: 700;
      color: #374151;
      font-size: 12px;
    }

    .table-footer .footer-revenue {
      text-align: right;
      font-weight: 700;
      color: #059669;
      font-size: 13px;
    }

    .table-footer .footer-percentage {
      text-align: right;
      font-weight: 700;
      color: #1f2937;
      font-size: 12px;
    }

    .empty-state-cell {
      text-align: center;
      padding: 40px 20px !important;
      color: #9ca3af;
    }

    .empty-icon-large {
      font-size: 40px;
      margin-bottom: 10px;
    }

    .empty-title {
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 4px;
    }

    .empty-subtitle {
      font-size: 12px;
    }

    @media (max-width: 768px) {
      .products-sales-table {
        font-size: 11px;
      }

      .products-sales-table thead th {
        padding: 10px 6px;
        font-size: 10px;
      }

      .products-sales-table tbody td {
        padding: 8px 6px;
        font-size: 11px;
      }

      .products-sales-table tfoot td {
        padding: 10px 6px;
        font-size: 11px;
      }

      .products-sales-table .col-rank {
        width: 30px;
      }

      .products-sales-table .col-quantity {
        width: 50px;
      }

      .products-sales-table .col-revenue {
        width: 75px;
        font-size: 12px;
      }

      .products-sales-table .col-percentage {
        width: 70px;
      }

      .percentage-bar {
        max-width: 40px;
        height: 5px;
      }

      .percentage-text {
        font-size: 10px;
        min-width: 30px;
      }

      .products-sales-table .col-product {
        font-size: 11px;
      }
    }

    @media (max-width: 480px) {
      .products-sales-table {
        font-size: 10px;
      }

      .products-sales-table thead th {
        padding: 8px 4px;
        font-size: 9px;
      }

      .products-sales-table tbody td {
        padding: 6px 4px;
        font-size: 10px;
      }

      .products-sales-table tfoot td {
        padding: 8px 4px;
        font-size: 10px;
      }

      .products-sales-table .col-rank {
        width: 25px;
        font-size: 10px;
      }

      .products-sales-table .col-quantity {
        width: 45px;
        font-size: 10px;
      }

      .products-sales-table .col-revenue {
        width: 70px;
        font-size: 11px;
      }

      .products-sales-table .col-percentage {
        width: 65px;
      }

      .percentage-bar {
        max-width: 35px;
        height: 4px;
      }

      .percentage-text {
        font-size: 9px;
        min-width: 28px;
      }

      .products-sales-table .col-product {
        font-size: 10px;
      }
    }

    /* Personel kartlarÄ± */
    .staff-container {
      padding: 10px 0 6px;
    }

    .staff-header-section {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 16px;
    }

    .staff-date-filter-wrapper {
      position: relative;
    }

    .staff-date-filter-trigger {
      background: white;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      padding: 10px 16px;
      font-size: 14px;
      font-weight: 600;
      color: #374151;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s ease;
    }

    .staff-date-filter-trigger:hover {
      border-color: #d1d5db;
      background: #f9fafb;
    }

    /* Toplam Ä°statistikler */
    .staff-summary-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }

    .staff-summary-card {
      background: white;
      border-radius: 14px;
      padding: 18px;
      border: 1px solid #e5e7eb;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      display: flex;
      align-items: center;
      gap: 14px;
      transition: all 0.3s ease;
    }

    .staff-summary-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .staff-summary-card.revenue-card {
      background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
      border-color: #6ee7b7;
    }

    .summary-icon {
      font-size: 32px;
      flex-shrink: 0;
    }

    .summary-content {
      flex: 1;
      min-width: 0;
    }

    .summary-label {
      font-size: 12px;
      font-weight: 600;
      color: #6b7280;
      margin-bottom: 4px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .summary-value {
      font-size: 20px;
      font-weight: 700;
      color: #111827;
      line-height: 1.2;
    }

    .summary-sub {
      font-size: 13px;
      font-weight: 600;
      margin-top: 2px;
      opacity: 0.9;
    }

    /* Kompakt Personel KartlarÄ± */
    .staff-card-compact {
      background: white;
      border-radius: 14px;
      padding: 16px;
      border: 1px solid #e5e7eb;
      box-shadow: 0 2px 6px rgba(0,0,0,0.04);
      transition: all 0.3s ease;
    }

    .staff-card-compact:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      border-color: #d1d5db;
    }

    .staff-header-compact {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 14px;
      padding-bottom: 14px;
      border-bottom: 1px solid #f3f4f6;
    }

    .staff-avatar-compact {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      flex-shrink: 0;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .staff-avatar-compact.rank-gold {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border: 2px solid #fbbf24;
    }

    .staff-avatar-compact.rank-silver {
      background: linear-gradient(135deg, #e5e7eb 0%, #d1d5db 100%);
      border: 2px solid #9ca3af;
    }

    .staff-avatar-compact.rank-bronze {
      background: linear-gradient(135deg, #ffedd5 0%, #fed7aa 100%);
      border: 2px solid #fb923c;
    }

    .staff-avatar-compact.rank-default {
      background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
      border: 2px solid #818cf8;
    }

    .staff-info-compact {
      flex: 1;
      min-width: 0;
    }

    .staff-name-compact {
      font-size: 16px;
      font-weight: 700;
      color: #111827;
      margin: 0 0 4px 0;
      line-height: 1.3;
    }

    .staff-meta-compact {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: #6b7280;
      font-weight: 500;
    }

    .staff-products-compact {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .staff-product-compact {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      background: #f9fafb;
      border-radius: 10px;
      transition: all 0.2s ease;
    }

    .staff-product-compact:hover {
      background: #f3f4f6;
    }

    .product-icon-compact {
      font-size: 18px;
      flex-shrink: 0;
    }

    .product-name-compact {
      flex: 1;
      font-size: 13px;
      font-weight: 600;
      color: #374151;
      min-width: 0;
    }

    .product-count-compact {
      font-size: 12px;
      font-weight: 600;
      color: #6b7280;
      white-space: nowrap;
    }

    .product-revenue-compact {
      font-size: 13px;
      font-weight: 700;
      color: #059669;
      white-space: nowrap;
    }

    .staff-title {
      font-size: 24px;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .staff-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
      gap: 24px;
    }

    /* Modern Personel KartÄ± */
    .staff-card-modern {
      background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%);
      border-radius: 20px;
      border: 1px solid #e5e7eb;
      padding: 24px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.06);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      overflow: hidden;
      position: relative;
    }

    .staff-card-modern:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(0,0,0,0.12);
      border-color: #d1d5db;
    }

    .staff-header-modern {
      display: flex;
      align-items: center;
      gap: 16px;
      padding-bottom: 20px;
      border-bottom: 2px solid #f3f4f6;
      margin-bottom: 20px;
      position: relative;
    }

    .staff-avatar-modern {
      width: 56px;
      height: 56px;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      flex-shrink: 0;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transition: transform 0.3s ease;
    }

    .staff-card-modern:hover .staff-avatar-modern {
      transform: scale(1.05);
    }

    .staff-avatar-modern.rank-gold {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border: 2px solid #fbbf24;
    }

    .staff-avatar-modern.rank-silver {
      background: linear-gradient(135deg, #e5e7eb 0%, #d1d5db 100%);
      border: 2px solid #9ca3af;
    }

    .staff-avatar-modern.rank-bronze {
      background: linear-gradient(135deg, #ffedd5 0%, #fed7aa 100%);
      border: 2px solid #fb923c;
    }

    .staff-avatar-modern.rank-default {
      background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
      border: 2px solid #818cf8;
    }

    .staff-info-modern {
      flex: 1;
      min-width: 0;
    }

    .staff-name-modern {
      font-size: 20px;
      font-weight: 700;
      color: #111827;
      margin: 0 0 4px 0;
      line-height: 1.3;
    }

    .staff-sales-count-modern {
      font-size: 13px;
      color: #6b7280;
      margin: 0;
      font-weight: 500;
    }

    .staff-revenue-badge {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      padding: 10px 16px;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
      flex-shrink: 0;
    }

    .revenue-badge-label {
      display: block;
      font-size: 11px;
      font-weight: 600;
      opacity: 0.9;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 2px;
    }

    .revenue-badge-value {
      display: block;
      font-size: 18px;
      font-weight: 800;
    }

    .staff-stats-grid-modern {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 24px;
    }

    .staff-stat-card-modern {
      border-radius: 14px;
      padding: 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      transition: all 0.3s ease;
      border: 1px solid transparent;
    }

    .staff-stat-card-modern:hover {
      transform: translateY(-2px);
    }

    .stat-green-modern {
      background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
      border-color: #6ee7b7;
    }

    .stat-blue-modern {
      background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
      border-color: #93c5fd;
    }

    .stat-icon-modern {
      font-size: 24px;
      flex-shrink: 0;
    }

    .stat-content-modern {
      flex: 1;
      min-width: 0;
    }

    .staff-stat-label-modern {
      font-size: 12px;
      color: #6b7280;
      margin: 0 0 4px 0;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .staff-stat-value-modern {
      font-size: 18px;
      font-weight: 700;
      color: #111827;
      margin: 0;
    }

    .staff-products-section {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 2px solid #f3f4f6;
    }

    .staff-products-title {
      font-size: 15px;
      font-weight: 700;
      color: #111827;
      margin: 0 0 16px 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .staff-products-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }

    .staff-product-card-modern {
      border-radius: 14px;
      padding: 14px;
      border: 2px solid;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      gap: 8px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .staff-product-card-modern:hover {
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    }

    .product-icon-modern {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      margin-bottom: 4px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .product-info-modern {
      display: flex;
      flex-direction: column;
      gap: 4px;
      width: 100%;
    }

    .product-name-modern {
      font-size: 13px;
      font-weight: 700;
      line-height: 1.3;
    }

    .product-count-modern {
      font-size: 12px;
      font-weight: 600;
      opacity: 0.9;
    }

    .product-revenue-modern {
      font-size: 14px;
      font-weight: 700;
      margin-top: 4px;
    }

    .staff-card {
      background: #ffffff;
      border-radius: var(--radius-md);
      border: 1px solid var(--border-subtle);
      padding: 16px 16px 14px;
    }

    .staff-header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding-bottom: 10px;
      border-bottom: 1px solid #f3f4f6;
      margin-bottom: 10px;
    }

    .staff-avatar {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #fee2e2;
      font-size: 22px;
    }

    .staff-avatar.gold { background: #fef3c7; }
    .staff-avatar.silver { background: #e5e7eb; }
    .staff-avatar.bronze { background: #ffedd5; }

    .staff-name {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-main);
    }

    .staff-sales-count {
      font-size: 12px;
      color: var(--text-muted);
    }

    .staff-stats-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
      margin-bottom: 10px;
    }

    .staff-stat-card {
      border-radius: 10px;
      padding: 10px 10px 8px;
      background: var(--bg-subtle);
      border: 1px solid var(--border-subtle);
    }

    .staff-stat-label {
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 2px;
    }

    .staff-stat-value {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-main);
    }

    .staff-stat-sub {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .staff-top-products-title {
      font-size: 13px;
      font-weight: 500;
      color: var(--text-main);
      margin-bottom: 6px;
    }

    .staff-products-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .staff-product-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 7px 8px;
      border-radius: 10px;
      background: #f9fafb;
    }

    .staff-product-rank {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      background: #eef2ff;
      color: #4f46e5;
      font-size: 11px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    @keyframes toastSlideIn {
      from {
        transform: translateX(400px) scale(0.9);
        opacity: 0;
      }
      to {
        transform: translateX(0) scale(1);
        opacity: 1;
      }
    }

    @keyframes toastSlideOut {
      from {
        transform: translateX(0) scale(1);
        opacity: 1;
      }
      to {
        transform: translateX(400px) scale(0.9);
        opacity: 0;
      }
    }

    .staff-product-info {
      flex: 1;
    }

    .staff-product-name {
      font-size: 12px;
      font-weight: 500;
      color: var(--text-main);
    }

    .staff-product-revenue {
      font-size: 11px;
      color: var(--text-muted);
    }

    .staff-product-count {
      font-size: 12px;
      font-weight: 600;
      color: var(--primary-strong);
    }

    /* Responsive */
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }

      .container {
        padding: 14px;
        border-radius: 16px;
      }

      .dashboard-header {
        flex-direction: column;
        align-items: stretch;
        gap: 6px;
      }

      .admin-navbar {
        padding: 10px 16px;
      }

      .navbar-content {
        flex-direction: column;
        gap: 12px;
        align-items: stretch;
      }

      .navbar-brand {
        justify-content: center;
        text-align: center;
      }

      .navbar-title-group {
        align-items: center;
      }

      .navbar-actions {
        justify-content: center;
        width: 100%;
      }

      .dashboard-header > div {
        justify-content: stretch;
      }

      .refresh-btn,
      .logout-btn {
        flex: 1;
        justify-content: center;
      }

      .stats-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }

      .period-revenue-container {
        grid-template-columns: 1fr;
      }

      .payment-breakdown-card {
        flex-direction: column;
        align-items: stretch;
        gap: 8px;
      }

      .payment-breakdown-item {
        justify-content: space-between;
      }

      .reports-header {
        flex-direction: column;
        align-items: stretch;
        gap: 12px;
      }

      .staff-grid {
        grid-template-columns: 1fr;
      }

      .staff-header-modern {
        flex-wrap: wrap;
      }

      .staff-revenue-badge {
        width: 100%;
        margin-top: 12px;
      }

      .staff-products-grid {
        grid-template-columns: 1fr;
      }

      .staff-header-section {
        flex-direction: column;
        align-items: stretch;
      }

      .staff-date-filter-trigger {
        width: 100%;
        justify-content: center;
      }

      .staff-summary-cards {
        grid-template-columns: 1fr;
      }

      .staff-grid {
        grid-template-columns: 1fr;
      }

      .analysis-modal-content {
        max-width: 95%;
        max-height: 90vh;
      }

      .analysis-summary {
        grid-template-columns: 1fr;
      }

      .analysis-tables {
        grid-template-columns: 1fr;
      }

      .reports-title {
        font-size: 20px;
      }

      .reports-subtitle {
        font-size: 12px;
      }

      .period-revenue-container {
        grid-template-columns: 1fr;
        gap: 14px;
        margin-bottom: 20px;
      }

      .period-revenue-card,
      .period-expense-card,
      .period-online-revenue-card {
        padding: 20px 18px;
        border-radius: 18px;
      }

      .period-card-icon {
        width: 48px;
        height: 48px;
        top: 16px;
        right: 16px;
        border-radius: 14px;
      }

      .period-card-icon svg {
        width: 24px;
        height: 24px;
      }

      .period-revenue-label {
        font-size: 10px;
        gap: 6px;
      }

      .period-label-icon {
        font-size: 14px;
      }

      .period-revenue-period {
        font-size: 12px;
      }

      .period-revenue-amount {
        font-size: 28px;
      }

      .period-card-decoration {
        width: 150px;
        height: 150px;
      }

      .custom-date-inputs {
        gap: 6px;
      }

      .custom-date-input {
        font-size: 11px;
        padding: 5px 6px;
      }

      .tab-buttons {
        gap: 8px;
        grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
        grid-template-rows: repeat(2, auto) !important;
      }

      .tab-buttons-container {
        padding: 0 12px;
      }

      /* DetaylÄ± raporlama: 4 kutu tek ekrana daha rahat sÄ±ÄŸsÄ±n */
      .reports-container .stats-grid {
        display: none;
      }

      .reports-container-modern {
        gap: 12px;
      }

      .report-group {
        padding: 16px 14px;
        border-radius: 16px;
      }

      .report-group-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
        margin-bottom: 14px;
        padding-bottom: 12px;
      }

      .report-group-title {
        font-size: 13px;
      }

      .chart-icon {
        width: 20px;
        height: 20px;
      }

      .report-group-chart {
        width: 100px;
        height: 35px;
        align-self: flex-end;
      }

      .report-group-cards {
        grid-template-columns: 1fr;
        gap: 12px;
      }

      .reports-grid {
        grid-template-columns: repeat(2, 1fr) !important;
        gap: 10px;
      }

      .report-card {
        padding: 14px 12px;
        gap: 12px;
        border-radius: 14px;
      }

      .report-card-title {
        font-size: 10px;
        margin-bottom: 4px;
      }

      .product-item {
        padding: 10px;
        gap: 10px;
      }

      .product-rank {
        width: 22px;
        height: 22px;
        font-size: 11px;
      }

      .product-name {
        font-size: 13px;
      }

      .product-meta {
        flex-direction: column;
        align-items: flex-start;
        gap: 4px;
      }

      .product-quantity {
        font-size: 11px;
      }

      .product-total {
        font-size: 13px;
      }

      .product-total-emphasis {
        font-size: 14px;
      }

      .reports-grid {
        grid-template-columns: 1fr;
        gap: 12px;
      }

      .sale-header {
        flex-direction: column;
      }

      .sale-total {
        text-align: left;
      }

      .reports-header {
        flex-direction: column;
        align-items: stretch;
      }

      .date-filter-wrapper {
        align-self: stretch;
      }

      .date-filter-trigger {
        width: 100%;
        justify-content: space-between;
      }

      /* Masalar responsive */
      .tables-grid {
        grid-template-columns: repeat(5, 1fr);
        gap: 4px;
      }

      .tables-grid.package-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: 4px;
      }

      .table-card {
        padding: 4px;
      }

      .table-number {
        font-size: 14px;
      }

      .table-number-occupied {
        font-size: 18px;
      }

      .table-amount-occupied {
        font-size: 11px;
      }

      .table-card-gradient {
        padding: 8px 6px;
      }

      .date-header {
        padding: 14px 16px;
        border-radius: 12px;
      }

      .date-header > div {
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 12px;
      }

      .date-title-wrapper {
        width: 100%;
      }

      .date-icon {
        width: 36px;
        height: 36px;
        font-size: 16px;
      }

      .date-title {
        font-size: 15px;
      }

      .date-subtitle {
        font-size: 12px;
        flex-wrap: wrap;
      }

      .date-stats {
        display: flex !important;
        flex-direction: row !important;
        width: auto;
        justify-content: flex-end;
        gap: 10px;
        flex-shrink: 0;
      }

      .date-stat-item {
        align-items: center;
        flex: 0 0 auto;
        flex-direction: row !important;
        padding: 8px 12px;
        border-radius: 10px;
        display: flex !important;
      }

      .date-stat-value {
        font-size: 16px;
      }

      .date-stat-label {
        font-size: 12px;
      }

      .date-stat-value {
        font-size: 16px;
      }

      .table-status {
        font-size: 6px;
        padding: 1px 3px;
      }

      .table-name {
        font-size: 8px;
      }

      .amount-value {
        font-size: 9px;
      }

      .items-value {
        font-size: 8px;
      }
    }
  </style>
</head>
<body>
  <div id="loader" class="admin-splash-screen">
    <div class="splash-content">
      <img src="logo.png" alt="MAKARA Logo" class="splash-logo" onerror="this.style.display='none';">
      <h1 class="splash-main-text">MAKARA</h1>
      <div class="splash-decorative-line"></div>
      <p class="splash-subtitle-text">Admin Dashboard</p>
    </div>
  </div>

  <div class="container">
    <div id="loginSection" class="login-container">
      <div class="login-card">
        <div class="login-card-header">
          <div class="login-logo">
            <img src="logo.png" alt="MAKARA Logo" class="login-logo-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
            <div class="login-logo-fallback" style="display: none;">M</div>
          </div>
          <h1 class="login-title">MAKARA</h1>
          <p class="login-subtitle">Admin Dashboard</p>
        </div>
        
        <div class="login-card-body">
          <div class="login-form-group">
            <label for="pinInput" class="login-label">
              <svg class="login-icon" width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
              </svg>
              <span>PIN Kodu</span>
            </label>
            <input 
              type="password" 
              id="pinInput" 
              class="login-input" 
              placeholder="PIN kodunuzu girin" 
              maxlength="30" 
              autofocus
              onkeypress="if(event.key === 'Enter') verifyPin()"
            >
          </div>
          
          <div class="login-remember">
            <label class="remember-checkbox-label">
              <input type="checkbox" id="rememberMe" class="remember-checkbox">
              <span class="remember-checkmark"></span>
              <span class="remember-text">Beni HatÄ±rla</span>
            </label>
          </div>
          
          <button onclick="verifyPin()" class="login-btn">
            <span>GiriÅŸ Yap</span>
            <svg class="login-btn-icon" width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
            </svg>
          </button>
          
          <button onclick="showChangePasswordModal()" class="change-password-btn">
            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
            </svg>
            <span>Åifre DeÄŸiÅŸtir</span>
          </button>
        </div>
        
        <div class="login-card-footer">
          <div class="login-footer-text">
            <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
            </svg>
            <span>GÃ¼venli GiriÅŸ</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Åifre DeÄŸiÅŸtirme Modal -->
    <div id="changePasswordModal" class="change-password-modal" onclick="if(event.target === this) hideChangePasswordModal()">
      <div class="change-password-modal-content">
        <div class="change-password-modal-header">
          <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937; display: flex; align-items: center; gap: 10px;">
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
            </svg>
            <span>Åifre DeÄŸiÅŸtir</span>
          </h2>
          <button onclick="hideChangePasswordModal()" style="background: #f3f4f6; border: none; color: #6b7280; width: 36px; height: 36px; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: bold; transition: all 0.2s;" onmouseover="this.style.background='#e5e7eb'; this.style.color='#374151';" onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">Ã—</button>
        </div>
        <div class="change-password-modal-body">
          <div style="margin-bottom: 20px;">
            <label for="currentPasswordInput" style="display: block; font-size: 13px; font-weight: 600; color: #4b5563; margin-bottom: 8px;">
              Mevcut Åifre
            </label>
            <input 
              type="password" 
              id="currentPasswordInput" 
              class="change-password-input" 
              placeholder="Mevcut ÅŸifrenizi girin"
              maxlength="30"
              onkeypress="if(event.key === 'Enter') document.getElementById('newPasswordInput').focus()"
            >
          </div>
          <div style="margin-bottom: 20px;">
            <label for="newPasswordInput" style="display: block; font-size: 13px; font-weight: 600; color: #4b5563; margin-bottom: 8px;">
              Yeni Åifre
            </label>
            <input 
              type="password" 
              id="newPasswordInput" 
              class="change-password-input" 
              placeholder="Yeni ÅŸifrenizi girin"
              maxlength="30"
              onkeypress="if(event.key === 'Enter') changePassword()"
            >
          </div>
          <div style="margin-bottom: 24px;">
            <label for="confirmPasswordInput" style="display: block; font-size: 13px; font-weight: 600; color: #4b5563; margin-bottom: 8px;">
              Yeni Åifre (Tekrar)
            </label>
            <input 
              type="password" 
              id="confirmPasswordInput" 
              class="change-password-input" 
              placeholder="Yeni ÅŸifrenizi tekrar girin"
              maxlength="30"
              onkeypress="if(event.key === 'Enter') changePassword()"
            >
          </div>
          <button onclick="changePassword()" class="change-password-submit-btn">
            <span>Åifreyi DeÄŸiÅŸtir</span>
            <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <div id="dashboard" class="dashboard">
      <!-- Modern Navbar -->
      <nav class="admin-navbar">
        <div class="navbar-content">
          <div class="navbar-brand">
            <img src="logo.png" alt="MAKARA Logo" class="navbar-logo-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
            <div class="navbar-logo" style="display: none;">M</div>
            <div class="navbar-title-group">
              <h1 class="navbar-title">MAKARA Admin Dashboard</h1>
              <p class="navbar-subtitle">AnlÄ±k SatÄ±ÅŸ DetaylarÄ± ve Ä°statistikler</p>
            </div>
          </div>
          <div class="navbar-actions">
            <button onclick="loadSales()" class="refresh-btn">
              <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"/>
              </svg>
              <span>Yenile</span>
            </button>
            <button onclick="showOnlineOrdersModal()" class="notifications-btn" id="onlineOrdersBtn">
              <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" />
              </svg>
              <span>Online</span>
            </button>
            <button onclick="logout()" class="logout-btn">
              <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15M12 9l-3 3m0 0l3 3m-3-3h12.75"/>
              </svg>
              <span>Ã‡Ä±kÄ±ÅŸ</span>
            </button>
          </div>
        </div>
      </nav>
      
      <!-- Online SipariÅŸler Modal -->
      <div id="onlineOrdersModal" class="notifications-modal" onclick="if(event.target === this) hideOnlineOrdersModal()" style="display: none;">
        <div class="notifications-modal-content" style="max-width: 900px; max-height: 90vh;">
          <div class="notifications-modal-header">
            <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937; display: flex; align-items: center; gap: 10px;">
              <span>ğŸŒ</span>
              <span>Online SipariÅŸler</span>
            </h2>
            <div style="display: flex; align-items: center; gap: 10px;">
              <button onclick="hideOnlineOrdersModal()" style="background: #f3f4f6; border: none; color: #6b7280; width: 36px; height: 36px; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: bold; transition: all 0.2s;" onmouseover="this.style.background='#e5e7eb'; this.style.color='#374151';" onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">Ã—</button>
            </div>
          </div>
          <div id="onlineOrdersList" class="notifications-list" style="max-height: calc(90vh - 100px); overflow-y: auto;">
            <!-- Online sipariÅŸler buraya eklenecek -->
          </div>
        </div>
      </div>
      
      <!-- Tab ButonlarÄ± - En Ãœstte Modern ve Kurumsal -->
      <div class="tab-buttons-container">
        <div class="tab-buttons">
          <button class="tab-btn active" data-tab="sales" onclick="setActiveTab('sales')">
            <div class="tab-btn-icon">ğŸ“‹</div>
            <div class="tab-btn-text">SatÄ±ÅŸ GeÃ§miÅŸi</div>
            <div class="tab-btn-indicator"></div>
          </button>
          <button class="tab-btn" data-tab="reports" onclick="setActiveTab('reports')">
            <div class="tab-btn-icon">ğŸ“Š</div>
            <div class="tab-btn-text">DetaylÄ± Raporlama</div>
            <div class="tab-btn-indicator"></div>
          </button>
          <button class="tab-btn" data-tab="staff" onclick="setActiveTab('staff')">
            <div class="tab-btn-icon">ğŸ‘¥</div>
            <div class="tab-btn-text">Personel DetaylarÄ±</div>
            <div class="tab-btn-indicator"></div>
          </button>
          <button class="tab-btn" data-tab="tables" onclick="setActiveTab('tables')">
            <div class="tab-btn-icon">ğŸª‘</div>
            <div class="tab-btn-text">Masalar</div>
            <div class="tab-btn-indicator"></div>
          </button>
          <button class="tab-btn" data-tab="cancels" onclick="setActiveTab('cancels')">
            <div class="tab-btn-icon">âŒ</div>
            <div class="tab-btn-text">Ä°ptaller</div>
            <div class="tab-btn-indicator"></div>
          </button>
          <button class="tab-btn" data-tab="send-message" onclick="showSendMessageModal()">
            <div class="tab-btn-icon">ğŸ“¢</div>
            <div class="tab-btn-text">Mesaj GÃ¶nder</div>
            <div class="tab-btn-indicator"></div>
          </button>
        </div>
      </div>
      
      <div class="stats-grid" id="statsGrid"></div>
      
      <div id="salesContainer" style="min-height: 200px;"></div>
      <div id="reportsContainer" style="min-height: 200px; display: none;"></div>
      <div id="staffContainer" style="min-height: 200px; display: none;"></div>
      <div id="tablesContainer" style="min-height: 200px; display: none;"></div>
      <div id="cancelsContainer" style="min-height: 200px; display: none;"></div>
    </div>
  </div>

  <!-- Mesaj GÃ¶nderme Modal -->
  <div id="sendMessageModal" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 10000; align-items: center; justify-content: center; padding: 20px; backdrop-filter: blur(4px);" onclick="if(event.target === this) hideSendMessageModal()">
    <div style="background: white; border-radius: 24px; width: 100%; max-width: 500px; overflow: hidden; display: flex; flex-direction: column; box-shadow: 0 25px 70px rgba(0,0,0,0.4); animation: slideUp 0.3s ease;">
      <div style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; padding: 24px;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <h2 style="margin: 0; font-size: 22px; font-weight: 900;">ğŸ“¢ Mesaj GÃ¶nder</h2>
          <button onclick="hideSendMessageModal()" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 36px; height: 36px; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; transition: all 0.3s;" onmouseover="this.style.background='rgba(255,255,255,0.3)';" onmouseout="this.style.background='rgba(255,255,255,0.2)';">Ã—</button>
        </div>
      </div>
      <div style="padding: 24px;">
        <div style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 8px; font-size: 15px; color: #374151; font-weight: 700;">Mesaj Ä°Ã§eriÄŸi <span style="color: #ef4444;">*</span>:</label>
          <textarea id="messageContentInput" placeholder="TÃ¼m mobil personellere ve kasaya gÃ¶nderilecek mesajÄ± yazÄ±n..." style="width: 100%; min-height: 150px; padding: 14px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 15px; font-family: inherit; resize: vertical; outline: none;" onfocus="this.style.borderColor='#3b82f6';" onblur="this.style.borderColor='#e5e7eb';"></textarea>
        </div>
        <div style="background: #dbeafe; border: 2px solid #93c5fd; border-radius: 12px; padding: 16px; margin-bottom: 24px;">
          <p style="margin: 0; font-size: 13px; color: #1e40af; font-weight: 600; line-height: 1.6;">
            â„¹ï¸ Bu mesaj tÃ¼m mobil personellere ve masaÃ¼stÃ¼ uygulamaya anlÄ±k olarak gÃ¶nderilecektir.
          </p>
        </div>
      </div>
      <div style="border-top: 1px solid #e5e7eb; padding: 20px; display: flex; justify-content: flex-end; gap: 12px; background: #f9fafb;">
        <button onclick="hideSendMessageModal()" style="padding: 14px 28px; background: #f3f4f6; color: #374151; border: none; border-radius: 12px; font-weight: 700; font-size: 15px; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">Ä°ptal</button>
        <button id="sendMessageBtn" onclick="sendBroadcastMessage()" style="padding: 14px 28px; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; border: none; border-radius: 12px; font-weight: 700; font-size: 15px; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3); display: flex; align-items: center; justify-content: center; gap: 8px; min-width: 140px;" onmouseover="if(!this.disabled) { this.style.transform='scale(1.02)'; this.style.boxShadow='0 6px 16px rgba(59, 130, 246, 0.4)'; }" onmouseout="if(!this.disabled) { this.style.transform='scale(1)'; this.style.boxShadow='0 4px 12px rgba(59, 130, 246, 0.3)'; }">
          <span id="sendMessageBtnText">GÃ¶nder</span>
          <svg id="sendMessageBtnSpinner" style="display: none; width: 18px; height: 18px; animation: spin 1s linear infinite;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Analiz Modal -->
  <div id="analysisModal" class="analysis-modal" style="display: none;">
    <div class="analysis-modal-overlay" onclick="closeAnalysisModal()"></div>
    <div class="analysis-modal-content">
      <div class="analysis-modal-header">
        <h2 class="analysis-modal-title">ğŸ” SatÄ±ÅŸ Analizi</h2>
        <button class="analysis-modal-close" onclick="closeAnalysisModal()">Ã—</button>
      </div>
      <div class="analysis-modal-body">
        <div id="analysisContent" class="analysis-content"></div>
        <div id="analysisTypingIndicator" class="typing-indicator" style="display: none;">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
